<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_okta_html5_topnav" data-mc-search-type="Stem" data-mc-help-system-file-name="okta_help.xml" data-mc-path-to-help-system="../../../" data-mc-has-content-body="True" data-mc-searchable="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="typeofcontent" content="documentation" />
        <meta name="audience" content="admin" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>OpenID Connect (OIDC) based MFA as a Service | Okta</title>
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, height=device-height" />
        <link rel="shortcut icon" href="../../Resources/Images/favicon.ico" type="image/x-icon" />
        <!-- Google Tag Manager -->
        <script>
			/* <![CDATA[ */
			(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], 
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
			})(window,document,'script','dataLayer','GTM-TJ45R6');
			/* ]]> */
		</script>
        <!-- End Google Tag Manager -->
        <link href="../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" />
        <link href="../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" />
        <link href="../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" />
        <link href="../../Resources/Stylesheets/okta-main.css" rel="stylesheet" />
        <link href="https://static.cloud.coveo.com/searchui/v2.5395/css/CoveoFullSearchNewDesign.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.expand-all-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/expand-all-non-hover-sm.png') no-repeat center center, linear-gradient(#fff, #fff);
}

.button.collapse-all-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/collapse-all-non-hover-sm.png') no-repeat center center, linear-gradient(#fff, #fff);
}

.needs-pie
{
	behavior: url('../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <script src="../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/foundation.6.2.3_custom.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="small" data-mc-ignore="true">
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <button class="menu-icon" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="https://support.okta.com/help/s/" alt="Okta"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="2" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" placeholder="Search" />
                                                <div class="search-filter-wrapper">
                                                    <div class="search-filter">
                                                        <div class="search-filter-content">
                                                            <ul>
                                                                <li>All Files</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search">
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <section class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <div class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </div>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <!-- Google Tag Manager (noscript) -->
                                    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TJ45R6" height="0" width="0" style="display:none;visibility:hidden"></iframe>
                                    </noscript>
                                    <!-- End Google Tag Manager (noscript) -->
                                    <!-- Coveo config parameters -->
                                    <div id="coveo_org_id" style="Display:None"><span class="okta-coveo-configOrgId">oktaproduction9ounvcxa</span>
                                    </div>
                                    <div id="coveo_rest_uri" style="Display:None"><span class="okta-coveo-configPlatformRestUri">https://platform.cloud.coveo.com/rest/search</span>
                                    </div>
                                    <div id="coveo_search_url" style="Display:None"><span class="okta-coveo-configSearchPageUrl">https://support.okta.com/help/s/global-search/%40uri</span>
                                    </div>
                                    <div id="coveo_token_url" style="Display:None"><span class="okta-coveo-configSearchTokenServiceUrl">https://support.okta.com/help/services/apexrest/PublicSearchToken?site=help</span>
                                    </div>
                                    <!-- End Coveo config parameters -->
                                    <!-- ************************* Coveo Search bar ************************************* -->
                                    <div id="OLC_Coveo_Headline" class="coveo-headline-wrapper">
                                        <div class="slds-p-vertical_small">
                                            <!--Search Bar-->
                                            <div class="slds-grid slds-grid_align-center">
                                                <div id="customSelect" class="CoveoCustomSelect slds-float_right">
                                                </div>
                                                <div id="standaloneSearchbox">
                                                    <div class="CoveoAnalytics" data-search-hub="OktaCommunityFullSearch">
                                                    </div>
                                                    <div class="CoveoTab" data-id="Help" data-caption="Help" style="display:none">
                                                    </div>
                                                    <div class="CoveoSearchbox" data-enable-omnibox="true" data-enable-query-suggest-addon="true">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- **********************  Main content row  ********************** -->
                                    <div class="okta-topics">
                                        <!-- *** Col1: Left Nav Col *** -->
                                        <div class="is-not-in-mobile">
                                            <div data-sticky-container="" id="Pr6u8f0xlUek7nh3qKi0qg">
                                                <div class="sticky sticky-menu" style="width:100%" data-sticky="" data-top-anchor="Pr6u8f0xlUek7nh3qKi0qg:top" data-bottom-anchor="contentBody:bottom" data-sticky-on="small" data-scroll-container-on="small">
                                                    <ul class="nocontent menu _Skins_okta_left_menu mc-component" data-mc-linked-toc="Data/Tocs/left_nav_TOC.js" data-mc-side-menu="True" data-mc-max-depth="2" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- *** Col2: Body Col *** -->
                                        <div>
                                            <div class="is-not-in-mobile">
                                                <!-- Breadcrumbs -->
                                            </div>
                                            <div class="toolbar-main">
                                                <!-- Expand/Collapse All for drop-downs -->
                                                <div class="buttons popup-container clearfix topicToolbarProxy _Skins_okta_toolbar mc-component nocontent" style="mc-topic-toolbar-items: ;">
                                                    <div class="button-group-container-left">
                                                        <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                                            <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="body-main">
                                                <!-- Main content body -->
                                                <h1>OpenID Connect (OIDC)-based MFA as a Service - BETA</h1>
                                                <h2>Prerequisites</h2>
                                                <ul>
                                                    <li value="1">Set up at least one <a href="../Security/MFA.htm">MFA factor</a> on your Okta <a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">Org<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>The Okta container that represents a real-world organization.</span></a>. </li>
                                                    <li value="2">
A factor enrollment policy
</li>
                                                    <li value="3">
                                                        <p>Enable IFrame embedding:</p>
                                                        <ol>
                                                            <li value="1">From the <a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">admin<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>An abbreviation of administrator. This is the individual(s) who have access to the Okta Administrator Dashboard. They control the provisioning and deprovisioning of end users, the assigning of apps, the resetting of passwords, and the overall end user experience. Only administrators have the Administration button on the upper right side of the My Applications page.</span></a> dashboard, navigate to  <b>Settings -&gt; customization</b></li>
                                                            <li value="2">Scroll down to the <b>IFrame Embedding</b> section and click <b>Edit</b>.</li>
                                                            <li value="3">Check <b>Allow IFrame embedding</b>, then click <b>Save</b>.</li>
                                                        </ol>
                                                    </li>
                                                </ul>
                                                <p class="beta"><b>Note</b>:&#160;This is a Beta feature. This feature should only be used in test and developer environments. <br />Please email <a href="mailto:mfabeta@okta.com">mfabeta@okta.com</a> with any questions or feedback regarding this feature.</p>
                                                <p>Follow the steps below to setup an <a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">OIDC<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>OpenID Connect (OIDC) is an authentication layer on top of OAuth 2.0, an authorization framework. The standard is controlled by the OpenID</span></a> application in Okta and provide the artifacts (Okta org URL, <a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">client<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>Essentially, a client is anything that talks to the Okta service. Within the traditional client-server model, Okta is the server. The client might be an agent, an Okta mobile app, or a browser plugin. </span></a>_id, client_secret) to your application.</p>
                                                <h2>Configure Okta</h2>
                                                <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Step 1 - Create an OIDC Application</a></span>
                                                    <div class="MCDropDownBody dropDownBody">
                                                        <ol>
                                                            <li value="1">Navigate to <b>Applications &gt;&#160;Applications</b>.</li>
                                                            <li value="2">Click <b>Add Application</b>.</li>
                                                            <li value="3">Click <b>Create New <a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">App<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>An abbreviation of application. Essentially, it is a web-based site used to perform any number of specific tasks, and requires authentication from end users by signing in.</span></a></b>:</li>
                                                            <p>
                                                                <img src="../../Resources/Images/odic_service1.png" />
                                                            </p>
                                                            <li value="4"><b>Platform</b>: Select <b>Web</b>.</li>
                                                            <li value="5">Click <b>Sign On Method</b>: Select <b>OIDC&#160;Connect</b>.</li>
                                                            <p>
                                                                <img src="../../Resources/Images/odic_service2.png" />
                                                            </p>
                                                            <li value="6">
                                                                <p>Provide an <b>Application name</b> and define the list of valid <b>Login redirect URIs</b>.</p>
                                                                <p>The application (RP) must request a redirect_uri from this list of URIs.</p>
                                                                <p><b>Note</b>: Private-Use URI Scheme Redirection (com.example.app) is supported.  See <a href="https://tools.ietf.org/html/rfc8252#section-7.1">RFC8252</a> for best practices on receiving responses in native/desktop apps.</p>
                                                            </li>
                                                            <img src="../../Resources/Images/odic_service3.png" />
                                                            <li value="7">
                                                                <p>Modify the <b>Allowed grant types</b> to include <b>Allow ID Token with implicit grant type</b>.</p>
                                                            </li>
                                                            <img src="../../Resources/Images/odic_service4.png" />
                                                            <li value="8">
                                                                <p>Define a <b>Sign On Policy</b> requiring MFA.</p>
                                                            </li>
                                                            <p>
                                                                <img src="../../Resources/Images/odic_service5.png" />
                                                            </p>
                                                        </ol>
                                                    </div>
                                                </div>
                                                <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Step 2 - Define the application username format to be used</a></span>
                                                    <div class="MCDropDownBody dropDownBody">
                                                        <p>By default the <b>Application Username</b> will be the same as the Okta user's login attribute (user.login). The value of the<b>Application Username</b> must match the value that will be sent in the login_hint claim later.</p>
                                                        <p>Using the Profile Editor</p>
                                                        <p>You can use the Profile Editor and Okta Expression Language (EL) to meet your more advanced needs.  For more information, see the <b>Configure Username Override</b> section in <a href="../Directory/eu-profile-editor.htm">Manage User Profiles</a>.</p>
                                                    </div>
                                                </div>
                                                <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Step 3 - Assign users/groups to the application</a></span>
                                                    <div class="MCDropDownBody dropDownBody">
                                                        <p>Ensure that the desired users or <a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">groups<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>Groups allow you to organize your end users and the apps they can access. Assigning apps to large sets of end users is made easier with groups.</span></a> are assigned to the newly created application. For additional details refer to the <b>Assign Applications</b> sections of <a href="../Apps/Apps_Apps_Page.htm">The Applications Page</a>.</p>
                                                    </div>
                                                </div>
                                                <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />step 4 - Retrieve the Client ID and Client Secret</a></span>
                                                    <div class="MCDropDownBody dropDownBody">
                                                        <p>From the <b>General</b> tab of the application, navigate to the <b>Client Credentials</b> and retrieve the <b>Client ID</b> and <b>Client secret</b>:</p>
                                                        <p>
                                                            <img src="../../Resources/Images/odic_service6.png" />
                                                        </p>
                                                    </div>
                                                </div>
                                                <h2>Configure Your Application</h2>
                                                <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Overview</a></span>
                                                    <div class="MCDropDownBody dropDownBody">
                                                        <p>To prompt for MFA Attestation, you must make an OIDC authorize request using a signed request object with the acr_values claim set to urn:okta:app:mfa:attestation. This is a JWT signed with the client_secret passed into the authorization endpoint as the request parameter. 

</p>
                                                        <p>This request ignores the current session and can be used even if another user is currently logged in.
</p>
                                                        <p>
The JWT can easily be created using a JWT library or on online JWT building tool and must follow these rules:
</p>
                                                        <ul>
                                                            <li value="1"><a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">idp<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>An acronym for Identity Provider. It is a service that manages end user accounts analogous to user directories such as LDAP and Active Directory, and can send SAML responses to SPs to authenticate end users. Within this scenario, the IdP is Okta.</span></a> cannot be used
</li>
                                                            <li value="2">login_hint must be supplied and match the AppUser username associated with the OIDC app
</li>
                                                            <li value="3"><a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">scope<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>A scope is an indication by the client that it wants to access some resource.</span></a> must be just openid</li>
                                                            <li value="4">
acr_values must be urn:okta:app:mfa:attestation</li>
                                                            <li value="5">
response_type must be just id_token
</li>
                                                            <li value="6">MFA Attestations are only supported on the Org Authorization Server
<ul><li value="1"><span style="font-family: 'Courier New'; font-size: 11pt;">/oauth2/v1/authorize</span><![CDATA[

]]></li></ul></li>
                                                        </ul>
                                                        <p>Use the following resources to provide additional context and guidance:</p>
                                                        <ul>
                                                            <li value="1">
Okta specific OIDC documentation can be found here:<ul><li value="1"><![CDATA[
]]><a href="https://developer.okta.com/docs/api/resources/oidc#authorize">https://developer.okta.com/docs/api/resources/oidc</a></li></ul></li>
                                                            <li value="2">
Online JWT Encode and Decode tools with tips can be found here:<ul><li value="1"><a href="https://www.jsonwebtoken.io/">https://www.jsonwebtoken.io</a><![CDATA[

]]></li></ul></li>
                                                        </ul>
                                                        <p>The calling application (RP) will require the following information about your Okta org and OIDC application
</p>
                                                        <ul>
                                                            <li value="1"><span style="font-size: 11pt; font-family: 'Courier New';">$base_url</span> (for example:  https://mattegantest.oktapreview.com)</li>
                                                            <li value="2"><![CDATA[
]]><span style="font-family: 'Courier New'; font-size: 11pt;">$client_id</span> (for example: 0oaevei26hCJ198vv0h7)
</li>
                                                            <li value="3"><span style="font-family: 'Courier New'; font-size: 11pt;">$client_secret</span> (for example: aaGSo9SSspR1MqxHUaz6Ypgq7qaAc9MnMMv_eVYP)

</li>
                                                        </ul>
                                                        <p>**Client_ID &amp; Clent_Secret can be found under the <b>General</b> tab of your OIDC app. **
</p>
                                                    </div>
                                                </div>
                                                <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Step 1 - Sign MFA AuthN request</a></span>
                                                    <div class="MCDropDownBody dropDownBody">
                                                        <p><b>Set nonce</b> = A secure random string (sufficiently long)</p>
                                                        <p>Store the nonce on the app backend (i.e. the value should not be available to user in any form or shape)</p>
                                                        <p>Generate and sign a JWT Request:</p>
                                                        <ul>
                                                            <li value="1">Requests should be signed using HS256 with the client_secret</li>
                                                            <li value="2">iat (issued at time) should be used</li>
                                                            <li value="3">exp (expiration time) with a lifetime that accommodates for reasonable clock skew and round trip should be used</li>
                                                        </ul>
                                                        <p style="font-weight: bold;">Example request JWT created by app requesting MFA from Okta:</p>
                                                        <div style="width: 100%;padding-left: 8px;padding-right: 8px;padding-top: 4px;padding-bottom: 6px;border-left-style: solid;border-left-width: 1px;border-right-style: solid;border-right-width: 1px;border-top-style: solid;border-top-width: 1px;border-bottom-style: solid;border-bottom-width: 1px;"><pre><p style="font-family: 'Courier New';">
{</p><p style="font-family: 'Courier New';">  "iss": "$client_id",</p><p style="font-family: 'Courier New';">  "exp": $expiration_timestamp,
  "aud": "$base_url", </p><p style="font-family: 'Courier New';">  "sub": "optional/ignored if present",
  "response_type": "id_token",  </p><p style="font-family: 'Courier New';">  "response_mode": "(fragment|form_post|okta_post_message)",
  "client_id": "$client_id",
  "redirect_uri": "$your_redirect_uri",</p><p style="font-family: 'Courier New';">  "scope": "openid",
  "acr_values": "urn:okta:app:mfa:attestation",
  "state": "$any_required_state",
  "nonce": "$replay_mitigating_nonce",
  "login_hint": "$app_userName",
  "iat": $issuedAt_timestamp
}							</p></pre>
                                                        </div>
                                                        <p style="font-weight: bold;">Sample request JWT:</p>
                                                        <div style="width: 100%;padding-left: 8px;padding-right: 8px;padding-top: 4px;padding-bottom: 6px;border-left-style: solid;border-left-width: 1px;border-right-style: solid;border-right-width: 1px;border-top-style: solid;border-top-width: 1px;border-bottom-style: solid;border-bottom-width: 1px;"><pre><p style="font-family: 'Courier New';">{
  "iss": "0oaek22f3gvTVvqbW0h7",
  "exp": 1525190702,
  "aud": "https://&lt;yourOktaOrg&gt;.okta.com",
  "sub": "",
  "response_type": "id_token",
  "response_mode": "fragment",
  "client_id": "0oaek22f3gvTVvqbW0h7",
  "redirect_uri": "https://okta-box.herokuapp.com",
  "scope": "openid",
  "acr_values": "urn:okta:app:mfa:attestation",
  "state": "assetID_12345",
  "nonce": "h3lX29$sWGxK3",
  "login_hint": "mfa.only@oktademo.com",
  "iat": 1525190672
}
</p></pre>
                                                        </div>
                                                        <p>Refer to RFC8252 for best practices on redirect_uri usage with native app and other non-web flows.</p>
                                                        <p style="font-weight: bold;">Sample signed and encoded request JWT:</p>
                                                        <div style="width: 100%;padding-left: 8px;padding-right: 8px;padding-top: 4px;padding-bottom: 6px;border-left-style: solid;border-left-width: 1px;border-right-style: solid;border-right-width: 1px;border-top-style: solid;border-top-width: 1px;border-bottom-style: solid;border-bottom-width: 1px;">
                                                            <p><pre xml:space="preserve"><span style="color: #ff8c00;">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9<span style="color: #0000ff;">.eyJpc3MiOiIwb2FlazIyZjNndlRWdnFiVzBoNyIs
ImV4cCI6MTUyNTE5MDcwMiwiYXVkIjoiaHR0cHM6Ly9ib3h3b3Jrcy5va3RhcHJldmlldy5jb20iL
CJzdWIiOiIiLCJyZXNwb25zZV90eXBlIjoiaWRfdG9rZW4iLCJyZXNwb25zZV9tb2RlIjoiZnJhZ2
1lbnQiLCJjbGllbnRfaWQiOiIwb2FlazIyZjNndlRWdnFiVzBoNyIsInJlZGlyZWN0X3VyaSI6Imh
0dHBzOi8vb2t0YS1ib3guaGVyb2t1YXBwLmNvbSIsInNjb3BlIjoib3BlbmlkIiwiYWNyX3ZhbHVl
cyI6InVybjpva3RhOmFwcDptZmE6YXR0ZXN0YXRpb24iLCJzdGF0ZSI6ImFzc2V0SURfMTIzNDUiL
CJub25jZSI6ImgzbFgyOSRzV0d4SzMiLCJsb2dpbl9oaW50IjoibWZhLm9ubHlAb2t0YWRlbW8uY2
9tIiwianRpIjoiNzU0ODc3ZjctY2U4ZC00ZGI0LTk1MDMtMmZiOWY0NjRjYTVlIiwiaWF0IjoxNTI
1MTkwNjcyfQ</span></span><span style="color: #ffa500;">.fihBrq5CB8nMC9SKSAvik3Vla8H7kTP1TAG1Mlqj1ic</span></pre>
                                                            </p>
                                                        </div>
                                                        <p>&#160;</p>
                                                    </div>
                                                </div>
                                                <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Step 2 - Direct UserAgent to Authorize endpoint</a></span>
                                                    <div class="MCDropDownBody dropDownBody">
                                                        <p>Direct the UserAgent to the<span style="color: #ff0000;"><span style="font-family: 'Courier New';"> /oauth2/v1/authorize</span> </span>endpoint providing the signed JWT as the request</p>
                                                        <p><pre>GET $base_url<span style="color: #ff0000;">/oauth2/v1/authorize</span>?request=&lt;signed JWT request&gt;</pre>
                                                        </p>
                                                        <ul>
                                                            <li value="1">If you are using a browser to navigate to the above URL then it is recommended to have the response_mode set to "form_post"</li>
                                                            <li value="2">If post message is used to post the signed id token back then the parent frame will receive the id token as a posted message. If "form_post" was used the id token will be posted to the redirect URI specified on the app. The signed token will be received after a user successfully completes authentication/mfa validation on Okta.</li>
                                                            <li value="3">The application backend should take the id token and validate it using the keys got from - <a href="https://org.okta.com/oauth2/v1/keys">https://org.okta.com/oauth2/v1/keys</a> and use the kid specified in the response jwt header as the index into the response of "/oauth2/v1/keys". And finally it also should make sure that the nonce on the signed token is same as what it has (stored in initial steps above) for the authentication transaction.</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Step 3 - User navigates Okta MFA flow</a></span>
                                                    <div class="MCDropDownBody dropDownBody">
                                                        <p>The user will be presented with an Okta MFA challenge, this will eventually include factor enrollment driven by enrollment policies in Okta.</p>
                                                        <ol>
                                                            <li value="1">Factor selection</li>
                                                            <ul>
                                                                <li value="1">Multiple factor support</li>
                                                                <li value="2">Multiple factor provider</li>
                                                                <li value="3">Defaults to last used</li>
                                                            </ul>
                                                            <p>
                                                                <img src="../../Resources/Images/odic_service7.png" />
                                                            </p>
                                                            <li value="2">
                                        Factor challenge/Response
                                    </li>
                                                            <ul>
                                                                <li value="1">
                                                                    <p>Challenge resp flow varies by factor type and provider</p>
                                                                </li>
                                                            </ul>
                                                            <p>
                                                                <img src="../../Resources/Images/odic_service8.png" />
                                                            </p>
                                                            <li value="3">
                                                                <p>Factor Enrollment and Recovery (FEaR)</p>
                                                            </li>
                                                            <ul>
                                                                <li value="1">
                                                                    <p>The problem you didnâ€™t even know you had</p>
                                                                </li>
                                                                <li value="2">
                                                                    <p>Okta provides <a href="../Security/MFA.htm#MultifactorPolicies">extensible policies</a> to control this behavior</p>
                                                                </li>
                                                            </ul>
                                                            <p>
                                                                <img src="../../Resources/Images/odic_service9.png" />
                                                            </p>
                                                        </ol>
                                                        <p>Once the user has successfully satisfied the MFA challenge the UserAgent will be provided an id_token to deliver to the application (RP).</p>
                                                    </div>
                                                </div>
                                                <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Step 4 - UserAgent redirected to calling app</a></span>
                                                    <div class="MCDropDownBody dropDownBody">
                                                        <p>At this point in the flow the UserAgent (browser) is sent to the requested redirect_uri with the id_token in the requested response_mode (fragment shown).</p>
                                                        <p style="color: #0000ff;">If a state claim was included in the request JWT the value will be included in the response.  The requested response_mode will dictate how, show below is an example where the response mode is fragment.</p>
                                                        <p style="font-weight: bold;">Example Redirect:</p>
                                                        <p><pre>GET $redirect_uri#id_token=&lt;signed_id_token&gt;&amp;state=&lt;requested_state&gt;</pre>
                                                        </p>
                                                        <p style="font-weight: bold;">Sample redirect, id_token and state</p>
                                                        <div style="width: 100%;padding-left: 8px;padding-right: 8px;padding-top: 4px;padding-bottom: 6px;border-left-style: solid;border-left-width: 1px;border-right-style: solid;border-right-width: 1px;border-top-style: solid;border-top-width: 1px;border-bottom-style: solid;border-bottom-width: 1px;">
                                                            <p><span style="font-family: 'Courier New';">GET</span>
                                                            </p>
                                                            <p style="font-family: 'Courier New';">https://okta-box.herokuapp.com/#idtoken=<span style="color: #ff8c00;">eyJraWQiOiIxWDhHa2tNUlZTS2xTaThQTmtjOXBiaTZ0c0</span><br style="color: #ff8c00;" /><span style="color: #ff8c00;">szZTBrVllQUUs1U3M0bGZVIiwiYWxnIjoiUlMyNTYifQ</span><span style="color: #0000ff;">.eyJzdWIiOiIwMHVla21qZWMycldna2pPVjBoNyIsIn</span><br style="color: #0000ff;" /><span style="color: #0000ff;">ZlciI6MSwiaXNzIjoiaHR0cHM6Ly9ib3h3b3Jrcy5va3RhcHJldmlldy5jb20iLCJhdWQiOiIwb2FlazIyZjNndl</span><br style="color: #0000ff;" /><span style="color: #0000ff;">RWdnFiVzBoNyIsImlhdCI6MTUyNTE5MDY4MCwiZXhwIjoxNTI1MTk0MjgwLCJqdGkiOiJJRC5BQ1U3eExvNWEwL</span><br style="color: #0000ff;" /><span style="color: #0000ff;">TBXVVJfN0N3emJodk5vWHVUY1lWT3VzTUFwYjlQSGJjIiwiYW1yIjpbImtiYSIsIm1mYSJdLCJhY3IiOiJ1cm46</span><br style="color: #0000ff;" /><span style="color: #0000ff;">b2t0YTphcHA6bWZhOmF0dGVzdGF0aW9uIiwibm9uY2UiOiJoM2xYMjkkc1dHeEszIiwiYXV0aF90aW1lIjoxNTI</span><br style="color: #0000ff;" /><span style="color: #0000ff;">1MTkwNjgwfQ.</span><span style="color: #ff0000;">QugchXrFACKM18NQ-3qJO4GQIzRs8MwNq6jVRoj9HOm_55uEJ6F6Vkuu_GS7Xjw7zem49RYn1VXsh3F68T9LZmDtjQRhiAP0Vk7rPBOi3SilUAPDFTaRxku9mAzYCxKYJ_najBQY-mfvRYT7VyPocII0YF0Hc5gXtzFCcMMNnpLFz1tg7k9UXRrkJvJxq3FL9w0AFYp9zt_WrihVowOBZ5ZAtrRQ-TW7Sae3a6Bpit7vDVbDL0VYPbUispD_nzm_64O2dILjRQ7OHJRuHoNl_3lCkbqztXOJX9Kk7TeQhPo5VTBa8Ll7pU_Ym7DXfjeXvKEot4I6yVlWrWXzeoWgfA</span>&amp;state=assetID_12345</p>
                                                        </div>
                                                        <p style="font-weight: bold;">Decoded id_token</p>
                                                        <div style="width: 100%;padding-left: 8px;padding-right: 8px;padding-top: 4px;padding-bottom: 6px;border-left-style: solid;border-left-width: 1px;border-right-style: solid;border-right-width: 1px;border-top-style: solid;border-top-width: 1px;border-bottom-style: solid;border-bottom-width: 1px;">
                                                            <p><pre xml:space="preserve">
{</pre><pre xml:space="preserve">  "sub": "00uekmjec2rWgkjOV0h7",
  "ver": 1,
  "iss": "https://boxworks.oktapreview.com",
  "aud": "0oaek22f3gvTVvqbW0h7",
  "iat": 1525190680, 
  "exp": 1525194280,
  "jti": "ID.ACU7xLo5a0-0WUR_7CwzbhvNoXuTcYVOusMApb9PHbc",
  "amr": [
  "kba",
  "mfa"
],
  "acr": "urn:okta:app:mfa:attestation",
  "nonce": "h3lX29$sWGxK3",   
  "auth_time": 1525190680
}
</pre>
                                                            </p>
                                                        </div>
                                                        <p style="font-weight: bold;">Annotated id_token</p>
                                                        <div style="width: 100%;padding-left: 8px;padding-right: 8px;padding-top: 4px;padding-bottom: 6px;border-left-style: solid;border-left-width: 1px;border-right-style: solid;border-right-width: 1px;border-top-style: solid;border-top-width: 1px;border-bottom-style: solid;border-bottom-width: 1px;">
                                                            <p><pre xml:space="preserve">
{
  "sub": "Identifier of okta user",
  "ver": 1,  
  "iss": "Okta tenant name",
  "aud": "Okta application identifier, aka client_id", 
  "iat": time MFA challenge was satisfied,
  "exp": time to consider id_token expired,
  "jti": "Unique JWT ID",
  "amr": [
  "Array of <a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">Authentication<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>Authentication is distinct from authorization, which is the process of giving individuals access to system objects based on their identity. Authentication merely ensures that the individual is who he or she claims to be, but says nothing about the access rights of the individual.

Authentication methods and protocols include direct auth, delegated auth, SAML, SWA, WS-Fed, and OpenID Connect.</span></a> method identifiers",
  "mfa", "hwk"
],
  "acr": "Authentication context",
  "nonce": "nonce from request",
  "auth_time": time MFA challenge was satisfied
}
</pre>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Step 5 - Validate the response</a></span>
                                                    <div class="MCDropDownBody dropDownBody">
                                                        <p>To ensure the validity of the response received from the UserAgent the application (RP) should validate the response using one of the following methods.</p>
                                                        <p>Ensure that the value(s) returned in the amr satisfy the needs of your request.  This is an attestation of what authentication methods Okta used.  A list of valid responses and their meaning can be found here (https://developer.okta.com/docs/api/resources/sessions#amr-object)</p>
                                                        <p>An empty amr is an indication that the policy configured created a condition where no MFA was performed</p>
                                                        <p>For more detailed information please refer to <a href="https://developer.okta.com/authentication-guide/tokens/validating-id-tokens">Validating ID Tokens.</a></p>
                                                        <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Method 1 - Verify the signature of the id_token locally</a></span>
                                                            <div class="MCDropDownBody dropDownBody">
                                                                <p>The high-level overview of validating an ID token looks like this:</p>
                                                                <ul>
                                                                    <li value="1">Retrieve and parse your Okta JSON Web Keys (JWK)<ul><li value="1">These should be checked periodically and cached by your application</li></ul></li>
                                                                    <li value="2">Decode the ID token, which is in JSON Web Token format</li>
                                                                    <li value="3">Verify the signature used to sign the ID token<ul><li value="1">The JWT header will indicate the Key Identifier (kid) and algo used (â€˜rs256â€™)</li></ul></li>
                                                                    <li value="4">Verify the claims found inside the ID token</li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                        <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Method 2 - Verify the signature of the id_token locally remotely</a></span>
                                                            <div class="MCDropDownBody dropDownBody">
                                                                <p>Alternatively, you can also validate an ID Token using the <a href="https://developer.okta.com/docs/api/resources/oidc#introspect">Token Introspection endpoint</a>. This endpoint takes your id_token as a URL query (token=&lt;id_token_jwt&gt;) and returns back a JSON response with a boolean active property. If active is true then further information about the token is returned as well.</p>
                                                                <p>This incurs a network request which is slower to do verification, but can be used when you want to guarantee that the access token hasnâ€™t been revoked.</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <h2>References and Notes</h2>
                                                <ul>
                                                    <li value="1">Okta specific OIDC documentation can be found <a href="https://developer.okta.com/docs/api/resources/oidc#authorize">here</a></li>
                                                    <li value="2">Online JWT Encode and Decode tools with tips can be found here: <a href="https://www.jsonwebtoken.io/">https://www.jsonwebtoken.io/</a></li>
                                                </ul>
                                                <p>Nonce implementation notes: <a href="http://openid.net/specs/openid-connect-core-1_0.html#NonceNotes">http://openid.net/specs/openid-connect-core-1_0.html#NonceNotes</a></p>
                                                <p>The requesting application (RP) should bind the nonce to the "session" its own side (by generating the nonce from a hash of the local "session id" if possible). It should then verify that the nonce which came back inside the signed ID token matches the one it sent in on the authorize request.</p>
                                                <p>Request exp should allow sufficient time for clock skew and latency</p>
                                                <!-- Back to Top button --><a href="#" class="sf-back-to-top"><span class="arrow"></span>Top</a>
                                            </div>
                                        </div>
                                        <!-- *** Col3: Right menu Col *** -->
                                        <div class="is-not-in-mobile">
                                        </div>
                                    </div>
                                    <!-- ***************************** Footer rows ********************************* -->
                                    <div class="footer-temp">
                                        <div class="is-not-in-mobile">
                                            <p> </p>
                                        </div>
                                        <div>
                                            <p class="copyright">Â©  <span class="okta-variablesYear">2019</span> <span class="okta-variablesCompanyName">Okta, Inc</span> All Rights Reserved. Various trademarks held by their respective owners.</p>
                                        </div>
                                    </div>
                                    <!-- ***************************** Scripts ************************************* -->
                                    <!-- Foundation -->
                                    <script src="../../Resources/Scripts/js/app.js">
                                    </script>
                                    <script src="../../Resources/Scripts/js/vendor/what-input.js">
                                    </script>
                                    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.4.4-rc1/js/foundation.min.js">
                                    </script>
                                    <!-- Ours -->
                                    <script type="text/javascript" src="../../Resources/Scripts/back-to-top.js">
                                    </script>
                                    <script type="text/javascript" src="../../Resources/Scripts/get-feedback.js">
                                    </script>
                                    <!-- Coveo -->
                                    <script src="https://static.cloud.coveo.com/searchui/v2.5395/js/CoveoJsSearch.Lazy.min.js">
                                    </script>
                                    <script src="../../Resources/Scripts/coveo-resources/js/cultures/en.js" id="coveoCultureScript">
                                    </script>
                                    <script src="../../Resources/Scripts/coveo-resources/js/Coveo.MadcapFlare.RequireJS.js" id="coveoRequireScript">
                                    </script>
                                    <script src="../../Resources/Scripts/coveo-resources/js/Coveo.MadcapFlare.Okta.js" id="coveoInitscript">
                                    </script>
                                </div>
                            </div>
                        </div>
                    </section><a data-close="true"></a>
                </div>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>