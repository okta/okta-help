<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_okta_html5_topnav" data-mc-search-type="Stem" data-mc-help-system-file-name="okta_help.xml" data-mc-path-to-help-system="../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" /><title>Using the Confluence On Premises SAML App</title>
        <link rel="shortcut icon" href="../../Resources/Images/favicon.ico" type="image/x-icon" />
        <script>/* <![CDATA[ */
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

			ga('create', 'UA-15777010-10', 'auto');
			ga('send', 'pageview');

		/* ]]> */</script>
        <link href="../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/foundation.5.5.0.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Resources/Stylesheets/okta-help.css" rel="stylesheet" />
        <link href="../../Resources/Stylesheets/okta-help-MainStyles.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.separator-button
{
	-pie-background: linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.expand-all-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/expand.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.collapse-all-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/collapse.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <script src="../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/foundation.5.5.0_custom.js">
        </script>
        <script src="../../../Resources/Scripts/foundation.offcanvas.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap">
            <div class="off-canvas-wrap" data-offcanvas="">
                <section class="inner-wrap">
                    <nav class="tab-bar" data-mc-ignore="true">
                        <section class="middle tab-bar-section outer-row clearfix">
                            <div class="relative clearfix"><a class="logo" href="../Overview.htm" alt="Okta"></a>
                                <div class="navigation-wrapper">
                                    <ul class="navigation clearfix">
                                        <li class="has-children"><a href="#">Okta-docs</a>
                                            <ul class="sub-menu">
                                                <li><a href="../Dashboard/Dashboard.htm">Dashboard</a>
                                                </li>
                                                <li class="has-children"><a href="../Directory/Directory.htm">Directory</a>
                                                    <ul class="sub-menu">
                                                        <li><a href="../Directory/Directory_People.htm">People</a>
                                                        </li>
                                                        <li><a href="../Directory/Directory_Groups.htm">Groups</a>
                                                        </li>
                                                        <li><a href="../Directory/Directory_Profile_Editor.htm">Profile Editor</a>
                                                        </li>
                                                        <li><a href="../Directory/Directory_Directory_Integrations.htm">Directory Integrations</a>
                                                        </li>
                                                        <li><a href="../Directory/Directory_Profile_Masters.htm">Profile Masters</a>
                                                        </li>
                                                        <li><a href="../Directory/Reference_Directories.htm">Directory Reference Topics</a>
                                                        </li>
                                                    </ul>
                                                </li>
                                                <li class="has-children"><a href="Apps_Apps.htm">Apps</a>
                                                    <ul class="sub-menu">
                                                        <li><a href="Apps_Apps_Page.htm">Using the Applications Page</a>
                                                        </li>
                                                        <li><a href="Apps_App_Integration_Wizard.htm">Using the App Integration Wizard</a>
                                                        </li>
                                                        <li><a href="Access_Request_Workflow.htm">Access Request Workflow</a>
                                                        </li>
                                                        <li><a href="../Mobile/Apps_Okta_Mobile.htm">Using Okta Mobile</a>
                                                        </li>
                                                    </ul>
                                                </li>
                                                <li class="has-children"><a href="../Security/Security_at_Okta.htm">Security</a>
                                                    <ul class="sub-menu">
                                                        <li><a href="../Security/Security_General.htm">General</a>
                                                        </li>
                                                        <li><a href="../Security/Security_Policies.htm">Security Policies</a>
                                                        </li>
                                                        <li><a href="../Security/Security_Authentication.htm">Authentication</a>
                                                        </li>
                                                        <li><a href="../Security/MFA.htm">Multifactor</a>
                                                        </li>
                                                        <li><a href="../Security/Identity_Providers.htm">Identity Providers</a>
                                                        </li>
                                                        <li><a href="../Security/Security_Network.htm">Network</a>
                                                        </li>
                                                        <li><a href="../Security/Administrators.htm">Administrators</a>
                                                        </li>
                                                        <li><a href="../Security/API.htm">API</a>
                                                        </li>
                                                        <li><a href="../Security/API_Access.htm">API Access Management</a>
                                                        </li>
                                                        <li><a href="https://support.okta.com/help/answers#!/feedtype=RECENT&amp;dc=xSecurity&amp;criteria=BESTANSWERS">Community: Security Discussions</a>
                                                        </li>
                                                        <li><a href="https://support.okta.com/help/articles/Knowledge_Article/A-Quick-Look-at-Securing-Okta">Video: A Quick Look at Securing Okta</a>
                                                        </li>
                                                    </ul>
                                                </li>
                                                <li class="has-children"><a href="../Reports/Reports.htm">Reports</a>
                                                    <ul class="sub-menu">
                                                        <li><a href="../Reports/Reports_SysLog.htm">System Log</a>
                                                        </li>
                                                    </ul>
                                                </li>
                                                <li><a href="../Mobile/Okta_Mobile_Connect.htm">Mobile</a>
                                                </li>
                                                <li class="has-children"><a href="../Settings/Settings.htm">Settings</a>
                                                    <ul class="sub-menu">
                                                        <li><a href="../Settings/Settings_Account.htm">Account</a>
                                                        </li>
                                                        <li><a href="../Settings/Settings_Appearance.htm">Appearance</a>
                                                        </li>
                                                        <li><a href="../Settings/Settings_Customization.htm">Customization</a>
                                                        </li>
                                                        <li><a href="../Settings/Settings_Email.htm">Email and SMS Options</a>
                                                        </li>
                                                        <li><a href="../Settings/Settings_Downloads.htm">Downloads</a>
                                                        </li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </li>
                                        <li><a href="https://support.okta.com">Support</a>
                                        </li>
                                    </ul>
                                </div><a class="menu-icon right-off-canvas-toggle" href="#"><span></span></a>
                            </div>
                        </section>
                        <div class="nav-search row outer-row">
                            <form class="search" action="#">
                                <div class="search-bar search-bar-container needs-pie">
                                    <input class="search-field needs-pie" type="search" placeholder="Search" />
                                    <div class="search-filter-wrapper">
                                        <div class="search-filter">
                                            <div class="search-filter-content">
                                                <ul>
                                                    <li>All Files</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="search-submit-wrapper" dir="ltr">
                                        <div class="search-submit" title="Search">
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </nav>
                    <aside class="right-off-canvas-menu" data-mc-ignore="true">
                        <ul class="off-canvas-list" data-mc-back-link="Back" data-mc-css-tree-node-expanded="has-submenu" data-mc-css-tree-node-collapsed="has-submenu" data-mc-css-sub-menu="right-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.fndtn.offcanvas" data-mc-toc="True">
                        </ul>
                    </aside>
                    <section class="main-section">
                        <div class="row outer-row" data-mc-content-body="True">
                            <div class="content">
                                <div id="contentBody">
                                    <div class="row collapse">
                                        <div class="sideContent">
                                            <div class="clearfix">
                                                <div class="buttons popup-container clearfix topicToolbarProxy _Skins_okta_toolbar mc-component">
                                                    <div class="button-group-container-left">
                                                        <div class="button-separator">
                                                        </div>
                                                        <button class="button needs-pie print-button" title="Print">
                                                            <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                                        </button>
                                                        <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                                            <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <h1>Using the Confluence On Premises SAML App</h1>
                                        <p>Okta provides not only the Confluence Web application, accessible through the <a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">OAN<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>An acronym for the Okta Application Network. The OAN is comprised of thousands of public, pre-integrated business and consumer applications. As an on-demand service, OAN integrations are continuously validated, always up to date, and constantly growing both in number and capability. Okta performs a single integration with an ISV or SP, providing thousands of end users with point-and-click customization for their orgs.</span></a>, but also allows for single sign-on integration between Okta and an on-premise version of Confluence. To use this feature, Okta is providing a custom authenticator for use with Confluence, which must be installed on the Confluence server. The <a href="/articles/Knowledge_Article/29604938-Current-Confluence-Jar-Version-History" target="_blank">Current Confluence Jar Version History</a> article shows the Confluence on-premise versions that support recent versions of the JAR. You can access the latest version of the <strong>okta-confluence.jar</strong> file from the Okta <strong>Downloads</strong> page. <em>Download this file before you begin the integration. </em></p>
                                        <p>Single Sign-on Integration with JIRA and Confluence on the Atlassian website for more information about Confluence custom authenticators.</p>
                                        <h2>Adding the On-Premise App to Okta</h2>
                                        <p>The first step towards integration is to create the <a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">app<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>An abbreviation of application. Essentially, it is a web-based site used to perform any number of specific tasks, and requires authentication from end users by signing in.</span></a> within Okta.</p>
                                        <p>1. As an administrator, go to the <strong>Applications</strong> tab.</p>
                                        <p>2. Click the <strong>Add Application</strong> button and choose <strong>Confluence On-Premise <a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">SAML<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>An acronym for Security Assertion Markup Language, SAML is an XML-based standard for exchanging authentication and authorization data between an identity provider (IdP) and a service provider (SP). The SAML standard addresses issues unique to the single sign-on (SSO) solution, and defines three roles: the end user, the IDP, and the SP.</span></a></strong>.</p>
                                        <p>3. On the <strong>General Settings</strong> page, enter your Confluence URL, then click <strong>Next</strong>.</p>
                                        <p>
                                            <img alt="User-added image" src="../../Resources/Images/saml config 1_796x392.jpeg" style="width: 796;height: 392;" />
                                        </p>
                                        <p>4. On the<strong> Assign To People</strong> page, assign your <a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">users<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>In Okta literature, we generally refer to "users" as the people who serve as Okta administrators. When we refer to "end users" we are generally referring to the people who the administrators serve. I.e., those who use Okta chiclets to access their apps, but have no administrative control.</span></a>. These users will have access to the Confluence instance.</p>
                                        <p>5.  Click <strong>Next</strong>.</p>
                                        <p>6. Within the <strong>Username</strong> field, associate your Okta user with the username used on the Confluence server, as shown below.</p>
                                        <p>
                                            <img alt="Confluenc1.jpg" src="../../Resources/Images/saml config 2_834x572.jpeg" style="width: 834;height: 572;" />
                                        </p>
                                        <p>7. Click the <strong>Done</strong> button. The <strong>Home</strong> page of the newly created app appears.</p>
                                        <p>8. Click the <strong>Sign On</strong> tab and, under <strong>Settings</strong>, click the link in the yellow box to view <strong>SAML 2.0 setup instructions for Confluence On-Premise SAML</strong>, as<br />		shown below.</p>
                                        <p>
                                            <img alt="User-added image" src="../../Resources/Images/saml config 3_830x454.jpeg" style="width: 830;height: 454;" />
                                        </p>
                                        <h2>Configure the Confluence On-Premise App</h2>
                                        <p>After clicking the instruction link, the configuration page appears.</p>
                                        <p>1. Using the <strong><a href="javascript:void(0);" class="MCTextPopup MCTextPopupHotSpot MCTextPopup_Open MCTextPopupHotSpot_ MCTextPopupHotSpot_Popup #text #textPopup">IDP<span class="MCTextPopupBody popupBody"><span class="MCTextPopupArrow"></span>An acronym for Identity Provider. It is a service that manages end user accounts analogous to user directories such as LDAP and Active Directory, and can send SAML responses to SPs to authenticate end users. Within this scenario, the IdP is Okta.</span></a> metadata</strong> text from <strong>step</strong> <strong>1</strong> of the <strong>SAML 2.0 instructions for Confluence On-Premise SAML</strong> shown below, youâ€™ll need to create an .xml<br />		configuration file called <strong>okta-config-confluence.xml</strong>.</p>
                                        <p>
                                            <img alt="ConfluenceSAML.jpg" src="../../Resources/Images/saml config 4_822x368.jpeg" style="width: 822;height: 368;" />
                                        </p>
                                        <p>2. On the Confluence server, paste this newly populated <strong>okta-config-confluence.xml </strong>file into &lt;<strong>okta-directory-on-confluence-server</strong>&gt;. E.g., <strong>/opt/okta/.</strong></p>
                                        <p>3. There is a file named <strong>seraph-config.xml</strong> which can be found on the Confluence server in [confluence_webdir]/WEB-INF/classes/<strong>seraph-config.xml</strong>. From<br />		within this file, do the following:</p>
                                        <p>    a. Find the <strong>login.url</strong> <em>param-name</em> and set it's <em>param-value</em> to the text displayed within the box field.</p>
                                        <p>    b. Search for the  "&lt;<strong>authenticator class ...</strong>&gt; " line and replace it with the following:</p>
                                        <p>        &lt;authenticator class= "com.atlassian.confluence.authenticator.okta.OktaConfluenceAuthenticator "&gt;</p>
                                        <p>             &lt;init-param&gt;</p>
                                        <p>                 &lt;param-name&gt;okta.config.file&lt;/param-name&gt;</p>
                                        <p>                 &lt;param-value&gt;<strong style="color: #800000;">/path/to/your/okta-config-confluence.xml</strong>&lt;/param-value&gt;</p>
                                        <p>             &lt;/init-param&gt;</p>
                                        <p>        &lt;/authenticator&gt;</p>
                                        <p>4. Take your downloaded <strong>okta-confluence.jar</strong> file and copy it to the <strong>[confluence_webdir]/WEB-INF/lib</strong> directory.</p>
                                        <p>5. Restart your Confluence service, and you are done! </p>
                                        <h3>Optional - Filter User Access by IP Address, User Name, or Group Name</h3>
                                        <p class="p1">You can specify whether SAML authentication or service provider authentication is used by IP address, user name, or group name. This option is set in the okta-config-confluence.xml file in the following tags.</p>
                                        <p>The portions highlighted in blue in following code shows the relevant sections of an okta-config-confluence.xml file.</p>
                                        <p>&lt;configuration&gt;<br />			&lt;applications&gt;<br />			&lt;application&gt;<br />			&lt;md:EntityDescriptor ...&gt;....&lt;/md:EntityDescriptor&gt;<br />			&lt;/application&gt;<br />			&lt;/applications&gt;<br /><font color="blue">&lt;!--<br />		The IP range in the &lt;oktaUsers&gt; tag specifies the IP addresses that use the SAML toolkit for authentication. The values in the &lt;ipFrom&gt; and &lt;ipTo&gt; tags specify IP addresses. These tags can contain full IP addresses as shown below or a mask such as 182.0.*.* . The &lt;ipTo&gt; tag is optional. Omit it if the range is completely specified in the &lt;ipFrom&gt; tag. This range has higher priority than the range specified in the &lt;spUsers&gt; tag below.</font></p>
                                        <p><font color="blue">The IP range in the &lt;spUsers&gt; tag specifies the IP addresses that use the native service provider authentication. The values in the &lt;ipFrom&gt; and &lt;ipTo&gt; tags specify IP addresses, and work as described above. This range has low priority than the range specified in the oktaUsers&gt; tag above.</font>
                                        </p>
                                        <p><font color="blue"> </font>
                                        </p>
                                        <p><font color="blue">&lt;allowedAddresses&gt;<br />				&lt;oktaUsers&gt;<br />				&lt;ipFrom&gt;192.168.3.10&lt;/ipFrom&gt;<br />				&lt;ipTo&gt;192.168.3.220&lt;/ipTo&gt;<br />				&lt;/oktaUsers&gt;<br />				&lt;spUsers&gt;<br />				&lt;ipFrom&gt;*.*.*.*&lt;/ipFrom&gt;<br />				&lt;ipTo&gt;*.*.*.*&lt;/ipTo&gt;<br />				/spUsers&gt;<br />		&lt;/allowedAddresses&gt;</font>
                                        </p>
                                        <p><font color="blue"> </font>
                                        </p>
                                        <p><font color="blue">&lt;!--The values in the &lt;username&gt; tags contained in the &lt;spUsers&gt; tag specify usernames to process with the native service provider authentication. Any number of &lt;username&gt;&lt;/username&gt; tags are permitted.<br />		--&gt;</font>
                                        </p>
                                        <p><font color="blue"> </font>
                                        </p>
                                        <p><font color="blue">&lt;spUsers&gt;<br />				&lt;username&gt;john.doe@acme.com&lt;/username&gt;<br />				&lt;username&gt;john.smith@acme.com&lt;/username&gt;<br />				&lt;username&gt;jira.user@acme.com&lt;/username&gt;<br />				&lt;username&gt;confluence.user@acme.com&lt;/username&gt;<br />		&lt;/spUsers&gt;</font>
                                        </p>
                                        <p><font color="blue"> &lt;!--<br />				The values in the &lt;groupname&gt; tags contained in the &lt;spGroups&gt; tag specify group names to process with the native service provider authentication. Any number of &lt;groupname&gt;&lt;/groupname&gt; tags are permitted.<br />		--&gt;</font>
                                        </p>
                                        <p><font color="blue"> </font>
                                        </p>
                                        <p><font color="blue"> </font>
                                        </p>
                                        <p><font color="blue">&lt;spGroups&gt;<br />				&lt;groupname&gt;jira-grp&lt;/groupname&gt;<br />				&lt;groupname&gt;confluence-grp&lt;/groupname&gt;<br />		&lt;/spGroups&gt;</font>
                                        </p>
                                        <p><font color="blue"> </font>
                                        </p>
                                        <p>&lt;/configuration&gt;</p>
                                        <h3>Processing Details</h3>
                                        <p>If there are any duplications in IP addresses or if an IP address is inadvertently excluded, the following four rules determine the processing procedure.</p>
                                        <ul>
                                            <li value="1">If a user is matched in both ranges, the SAML toolkit is used for authentication.</li>
                                            <li value="2">If the &lt;allowedAddresses&gt; tag is not present, the SAML toolkit is used for authentication.</li>
                                            <li value="3">If user is not matched in either range,  the SAML toolkit is used for authentication.</li>
                                            <li value="4">The native Confluence authenticator (the service provider authenticator) is used only if a user is matched in the  &lt;spUsers&gt; range and not in the &lt;oktaUsers&gt; range.</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section><a class="exit-off-canvas"></a>
                </section>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>