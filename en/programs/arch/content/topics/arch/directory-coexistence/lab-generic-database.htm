<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_okta_html5_topnav_nav_poc" data-mc-search-type="Stem" data-mc-help-system-file-name="okta_help.xml" data-mc-path-to-help-system="../../../../" data-mc-has-content-body="True" data-mc-searchable="True" data-mc-toc-path="[%=System.LinkedHeader%]|[%=System.LinkedHeader%]" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="robots" content="noindex, nofollow" />
        <meta name="typeofcontent" content="documentation" />
        <meta name="audience" content="admin" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Migrate users from an on-premises generic database | Okta</title>
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, height=device-height" />
        <link rel="shortcut icon" href="../../../Resources/Images/favicon.ico" type="image/x-icon" />
        <!-- Google Tag Manager -->
        <!-- End Google Tag Manager -->
        <!-- Google Tag Manager -->
        <!-- End Google Tag Manager -->
        <!-- Pendo Script (Per Chris Bank) -->
        <!-- End Pendo Script -->
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Fluid/stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Fluid/stylesheets/styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Fluid/stylesheets/tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Fluid/stylesheets/mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.5395/css/CoveoFullSearchNewDesign.css" />
        <style>/*&lt;meta /&gt;*/

.button.select-language-button
{
	-pie-background: linear-gradient(#ffffff, #ffffff);
}

.needs-pie
{
	behavior: url('../../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../../resources/stylesheets/okta-main-new-nav.css" rel="stylesheet" type="text/css" />
        <script src="../../../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js" type="text/javascript">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
        <script>
			/* <![CDATA[ */
			(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
			})(window,document,'script','dataLayer','GTM-NMZZV4P');
			/* ]]> */
		</script>
        <script>
			/* <![CDATA[ */
			(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
			})(window,document,'script','dataLayer','GTM-KXMLV58');
			/* ]]> */
		</script>
        <script>
		/* <![CDATA[ */
		(function(apiKey){
			(function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
			v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
			o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
			y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
			z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id:              'VISITOR-UNIQUE-ID'
            },
            account: {
                id:           'ACCOUNT-UNIQUE-ID'
            }
        });
		})('a9bd3885-93ae-46ab-700b-dd29e613c19d');
		/* ]]> */
        function openSurvey() {
            window.open('https://surveys.okta.com/jfe/form/SV_e4L0iW8a3tz8Yol?source=' + encodeURIComponent(document.location.href), '_blank');
        }
		</script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" role="banner" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1024px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="https://help.okta.com/okta_help.htm?id=csh-index" alt="Okta"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="2" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <!-- Google Tag Manager (noscript) -->
                                    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NMZZV4P" height="0" width="0" style="display:none;visibility:hidden"></iframe>
                                    </noscript>
                                    <!-- End Google Tag Manager (noscript) -->
                                    <!-- Google Tag Manager (noscript) -->
                                    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KXMLV58" height="0" width="0" style="display:none;visibility:hidden"></iframe>
                                    </noscript>
                                    <!-- End Google Tag Manager (noscript) -->
                                    <!-- Coveo config parameters -->
                                    <div id="coveo_org_id" style="Display:None"><span class="mc-variable okta-coveo-config.OrgId variable">oktaproduction9ounvcxa</span>
                                    </div>
                                    <div id="coveo_rest_uri" style="Display:None"><span class="mc-variable okta-coveo-config.PlatformRestUri variable">https://platform.cloud.coveo.com/rest/search</span>
                                    </div>
                                    <div id="coveo_search_url" style="Display:None"><span class="mc-variable okta-coveo-config.SearchPageUrl variable">https://support.okta.com/help/s/global-search/%40uri</span>
                                    </div>
                                    <div id="coveo_token_url" style="Display:None"><span class="mc-variable okta-coveo-config.SearchTokenServiceUrl variable">https://support.okta.com/help/services/apexrest/PublicSearchToken?site=help</span>
                                    </div>
                                    <div id="coveo_dev_org_id" style="Display:None"><span class="mc-variable okta-coveo-config.DevOrgId variable">oktanonproduction1il1gtac7</span>
                                    </div>
                                    <div id="coveo_dev_token" style="Display:None"><span class="mc-variable okta-coveo-config.DevSearchToken variable">xxf1de37f5-c8aa-42db-a8ef-0cbf06dfa5e3</span>
                                    </div>
                                    <!-- End Coveo config parameters -->
                                    <!-- ************** Coveo Search bar ************************************* -->
                                    <!-- set margin and size in /Content/Resources/Scripts/coveo-resources/css/Coveo.Okta.StandaloneSearchbox.min.css to make room for replacing Flare-generated top-nav with HTML code (see below)-->
                                    <div id="OLC_Coveo_Headline" class="coveo-headline-wrapper" data-mc-conditions="MultiProdPublish.SearchBar">
                                        <div class="slds-p-vertical_small">
                                            <!--Search Bar-->
                                            <div class="slds-grid slds-grid_align-center">
                                                <div id="customSelect" class="CoveoCustomSelect slds-float_right">
                                                </div>
                                                <div id="standaloneSearchbox">
                                                    <div class="CoveoAnalytics" data-search-hub="OktaCommunityFullSearch">
                                                    </div>
                                                    <div class="CoveoTab" data-id="Help" data-caption="Help" style="display:none">
                                                    </div>
                                                    <div class="CoveoSearchbox" data-enable-omnibox="true" data-enable-query-suggest-addon="true">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="replace_top_nav">
                                        <div class="navbar" data-mc-conditions="Primary.live-site-only">
                                            <div class="dropdown" data-test="menuBarCategory" id="documentationMenu" data-mc-conditions="MultiProdPublish.DocMenu">
                                                <button class="dropbtn">Documentation <i class="fa fa-caret-down"></i></button>
                                                <div class="dropdown-content" data-test="menuBarItems">
                                                    <div><a href="https://help.okta.com/okta_help.htm?type=oie&amp;id=oie-index" data-test="menuBarLink">Identity Engine</a>
                                                    </div>
                                                    <div><a href="https://help.okta.com/okta_help.htm?id=index-admin" data-test="menuBarLink">Classic Engine</a>
                                                    </div>
                                                    <div><a href="https://help.okta.com/okta_help.htm?type=oag&amp;id=ext_oag_main" data-test="menuBarLink">Access Gateway</a>
                                                    </div>
                                                    <div><a href="https://help.okta.com/okta_help.htm?type=asa&amp;id=csh-asa-overview" data-test="menuBarLink">Advanced Server Access</a>
                                                    </div>
                                                    <div><a href="https://help.okta.com/okta_help.htm?type=wf&amp;id=ext-Okta-workflows" data-test="menuBarLink">Workflows</a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="dropdown" data-test="menuBarCategory" id="relnotesMenu" data-mc-conditions="MultiProdPublish.DocMenu">
                                                <button class="dropbtn">Release notes <i class="fa fa-caret-down"></i></button>
                                                <div class="dropdown-content" data-test="menuBarItems">
                                                    <div><a href="https://help.okta.com/okta_help.htm?type=oie&amp;id=csh-oie-release-notes" data-test="menuBarLink">Identity Engine</a>
                                                    </div>
                                                    <div><a href="https://help.okta.com/okta_help.htm?id=ext_okta_relnotes" data-test="menuBarLink">Classic Engine</a>
                                                    </div>
                                                    <div><a href="https://help.okta.com/okta_help.htm?type=oag&amp;id=ext_oag_releasenotes" data-test="menuBarLink">Access Gateway</a>
                                                    </div>
                                                    <div><a href="https://help.okta.com/okta_help.htm?type=asa&amp;id=ext-asa-releasenotes" data-test="menuBarLink">Advanced Server Access</a>
                                                    </div>
                                                    <div><a href="https://help.okta.com/okta_help.htm?type=wf&amp;id=ext-workflows-releasenotes" data-test="menuBarLink">Workflows</a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="dropdown" data-test="menuBarCategory" id="oktaDevDocsMenu"><a href="https://developer.okta.com/" target="_blank" data-test="menuBarLink">Okta Developer</a>
                                            </div>
                                            <div class="dropdown" data-test="menuBarCategory" id="auth0Menu"><a href="https://auth0.com/docs" target="_blank" data-test="menuBarLink">Auth0</a>
                                            </div>
                                            <div class="dropdown" data-test="menuBarCategory" id="trainingMenu"><a href="https://www.okta.com/services/training/" target="_blank" data-test="menuBarLink">Training</a>
                                            </div>
                                            <div class="dropdown" data-test="menuBarCategory" id="supportMenu"><a href="https://support.okta.com/help/s/?language=en_US" target="_blank" data-test="menuBarLink">Support</a>
                                            </div>
                                        </div>
                                        <div class="logo_container" id="OktaBanner" data-mc-conditions="Primary.live-site-only"><a class="logo" href="https://help.okta.com/okta_help.htm?id=csh-index" data-test="OktaBanner"><img src="../../../resources/images/okta-assets/logo.png" alt="Okta product documentation" title="Okta product documentation" data-test="OktaBannerImg" /></a>
                                        </div>
                                        <div class="toolbar-main" data-test="toolBar" data-mc-conditions="Primary.live-site-only">
                                            <div class="buttons popup-container clearfix topicToolbarProxy _Skins_okta_toolbar_no_expand mc-component nocontent" style="mc-topic-toolbar-items: ;">
                                                <div class="button-group-container-left">
                                                    <button class="button needs-pie select-language-button" title="Change language">
                                                        <div>
                                                            <div role="img" class="button-icon-wrapper" aria-label="Change language">
                                                                <div class="button-icon"> </div>
                                                            </div>
                                                        </div>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- **********************  Main content row  ********************** -->
                                    <div class="okta-topics" data-test="bodyWrapper">
                                        <!-- *** Col1: Body Col *** -->
                                        <div>
                                            <div class="is-not-in-mobile">
                                                <!-- Breadcrumbs -->
                                                <div class="nocontent">
                                                    <div class="MCBreadcrumbsBox_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider="  &gt;  " data-mc-breadcrumbs-count="3" data-mc-toc="True">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="body-main" data-test="bodyContent">
                                                <!-- Main content body -->
                                                <div role="main" id="mc-main-content">
                                                    <h1 id="migrate-users-from-an-on-premises-generic-database">Migrate
users from an on-premises generic database</h1>
                                                    <p>Suppose you store your user profiles and groups in a generic
on-premises database, but want to replace it with Universal Directory.
In this case, you have two options:</p>
                                                    <ul>
                                                        <li>Export your user information into a CSV (or similar) file and then
import the data from the file into Universal Directory.</li>
                                                        <li>Write a script that queries the database for user information and
then uses the <a href="/docs/reference/api/users/">Okta Users API</a> to
import the users into Universal Directory.</li>
                                                    </ul>
                                                    <p>In both cases, Okta can import hashed passwords for users if the hash
is one that <a href="/docs/reference/api/users/#hashed-password-object">Okta
supports</a>. If Okta doesn't support the hash, it doesn't import the
user's password. However, you can use the <a href="/docs/reference/password-hook/">Okta password inline import
hook</a> to import user records that use an unsupported hash type
without requiring the user to reset their password.</p>
                                                    <div class="noteOkta">
                                                        <p class="noteContent"> Just-In-Time migration isn't supported in this
scenario.</p>
                                                    </div>
                                                    <p>In this tutorial, you walk through the second of these migration
options. Specifically:</p>
                                                    <ol type="1">
                                                        <li value="1"><a href="#set-up-the-start-scenario">Set up the start scenario</a>.
Start an OIDC-based web application in a Docker container that
authenticates its user against a generic database server started in a
second Docker container. At this point, Okta isn't involved in the
authentication flow.</li>
                                                        <li value="2"><a href="#import-users-into-universal-directory-with-the-users-api">Import
users into Universal Directory with the Users API</a>. Run a script that
queries the database for user information and then imports the users
into Universal Directory with the Users API.</li>
                                                        <li value="3"><a href="#update-the-application-to-use-universal-directory">Update
the application to use Universal Directory</a>. Configure the web
application to use Universal Directory instead of the generic database.
Test that you can sign in successfully with the imported user
profiles.</li>
                                                        <li value="4"><a href="#account-for-hash-types-okta-doesn-t-support">Account for
hash types Okta doesn't support</a>. If a user record uses a hash type
that Okta doesn't support, the script in step 2 imports everything in
the record into Universal Directory except the user's password. In this
step, you use the Okta password inline import hook to import user
records with an unsupported hash type without requiring the user to
reset their password.</li>
                                                    </ol>
                                                    <p>At the end of step 3, when a user attempts to sign in to the
application, Okta handles their authorization request. The generic
database isn't used.</p>
                                                    <h2 id="set-up-the-start-scenario">Set up the start scenario</h2>
                                                    <p>Create the initial environment for the tutorial where an application
authenticates directly with a generic user database running on-premises
in a Docker container.</p>
                                                    <ol type="1">
                                                        <li value="1">
                                                            <p>Change to your project directory and clone the
<code>db-users</code> branch of the
<code>okta-reference-coexistence-db-example</code> repository:</p>
                                                            <p><span class="codeblock">cd ${your project directory} git clone <a href="https://github.com/oktadev/okta-reference-coexistence-db-example">https://github.com/oktadev/okta-reference-coexistence-db-example</a>
-b db-users</span>
                                                            </p>
                                                        </li>
                                                        <li value="2">
                                                            <p>Change to the okta-reference-coexistence-db-example
directory:</p>
                                                            <p><span class="codeblock">cd
okta-reference-coexistence-db-example</span>
                                                            </p>
                                                        </li>
                                                        <li value="3">
                                                            <p>Start up the application. The <code>docker compose up</code>
command uses the
<code>okta-reference-coexistence-db-example/docker-compose.yml</code>
file to start up two containers. One runs the web app, and the other
runs the generic database.</p>
                                                            <p><span class="codeblock">docker compose up</span>
                                                            </p>
                                                        </li>
                                                        <li value="4">
                                                            <p>Open a private/incognito browser window and navigate to
<code>http://localhost:8080</code>. A sign-in dialog appears.</p>
                                                            <div class="half wireframe-border">
                                                                <p>
                                                                    <img src="../../../resources/images/ref-arch/directory-coexistence/sign-in-form-username-password.png" alt="A sign-in form with fields for username and password and a next button" />
                                                                </p>
                                                                <!--
Source image: https://www.figma.com/file/YH5Zhzp66kGCglrXQUag2E/%F0%9F%93%8A-Updated-Diagrams-for-Dev-Docs?node-id=3398%3A36678&t=wzNwSZkdctajVush-1 sign-in-form-username-password
-->
                                                            </div>
                                                        </li>
                                                        <li value="5">
                                                            <p>Sign in with username
<span class="uicontrol"><code>user1@example.com</code></span> and password
<span class="uicontrol">password</span>. The following dialog appears after successful
authentication:</p>
                                                            <div class="border">
                                                                <p>
                                                                    <img src="../../../resources/images/ref-arch/directory-coexistence/db-to-okta-successful-signin.png" alt="Sign-in response with welcome home successful authentication response" />
                                                                </p>
                                                            </div>
                                                        </li>
                                                    </ol>
                                                    <h2 id="import-users-into-universal-directory-with-the-users-api">Import
users into Universal Directory with the Users API</h2>
                                                    <p>With the basic environment set up, you can:</p>
                                                    <ul>
                                                        <li><a href="#sign-in-to-your-okta-account">Sign in to your Okta
account</a>
                                                        </li>
                                                        <li><a href="#run-the-import-script">Run the import script</a>
                                                        </li>
                                                        <li><a href="#check-that-the-users-have-imported-correctly">Check that
the users have imported correctly</a>
                                                        </li>
                                                    </ul>
                                                    <h3 id="sign-in-to-your-okta-account">Sign in to your Okta account</h3>
                                                    <p>Stop the currently running containers and sign in to your Okta
account.</p>
                                                    <ol type="1">
                                                        <li value="1">In the <code>okta-reference-coexistence-db-example</code> directory,
stop the currently running containers with <kbd>Ctrl</kbd> +
<kbd>C</kbd>.</li>
                                                        <li value="2">Run <code>okta login</code>.</li>
                                                    </ol>
                                                    <p><span class="codeblock"> okta login</span>
                                                    </p>
                                                    <p>If you're already signed in to Okta, a prompt similar to the
following is returned. The current sign-in configuration is based on the
Okta org URL and API token you provided at your previous
<code>okta login</code> command. If you want to use the existing
configuration, answer <span class="uicontrol">N</span> and skip steps a and b.
Otherwise, answer <span class="uicontrol">Y</span> and continue to steps a and b.</p>
                                                    <p><span class="codeblock">An existing Okta Organization (<a href="https://dev-133337.okta.com">https://dev-133337.okta.com</a>) was
found in C:\mydirectory.okta\okta.yaml Overwrite configuration file?
[Y/n]</span>
                                                    </p>
                                                    <p>If Okta CLI returns an error "Your Okta Org is missing a feature
required to use the Okta CLI: API Access Management," you are not using
an Okta developer account. To resolve this error, see <a href="lab.htm#okta-developer-account">Okta developer account</a>.</p>
                                                    <p>{style="list-style-type:lower-alpha"}</p>
                                                    <ol type="1">
                                                        <li value="1">Enter your <code>${OKTA_DOMAIN}</code>. If you don't know your
<code>${OKTA_DOMAIN}</code>, see <a href="lab.htm#values-and-variables">Values and variables</a>.</li>
                                                        <li value="2">Follow the instructions in <a href="/docs/guides/create-an-api-token">Create an API token</a> to
create a token. After you have the token, enter it at the Okta API token
prompt.</li>
                                                    </ol>
                                                    <h3 id="run-the-import-script">Run the import script</h3>
                                                    <p>Check out the script to import the users and check that they have
been imported correctly in Universal Directory.</p>
                                                    <ol type="1">
                                                        <li value="1">
                                                            <p>Check out the main branch of the
<code>https://github.com/oktadev/okta-reference-coexistence-db-example</code>
repository. The main branch contains a migration script and updates to
code in the project to replace the database authentication with OpenID
Connect (OIDC).</p>
                                                            <p><span class="codeblock">git checkout main</span>
                                                            </p>
                                                            <p>After a successful checkout, the
<code>okta-reference-coexistence-db-example</code> directory contains
the <code>pw-import-hook</code> subdirectory, the
<code>migrate-user.sh</code> file, and other files and code
changes.</p>
                                                        </li>
                                                        <li value="2">
                                                            <p>Restart the containers:</p>
                                                            <p><span class="codeblock">docker compose start</span>
                                                            </p>
                                                        </li>
                                                        <li value="3">
                                                            <p>Run the
<code>okta-reference-coexistence-db-example/migrate-users.sh</code>
script.</p>
                                                            <p><span class="codeblock">./migrate-users.sh</span>
                                                            </p>
                                                        </li>
                                                    </ol>
                                                    <p>This script uses a database query to get the user profiles from the
database server, and the <a href="/docs/reference/api/users/">Okta Users
API</a>, to import those users into Okta. For this example, three users
are defined in
<code>okta-reference-coexistence-db-example/blob/main/sql/03-users.sql</code>.</p>
                                                    <p>Using the Okta Users API, the script imports the two users whose
passwords are hashed with a hash that Okta supports;
<code>Admin Istrator</code> and <code>User One</code>. The first time
the users sign in, their passwords are rehashed and updated in Universal
Directory with the <code>POST https://${OKTA_DOMAIN}/api/v1/user</code>
API request. See <a href="/docs/reference/api/users/#create-user-with-imported-hashed-password">Create
User with imported hashed password</a>.</p>
                                                    <p>There's one more user in the generic database whose password is
hashed with a hash that Okta doesn't support: <span class="uicontrol">User2
Two</span>. This user is also imported into Universal Directory, but
their password isn't saved. To save a rehashed password the first time
they sign in, an additional step is required. This is covered in <a href="#account-for-hash-types-okta-doesn-t-support">Account for hash
types Okta doesn't support</a>.</p>
                                                    <div class="noteOkta">
                                                        <p class="noteContent">If you're using Windows, use
<code>git-bash</code> to open a git-bash command window and then run
<code>./migrate-users.sh</code> in it. Type <code>exit</code> to close
it. The remainder of the example is performed in the original command
window, not the git-bash command window.</p>
                                                    </div>
                                                    <h3 id="check-that-the-users-have-imported-correctly">Check that the
users have imported correctly</h3>
                                                    <p>Check that the three imported users appear in your Okta Universal
Directory.</p>
                                                    <ol type="1">
                                                        <li value="1">
                                                            <p>In a browser window, sign in to
<code>https://${DOMAIN_NAME}-admin.okta.com</code>. If you don't know
your <code>${OKTA_DOMAIN}</code>, see <a href="lab.htm#values-and-variables">Values and variables</a>.</p>
                                                        </li>
                                                        <li value="2">
                                                            <p>Choose <span class="menucascade"><span class="uicontrol">Directory</span><span class="uicontrol">People</span></span>. The page lists
three users in addition to those created in <a href="/docs/reference/architecture-center/directory-coexistence/lab-ldap-server">Migrate
users from an on-premises LDAP directory</a>: <span class="uicontrol">Admin
Istrator</span>, <span class="uicontrol">User One</span>, and <span class="uicontrol">User2
Two</span>.</p>
                                                            <div class="noteOkta">
                                                                <p class="noteContent"> If you don't see the three users, refresh the
page.</p>
                                                            </div>
                                                            <p>In the script, the user is imported and activated. <a href="https://help.okta.com/okta_help.htm?type=oie&amp;id=ext_activate_user">Activating
a user account</a> sends an email to the user, informing them that their
account is active and instructing them how to set up their account in
your Okta org.</p>
                                                        </li>
                                                        <li value="3">
                                                            <p>Select User One to see the applications they're assigned to.</p>
                                                            <div class="noteOkta">
                                                                <p class="noteContent"> Okta automatically manages a group called
<span class="uicontrol">Everyone</span>, which includes all users. The
<span class="uicontrol">Everyone</span> group also includes all applications. You may
see different applications assigned to each user if you complete other
examples in this tutorial.</p>
                                                            </div>
                                                            <p>You can select other tabs for additional information about each
user.</p>
                                                        </li>
                                                    </ol>
                                                    <h2 id="update-the-application-to-use-universal-directory">Update the
application to use Universal Directory</h2>
                                                    <p>Now that the users are mirrored in Universal Directory, you can
reconfigure the application to use Universal Directory as its Identity
Provider.</p>
                                                    <ol type="1">
                                                        <li value="1">
                                                            <p>In the <code>okta-reference-coexistence-db-example</code>
directory, stop the current running containers with <kbd>Ctrl</kbd> +
<kbd>C</kbd>.</p>
                                                        </li>
                                                        <li value="2">
                                                            <p>Remove the containers:</p>
                                                            <p><span class="codeblock">docker compose down</span>
                                                            </p>
                                                        </li>
                                                        <li value="3">
                                                            <p>Create an Okta OIDC application and register the application with
Okta:</p>
                                                            <p><span class="codeblock">okta start</span>
                                                            </p>
                                                            <p>The <code>okta start</code> CLI command creates and registers an OIDC
client with Okta. Okta considers this an OIDC application. When this
application is registered, the <code>ISSUER</code>,
<code>CLIENT_ID</code> and <code>CLIENT_SECRET</code> variables in the
<code>okta-reference-coexistence-db-example/.env</code> file are updated
for authentication with Okta, similar to:</p>
                                                            <p><span class="codeblock">ISSUER=<a href="https://dev-133337.okta.com/oauth2/default">https://dev-133337.okta.com/oauth2/default</a>
CLIENT_ID=someIdValue CLIENT_SECRET=someSecretValue</span>
                                                            </p>
                                                            <p>The sample web application in the Docker container uses the client ID
and client secret to communicate with the Okta OIDC application to use
Okta as the Identity Provider. See <a href="lab.htm#values-and-variables">Values and variables</a>.</p>
                                                        </li>
                                                        <li value="4">
                                                            <p>Rebuild the application:</p>
                                                            <p><span class="codeblock">docker compose build</span>
                                                            </p>
                                                        </li>
                                                        <li value="5">
                                                            <p>Start the application:</p>
                                                            <p><span class="codeblock">docker compose up</span>
                                                            </p>
                                                        </li>
                                                        <li value="6">
                                                            <p>Open a private/incognito window and navigate to the same URL as
before: <code>http://localhost:8080</code>. This time you're redirected
to Okta to sign in. Sign in with the user's email address and password:
<code>user1@example.com</code> and <code>password</code>.</p>
                                                            <p>When the user is authenticated by Okta, the following appears:</p>
                                                            <div class="border">
                                                                <p>
                                                                    <img src="../../../resources/images/ref-arch/directory-coexistence/db-to-okta-successful-signin.png" alt="Successful sign-in response" />
                                                                </p>
                                                            </div>
                                                        </li>
                                                    </ol>
                                                    <h2 id="account-for-hash-types-okta-doesnt-support">Account for hash
types Okta doesn't support</h2>
                                                    <p>You can use the <a href="/docs/reference/password-hook/">Okta
password inline import hook</a> to import user records with an <a href="/docs/reference/api/users/#hashed-password-object">unsupported
password hash type</a> without needing to reset the user's password. The
first time the user with an unsupported hash tries to sign in to your
application, the following flow occurs:</p>
                                                    <ol type="1">
                                                        <li value="1">A user tries to sign in to an application.</li>
                                                        <li value="2">Okta makes a REST API request to your password validation
application.</li>
                                                        <li value="3">The password validation service validates the password and responds
to Okta.</li>
                                                        <li value="4">Okta stores a hash of the user's password.</li>
                                                        <li value="5">The user is successfully authenticated and redirected back to their
application.</li>
                                                    </ol>
                                                    <div class="full">
                                                        <p>
                                                            <img src="../../../resources/images/ref-arch/directory-coexistence/db-to-okta-password-inline-import-hook-flow-diagram.png" alt="A flow diagram showing the Okta password inline import hook redirects authentication to a generic database from Okta if the password isn't saved in Universal Directory." />
                                                        </p>
                                                        <!--
    Source image: https://www.figma.com/file/YH5Zhzp66kGCglrXQUag2E/%F0%9F%93%8A-Updated-Diagrams-for-Dev-Docs?type=design&node-id=3714%3A41151&t=U52HeyImgt4pt3M2-1 db-to-okta-password-inline-import-hook-flow-diagram
  -->
                                                    </div>
                                                    <p>After this, no further calls are made to the password validation
application when that user signs in.</p>
                                                    <p>To demonstrate the successful import of passwords through the
password inline import hook, you:</p>
                                                    <ol type="1">
                                                        <li value="1"><a href="#expose-the-password-validation-application-to-okta">Expose
the password validation application to Okta</a>
                                                        </li>
                                                        <li value="2"><a href="#activate-the-password-inline-import-hook-in-your-web-application">Activate
the password inline import hook in your web application</a>
                                                        </li>
                                                        <li value="3"><a href="#test-the-password-import-hook">Test the password inline
import hook</a>
                                                        </li>
                                                    </ol>
                                                    <h2 id="expose-the-password-validation-application-to-okta">Expose the
password validation application to Okta</h2>
                                                    <p>A password validation application is already running on port 8000
from a Docker container, but it isn't exposed to the internet. Expose
the app externally so that Okta can access it using <code>ngrok</code>
to get a public URL.</p>
                                                    <ol type="1">
                                                        <li value="1">
                                                            <p>Open a new command/terminal window and run:</p>
                                                            <p><span class="codeblock">ngrok http 8000</span>
                                                            </p>
                                                            <p>Make note of your public URL. The public URL is the
<code>https</code><span class="uicontrol">Forwarding</span> URL. In the following
image, the Forwarding URL is shown as
<code>https://5d13-208-115-147-143.ngrok.io</code>.</p>
                                                            <div class="full border">
                                                                <p>
                                                                    <img src="../../../resources/images/ref-arch/directory-coexistence/db-to-okta-ngrok-url-for-generic-db.png" alt="ngrok CLI detail output" />
                                                                </p>
                                                            </div>
                                                        </li>
                                                    </ol>
                                                    <h3 id="activate-the-password-inline-import-hook-in-your-web-application">Activate
the password inline import hook in your web application</h3>
                                                    <p>The <code>pwimporthook-1</code> Docker container contains a Java
application in the <code>/pw-import-hook/</code> directory. This
application contains the password hook REST API call
(<code>Post /pwhook</code>) and logic to validate the passwords.</p>
                                                    <p>Set the password import inline hook up and activate it within your
Admin Console:</p>
                                                    <ol type="1">
                                                        <li value="1">
                                                            <p>Open the Admin Console for your org.</p>
                                                        </li>
                                                        <li value="2">
                                                            <p>Choose <span class="menucascade"><span class="uicontrol">Workflow</span><span class="uicontrol">Inline
Hooks</span></span>.</p>
                                                        </li>
                                                        <li value="3">
                                                            <p>Click <span class="uicontrol">Add Inline Hook</span> and select
<span class="uicontrol">Password Import</span> from the dropdown menu.</p>
                                                        </li>
                                                        <li value="4">
                                                            <p>Add a name for the hook. For example, <em>Password Import
Hook</em>.</p>
                                                        </li>
                                                        <li value="5">
                                                            <p>Set <span class="uicontrol">URL</span> to your external service URL. Use the
following syntax so that the <span class="uicontrol">/pwhook</span> REST API is called
on the external URL that ngrok generated. For example,
<code>https://5d13-288-115-147-143.ngrok.io/pwhook</code>.</p>
                                                        </li>
                                                        <li value="6">
                                                            <p>Set <span class="uicontrol">Authentication field</span> to
<span class="uicontrol">Authorization</span>.</p>
                                                        </li>
                                                        <li value="7">
                                                            <p>Set <span class="uicontrol">Authentication secret</span> to <span class="uicontrol">Basic
dXNlcjp1c2UtYS1zdHJvbmctcGFzc3dvcmQ=</span></p>
                                                            <div class="note_cautionOkta">
                                                                <p class="noteContent"> Don't forget the <span class="uicontrol">Basic</span>
prefix when you set the value in the <span class="uicontrol">Authentication
secret</span> field.</p>
                                                            </div>
                                                        </li>
                                                        <li value="8">
                                                            <p>Click <span class="uicontrol">Save</span>.</p>
                                                        </li>
                                                    </ol>
                                                    <div class="noteOkta">
                                                        <p class="noteContent"> The <code>POST /pwhook</code> REST API request
uses basic authentication and a static username/password that is
hard-coded for this example. You can calculate the authentication secret
value for your own username and password combinations using the command
<code>echo ${username}:${password} | base64</code>.</p>
                                                    </div>
                                                    <h3 id="test-the-password-import-hook">Test the password import
hook</h3>
                                                    <p>To test the password import inline hook:</p>
                                                    <ol type="1">
                                                        <li value="1">
                                                            <p>Open a private/incognito window and navigate to the same URL as
before: <code>http://localhost:8080</code>.</p>
                                                        </li>
                                                        <li value="2">
                                                            <p>Sign in with the user's email address and password:
<code>user2@example.com</code> and <code>password</code>.</p>
                                                            <div class="half border">
                                                                <p>
                                                                    <img src="../../../resources/images/ref-arch/directory-coexistence/db-to-okta-sign-in-to-db-example.png" alt="Sign-in dialog including username and password fields" />
                                                                </p>
                                                            </div>
                                                        </li>
                                                    </ol>
                                                    <p>A successful sign-in results in a "Welcome home" message, similar to
previous examples.</p>
                                                    <p>Open a browser to <code>http://localhost:4040</code>, the URL
assigned to the <span class="uicontrol">Web Interface</span> attribute when ngrok
assigned your external URL. The request that was sent to the
<code>POST /pwhook</code> REST API endpoint, and the response appears.
For example:</p>
                                                    <div class="full border">
                                                        <p>
                                                            <img src="../../../resources/images/ref-arch/directory-coexistence/db-to-okta-post-pwhook-request-and-response-in-ngrok.png" alt="POST pwhook endpoint request and response" />
                                                        </p>
                                                    </div>
                                                    <h2 id="stop-the-application">Stop the application</h2>
                                                    <p>After you complete this tutorial, stop the application and remove the
Docker containers.</p>
                                                    <ol type="1">
                                                        <li value="1">
                                                            <p>In the <code>okta-reference-coexistence-db-example</code>
directory, stop the current running containers with <kbd>Ctrl</kbd> +
<kbd>C</kbd>.</p>
                                                        </li>
                                                        <li value="2">
                                                            <p>Remove the containers:</p>
                                                            <p><span class="codeblock">docker compose down</span>
                                                            </p>
                                                        </li>
                                                    </ol>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- div class="toolbar-main">
            <MadCap:topicToolbarProxy data-mc-skin="/Project/Skins/okta-toolbar-no-expand.flskn" style="mc-topic-toolbar-items: ;" />
                </div -->
                                    <!-- *********************** Footer rows ********************************* -->
                                    <div class="footer2" data-test="footer">
                                        <div>
                                            <p class="copyright" data-test="copyrightNotice">©  <span class="mc-variable okta-variables.Year variable">2023</span> <span class="mc-variable okta-variables.CompanyName variable">Okta, Inc</span>. All Rights Reserved. Various trademarks held by their respective owners.
	</p>
                                        </div>
                                    </div>
                                    <!-- ********************** Scripts ************************************* -->
                                    <script src="../../../resources/scripts/js/ignore-dompurify.js">
                                    </script>
                                    <script src="../../../resources/scripts/js/app.js">
                                    </script>
                                    <script src="../../../resources/scripts/js/vendor/what-input.js">
                                    </script>
                                    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.4.4-rc1/js/foundation.min.js">
                                    </script>
                                    <!-- Coveo -->
                                    <script src="https://static.cloud.coveo.com/searchui/v2.5395/js/CoveoJsSearch.Lazy.min.js" defer="defer">
                                    </script>
                                    <script src="../../../resources/scripts/coveo-resources/js/cultures/en.js" id="coveoCultureScript" defer="defer">
                                    </script>
                                    <script src="../../../resources/scripts/coveo-resources/js/coveo.madcapflare.requirejs.js" id="coveoRequireScript" defer="defer">
                                    </script>
                                    <script src="../../../resources/scripts/coveo-resources/js/coveo.madcapflare.okta.js" id="coveoInitscript" defer="defer">
                                    </script>
                                    <!-- Feedback tab for Qualtrics survey -->
                                    <div id="feedback-tab" data-mc-conditions="Primary.live-site-only"><a id="feedback-link" href="#" onclick="openSurvey();  return false" target="_blank" title="Submit feedback"><div id="feedback-container"><p id="feedback-text" translate="no">Feedback</p></div></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>
