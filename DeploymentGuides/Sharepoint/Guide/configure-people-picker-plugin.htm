<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:fileTags="Tags/okta-authors.Mark Cowan">
    <head>
        <link href="../../../../Resources/TableStyles/standard.css" rel="stylesheet" MadCap:stylesheetType="table" /><title>[%=Heading.Level1%] | Okta</title>
    </head>
    <body>
        <h1>Configure Okta SharePoint People Picker agent</h1>
        <p>Installing the Okta SharePoint People Picker plugin allows you to fetch users and groups from Okta. The People Picker plugin is a Microsoft Windows executable that you can download from the Downloads page of your Okta Administrator Dashboard. </p>
        <h2>Before you begin</h2>
        <ul>
            <li>
                <p>Complete <MadCap:xref href="install-people-picker-plugin.htm">Deploy Okta People Picker for SharePoint agent</MadCap:xref>.</p>
            </li>
        </ul>
        <MadCap:snippetBlock src="../Snippets/Callouts/prereq-ps.flsnp" />
        <h2>Start this procedure</h2>
        <p>This procedure includes the following tasks:</p>
        <p>
            <MadCap:xref href="#1.">1. Set configuration values in SharePoint farm</MadCap:xref>
        </p>
        <p>
            <MadCap:xref href="#2.">2. Run the appropriate commands</MadCap:xref>
        </p>
        <p>
            <MadCap:xref href="#3.">3. Configure search scope values</MadCap:xref>
        </p>
        <p>
            <MadCap:xref href="#4.">4. Optional: Filter Active Directory imports</MadCap:xref>
        </p>
        <h3><a name="1."></a>1. Set configuration values in SharePoint farm</h3>
        <p>You must set several configuration values in the SharePoint farm to install the Okta People Picker. These values are used to configure People Picker functionality and define the Okta org that you're integrating with this SharePoint environment.</p>
        <table style="width: 100%;mc-table-style: url('../../../../Resources/TableStyles/standard.css');" class="TableStyle-standard" cellspacing="0">
            <col class="TableStyle-standard-Column-Column1" />
            <col class="TableStyle-standard-Column-Column1" />
            <thead>
                <tr class="TableStyle-standard-Head-Header1">
                    <th class="TableStyle-standard-HeadF-Column1-Header1">Property</th>
                    <th class="TableStyle-standard-HeadD-Column1-Header1">Value</th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-standard-Body-Body1">
                    <td class="TableStyle-standard-BodyF-Column1-Body1">Okta API Key</td>
                    <td class="TableStyle-standard-BodyD-Column1-Body1">Read-only administrator API key generated during prerequisite steps</td>
                </tr>
                <tr class="TableStyle-standard-Body-Body2">
                    <td class="TableStyle-standard-BodyF-Column1-Body2"><span class="code">BaseUrl</span>
                    </td>
                    <td class="TableStyle-standard-BodyD-Column1-Body2">Your Okta org domain, example: <span class="code">https://oktaorg.okta.com</span></td>
                </tr>
                <tr class="TableStyle-standard-Body-Body1">
                    <td class="TableStyle-standard-BodyF-Column1-Body1"><span class="code">OktaClaimProviderDisplayName</span>
                    </td>
                    <td class="TableStyle-standard-BodyD-Column1-Body1">Set to Okta by default. Can be set to a different value if you prefer a different display name for the Okta People Picker</td>
                </tr>
                <tr class="TableStyle-standard-Body-Body2">
                    <td class="TableStyle-standard-BodyF-Column1-Body2"><span class="code">MapUpnToWindowsUser</span>
                    </td>
                    <td class="TableStyle-standard-BodyD-Column1-Body2">Configuration flag to enable or disable C2WTS protocol translation</td>
                </tr>
                <tr class="TableStyle-standard-Body-Body1">
                    <td class="TableStyle-standard-BodyC-Column1-Body1"><span class="code">UniqueUserIdentifierClaimType</span>
                    </td>
                    <td class="TableStyle-standard-BodyA-Column1-Body1">
                        <p>To define the unique user identifier claim. Identifier claim type on the Okta trusted token issuer must be unique and immutable, and must match the <span class="code">UniqueUserIdentifierClaimType</span>. Set to <span class="code">Email</span> or <span class="code">UserName</span>, depending on what you want to use as an identifier claim.</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h3><a name="2."></a>2. Run the appropriate commands</h3>
        <p>Enter the following commands, replacing the variables with the appropriate values as defined in the preceding section.</p>
        <div class="noteOkta">
            <p class="noteContent">Type in the commands rather than copy and paste.</p>
        </div>
        <ol>
            <li>
                <p>Enter the following command to update the farm properties.</p>
                <MadCap:codeSnippet>
                    <MadCap:codeSnippetCopyButton />
                    <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve">$farm = Get-SPFarm
$farm.Properties["OktaApiKey"] = "OktaAPIKey"
$farm.Properties["OktaBaseUrl"] = "https://oktaorg.okta.com""
$farm.Properties["OktaLoginProviderName"] = "Okta"
$farm.Properties["OktaClaimProviderDisplayName"] = "Okta"
</MadCap:codeSnippetBody>
                </MadCap:codeSnippet>
            </li>
            <li>
                <p>Optional: If you're enabling C2WTS, execute the following command. If not, go to the next step.</p>
                <MadCap:codeSnippet>
                    <MadCap:codeSnippetCopyButton />
                    <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve">$farm.Properties["MapUpnToWindowsUser"] = $true</MadCap:codeSnippetBody>
                </MadCap:codeSnippet>
            </li>
            <li>
                <p>To specify <code>UniqueUserIdentifierClaimType</code> execute one of the following commands.</p>
                <MadCap:codeSnippet>
                    <MadCap:codeSnippetCopyButton />
                    <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve">$farm.Properties["UniqueUserIdentifierClaimType"] = "Email"</MadCap:codeSnippetBody>
                </MadCap:codeSnippet>
                <p>OR</p>
                <MadCap:codeSnippet>
                    <MadCap:codeSnippetCopyButton />
                    <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve">$farm.Properties["UniqueUserIdentifierClaimType"] = "UserName"
</MadCap:codeSnippetBody>
                </MadCap:codeSnippet>
            </li>
            <li>
                <p>Enter the following command to update the farm values.</p>
                <MadCap:codeSnippet>
                    <MadCap:codeSnippetCopyButton />
                    <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve">$farm.Update()</MadCap:codeSnippetBody>
                </MadCap:codeSnippet>
            </li>
        </ol>
        <h3><a name="3."></a>3. Configure search scope values</h3>
        <p>You must set several configuration values in the SharePoint web application for the Okta People Picker to use the search scope.</p>
        <MadCap:codeSnippet>
            <MadCap:codeSnippetCopyButton />
            <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve">$webApplication = Get-SPWebApplication
$ webApplication.Properties["UserSearchScope"] = "OKTA"</MadCap:codeSnippetBody>
        </MadCap:codeSnippet>
        <p>OR</p>
        <MadCap:codeSnippet>
            <MadCap:codeSnippetCopyButton />
            <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve">$ webApplication.Properties["UserSearchScope"] = "APP"
$ webApplication.Properties["UserSearchScopeAppId"] = "{AppID}"  //app instance id in Okta org
$webApplication.Update();</MadCap:codeSnippetBody>
        </MadCap:codeSnippet>
        <div class="noteOkta">
            <ul>
                <li>When App ID isn't provided or is invalid, <code>UserSearchScope</code> fallback to using OKTA (org level search) as search scope.</li>
                <li>People Picker doesn't verify if the App ID specified belongs to an app instance WS-Federated with this SharePoint web application. The verification must be done manually.</li>
            </ul>
        </div>
        <p>When you have multiple web applications in the same farm, check the value of <span class="code">$webApplication</span> before setting the properties. This ensures that you're setting the values for the correct web application.</p>
        <h4>Example: Set <code>UserSearchScope</code> and <code>UserSearchScopeAppId</code> for <code>$webApplication[1]</code></h4>
        <MadCap:codeSnippet>
            <MadCap:codeSnippetCopyButton />
            <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve">PS C:\Users\administrator.SP10&gt; $w[1].properties
Name									Value
------									------
UserSearchScope                       	OKTA
UserSearchScopeAppID					0oalx5qLAHqqLVtNv0w4

PS C:\Users\administrator.SP10&gt; $w[1].properties["UserSearchScope"] = "APP"
PS C:\Users\administrator.SP10&gt; $w[1].properties["UserSearchScopeAppID"] = "0oalx5qLAHqqLVtNv0w4"
PS C:\Users\administrator.SP10&gt; $w[1].properties
&#160;
Name									Value
------									------
UserSearchScope                       	APP
UserSearchScopeAppID					0oalx5qLAHqqLVtNv0w4

PS C:\Users\administrator.SP10&gt; $w[1].update()</MadCap:codeSnippetBody>
        </MadCap:codeSnippet>
        <h3><a name="4."></a>4. Optional: Filter Active Directory imports</h3>
        <p>Okta People Picker shows users imported from Active Directory twice: as an Okta user and as an AD-domain user. You can see and manage only the original AD users. You can also specify that certain domains retain the original behavior. Enabling this feature requires setting certain <code>$farm</code> object properties in SharePoint.</p>
        <p>If you import from Active Directory, you can take advantage of the People Picker Active Directory filtering option, which allows for filtering AD imports.</p>
        <p>To enable this feature, use the following properties:</p>
        <MadCap:codeSnippet>
            <MadCap:codeSnippetCopyButton />
            <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve">$farm = Get-SPFarm
$farm.Properties["FilterActiveDirectoryClaims"] = $true
$farm.Properties["AllowedActiveDirectoryDomains"] = "foo.com", "bar.com"
$farm.Update()
</MadCap:codeSnippetBody>
        </MadCap:codeSnippet>
        <div class="noteOkta">
            <p class="noteContent">Active Directory domain filtering is only available with the OKTA search scope.</p>
        </div>
        <h2>Next steps</h2>
        <p>
            <MadCap:xref href="Appendices/troubleshooting.htm">Troubleshooting: Microsoft SharePoint (On-Premises)</MadCap:xref>
        </p>
    </body>
</html>