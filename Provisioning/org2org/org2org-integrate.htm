<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:onlyLocalStylesheets="False" MadCap:searchable="True" MadCap:fileTags="Tags/okta-authors.Jeanette Smith">
    <head><title>[%=Heading.Level1%] | Okta</title>
        <link href="" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <h1>Integrate <MadCap:variable name="okta-variables.ProductName" /> Org2Org with <MadCap:variable name="okta-variables.ProductName" /></h1>
        <p>You can use the <MadCap:variable name="okta-variables.ProductName" /> Org2Org integration to authenticate and optionally provision users from a source <MadCap:variable name="okta-variables.ProductName" /> org to a target org. The integration is installed and configured in the source org. You can use <MadCap:variable name="okta-variables.ProductName" /> Org2Org to connect multiple source orgs to a single <MadCap:variable name="okta-variables.ProductName" /> target org. This integration enables the source orgs to push users to the target org.</p>
        <p>If you choose to use the provisioning features of the Org2Org app, you can use OAuth 2.0 or an API&#160;token to secure the connection between the orgs.</p>
        <p>A common scenario where Org2Org is used is the hub-and-spoke model. In these scenarios, the spoke orgs are the source orgs and the hub org is the target org.</p>
        <h2>Configure federation between orgs</h2>
        <p>This procedure assumes you're configuring <MadCap:variable name="okta-variables.ProductName" /> Org2Org in an <MadCap:variable name="okta-variables.ProductName" /> source org. </p>
        <ol>
            <li>In the source org, open the Admin Console and go to <span class="menucascade"><span class="uicontrol">Applications</span><span class="uicontrol">Applications</span></span>.</li>
            <li>Click <span class="uicontrol">Browse App Catalog</span>.</li>
            <li>In the search field, enter <span class="userinput">Org2Org</span>, and then select <span class="userinput"><MadCap:variable name="okta-variables.ProductName" /> Org2Org</span>.</li>
            <li>Click <span class="uicontrol">Add Integration</span>.</li>
            <li>Complete the fields on the <span class="wintitle">General Settings</span> page, and then click <span class="uicontrol">Next</span>.</li>
            <li>Select a sign-on option. If you select <span class="uicontrol">SAML 2.0</span>, click <span class="uicontrol">View Setup Instructions</span> and follow the steps.</li>
            <li>Click <span class="uicontrol">Done</span>.</li>
            <li>Go to <span class="menucascade"><span class="uicontrol">Applications</span><span class="uicontrol">Applications</span></span>. <ol style="list-style-type: lower-alpha;"><li>Open the Org2Org app and switch to the <span class="wintitle">Sign On</span> tab. </li><li>Click <span class="uicontrol">View SAML setup instructions</span>. Follow the directions to create an IdP in the target org to work with the Org2Org app. For details and security best practices, see <MadCap:xref href="../../Security/idp-add-saml.htm">Add a SAML&#160;Identity Provider</MadCap:xref>. </li><li>Copy the value of the <span class="uicontrol">IdP&#160;Single Sign On URL</span> to use in a later step.</li></ol></li>
            <li>Switch to the <span class="wintitle">Assignments</span> tab of the Org2Org app. Assign users and groups to the Org2Org app by completing these steps:<ol style="list-style-type: lower-alpha;"><li>Click <span class="uicontrol">Assign</span>, and then select <span class="uicontrol">Assign to People</span> or <span class="uicontrol">Assign to Groups</span>.</li><li>Click <span class="uicontrol">Assign</span> next to a user or group name, or use the search field to locate a user or group and then click <span class="uicontrol">Assign</span>.</li></ol></li>
            <li>Configure one or more apps in the target org to allow source org users to access.<ol style="list-style-type: lower-alpha;"><li><p>Create and configure an application in the target org.</p></li><li><p>In the <span class="wintitle">General</span> tab of the app, copy the <span class="uicontrol">Embed Link</span> value from the <span class="wintitle">App Embed Link</span> section.</p></li><li><p>In the source org, <MadCap:xref href="../../Apps/apps-create-bookmark.htm">Create a Bookmark App integration</MadCap:xref>.</p></li><li><p>Create the URL&#160;for the bookmark app by concatenating these values:</p><ul><li><p>The <span class="uicontrol">IdP&#160;Single Sign On URL</span> (for example, <span class="url">https://sourceorg.okta.com/app/okta_org2org/app_ext_id/sso/saml</span>)</p></li><li><p><span class="userinput">?RelayState=</span></p></li><li><p>The <span class="uicontrol">Embed Link</span> value for the app (for example, <span class="url">https://targetorg.okta/home/app_name/instance_id/app_id</span>)</p></li></ul><p>For example, concatenate the preceding values to create the following URL for your bookmark app:
				<p><span class="url"><span class="url">https://sourceorg.okta.com/app/okta_org2org/app_ext_id/sso/saml</span>?RelayState=<span class="url">https://targetorg.okta/home/app_name/org_id/app_id</span></span></p></p></li></ol></li>
            <li>Optional. Enable provisioning from the source org to the target org using <a href="#Use">OAuth 2.0</a> (preferred)&#160;or an <a href="#Use2">API&#160;token</a>.</li>
        </ol>
        <h2><a name="Use"></a>Enable provisioning from source to target</h2>
        <p>If you need provisioning but don’t need real-time sync of users, user profile attributes, and groups, manually create source org users in the target org:</p>
        <ol>
            <li>
                <p>In the source org, export a list of active users. In the Admin Console, go to <span class="uicontrol">Reports</span> and click  <span class="uicontrol">Okta Password Health</span> . The report is generated and sent to your email address. You can also download the report. Open the CSV file and filter the <span class="uicontrol">Status</span> column to show active users.</p>
            </li>
            <li>
                <p>In the target org, <a href="../../users-groups-profiles/usgp-import-users-csv.htm">import the users from the CSV file</a>. Assign them to the groups for their source orgs and to any groups for applications that they need access to.</p>
            </li>
            <li>
                <p><a href="https://developer.okta.com/docs/reference/api/idps/#link-a-user-to-a-social-provider-without-a-transaction" target="_blank">Manually link the newly created users to the IdP configured for the source org</a>.</p>
            </li>
        </ol>
        <p>If you need provisioning and real-time sync of users, choose one of the following methods:</p>
        <ul>
            <li>
                <p>
                    <MadCap:xref href="#Use2">Use OAuth 2.0 for provisioning</MadCap:xref>
                </p>
            </li>
            <li>
                <p>
                    <MadCap:xref href="#Use3">Use API token for provisioning</MadCap:xref>
                </p>
            </li>
        </ul>
        <h3><a name="Use2"></a>Use OAuth 2.0 for provisioning</h3>
        <ol MadCap:conditions="Primary.do-not-publish">
            <li>
                <p><a href="https://developer.okta.com/docs/guides/secure-oauth-between-orgs/main/#add-an-org2org-app-integration-in-a-spoke-org" target="_blank">Add an Org2Org app integration</a> to the source org.</p>
            </li>
        </ol>
        <p>To enable OAuth 2.0 provisioning between orgs, you must use a combination of the <MadCap:variable name="okta-variables.ProductName" /> APIs and the Admin Console.</p>
        <ol>
            <li>
                <p>In the source org, open the Admin Console and go to <span class="menucascade"><span class="uicontrol">ApplicationsApplications</span></span>. <ol style="list-style-type: lower-alpha;"><li>Open the Org2Org app.</li><li>Copy the app ID from the URL. For example, in the URL&#160;<span class="url">&lt;sourceorg&gt;/admin/app/okta_org2org/instance/0oa78guhzaGH4KHZt1d7/#tab-import</span>, the ID&#160;is <span class="code">0oa78guhzaGH4KHZt1d7</span>.</li></ol></p>
            </li>
            <li>
                <p><a href="https://developer.okta.com/docs/reference/api/apps/#list-key-credentials-for-application" target="_blank">List the key credentials for the Org2Org app</a>, passing the application ID from the previous step.</p>
            </li>
            <li><a href="https://developer.okta.com/docs/guides/secure-oauth-between-orgs/main/#create-an-oauth-2-0-service-app-in-the-hub-org" target="_blank">Create an OAuth 2.0 service app</a> in the target org, using the key credentials from the previous step as the <span class="code">keys</span> entry in the <span class="code">jwks</span> object.</li>
            <li>
                <p>If <span class="uicontrol">Assign admin roles to public client apps</span> is enabled, assign admin roles to the OAuth 2.0 service app. Otherwise, proceed to the next step.</p>
                <ol style="list-style-type: lower-alpha;">
                    <li>
                        <p>In the target org, open the Admin Console and go to <span class="menucascade"><span class="uicontrol">Applications</span><span class="uicontrol">Applications</span></span>. Open the OAuth 2.0 service app.</p>
                    </li>
                    <li>
                        <p>On the <span class="uicontrol">Admin roles</span> tab, click <span class="uicontrol">Edit assignments</span>.</p>
                    </li>
                    <li>
                        <p>Click <span class="uicontrol">+ Add assignment</span> and then select <span class="uicontrol">Group Administrator</span> from the <span class="uicontrol">Role</span> dropdown list. </p>
                    </li>
                    <li>
                        <p>Click <span class="uicontrol">+ Add assignment</span> and then select <span class="uicontrol">Group Membership</span> from the <span class="uicontrol">Role</span> dropdown list. </p>
                    </li>
                    <li>
                        <p>Click <span class="uicontrol">Save Changes</span>.</p>
                    </li>
                </ol>
            </li>
            <li>Grant consent for the API scopes that enable the service app to create users and manage user profiles and credentials.
            <ol style="list-style-type: lower-alpha;"><li>In the target org, open the Admin Console and go to <span class="menucascade"><span class="uicontrol">Applications</span><span class="uicontrol">Applications</span></span>. Open the OAuth 2.0 service app.</li><li>On the <span class="wintitle"><MadCap:variable name="okta-variables.ProductName" /> API Scopes</span> tab, grant the <span class="code">okta.groups.manage</span> and <span class="code">okta.users.manage</span> scopes.</li></ol></li>
            <li>Assign admin roles to the OAuth 2.0 service app. </li>
            <li>Optional. Enable provisioning to automate account creation, updates, and deactivation.
				<ol style="list-style-type: lower-alpha;"><li>In the target org, open the Admin Console and go to <span class="menucascade"><span class="uicontrol">Applications</span><span class="uicontrol">Applications</span></span>. Open the OAuth 2.0 service app and copy the client ID from the <span class="wintitle">General</span> tab.</li><li>In the source org, <a href="https://developer.okta.com/docs/guides/secure-oauth-between-orgs/main/#enable-provisioning-in-the-org2org-app" target="_blank">use the <MadCap:variable name="okta-variables.ProductName" /> API to enable OAuth 2.0-based provisioning</a>.</li><li>In the source org, configure the provisioning settings for the Org2Org app. <ol style="list-style-type: lower-roman;"><li>In the Admin Console, go to <span class="menucascade"><span class="uicontrol">Applications</span><span class="uicontrol">Applications</span></span>. </li><li>Open the Org2Org app. </li><li>On the <span class="wintitle">Provisioning</span> tab, go to the <span class="wintitle">Okta Org2Org Attribute Mappings</span> section and find the <span class="code">initialStatus</span> attribute. Click <span class="uicontrol">Edit</span>. The most common configuration for the initial status <span class="uicontrol">Attribute value</span> is <span class="uicontrol">Same value for all users</span> and <span class="uicontrol">active_with_pass</span>. </li><li>Choose your desired settings.</li><li>Click <span class="uicontrol">Save</span>.</li></ol></li><li>Optional. Test your Org2Org provisioning.
						<ol style="list-style-type:  lower-roman;"><li>In the <span class="wintitle">Provisioning to App</span> section, click <span class="uicontrol">Edit</span>, and then select <span class="uicontrol">Create Users</span>, <span class="uicontrol">Update Users</span>, and <span class="uicontrol">Deactivate Users</span>. Save your settings.</li><li>Assign the app to a group. On the <span class="wintitle">Assignments</span> tab, click <span class="menucascade"><span class="uicontrol">Assign</span><span class="uicontrol">Assign to Groups</span></span>, select a group and click <span class="uicontrol">Save and Go Back</span>. Click <span class="uicontrol">Done</span>. Filter your assignments by people to view the list of users who belong to the group that you configured.</li><li>Go to the Admin Console on the target org. Go to <span class="menucascade"><span class="uicontrol">Directory</span><span class="uicontrol">People</span></span> and confirm that the users assigned to the Org2Org app in the source org have been provisioned.</li></ol></li></ol></li>
        </ol>
        <h3><a name="Use3"></a>Use API token for provisioning</h3>
        <ol>
            <li>Create the API&#160;token on the target <MadCap:variable name="okta-variables.ProductName" /> org:<ol style="list-style-type: lower-alpha;"><li><MadCap:snippetText src="../../../Resources/Snippets/task steps/Security_API.flsnp" /></li><li>Click the <span class="wintitle">Tokens</span> tab, and then click <span class="uicontrol">Create token</span>.</li><li>Enter a descriptive name for the token, and then click <span class="uicontrol">Create token</span>.</li><li>Copy the token value to your clipboard or a text editor.</li><li>Click <span class="uicontrol">OK, got it</span>.</li></ol></li>
            <li>In the source org, open the Admin Console and go to <span class="menucascade"><span class="uicontrol">Applications</span><span class="uicontrol">Applications</span></span>.</li>
            <li>Select Okta Org2Org from the list of applications.</li>
            <li>Click the <span class="wintitle">Provisioning</span> tab, click <span class="uicontrol">Configure API Integration</span>, and then select <span class="uicontrol">Enable API&#160;integration</span>.</li>
            <li>Complete these fields:<ul><li><span class="uicontrol">Security token</span>: Paste the security token that you copied earlier.</li><li><span class="uicontrol">Prefer Username Over Email</span>:&#160;Optional. Select this option if you don't want to use an email address as the username.</li><li><span class="uicontrol">Import Groups</span>: Optional. Clear the checkbox if you don't want to import groups from the connected org.</li></ul></li>
            <li>Optional. Click <span class="uicontrol">Test API Credentials</span> to test the API integration.</li>
            <li>Click <span class="uicontrol">Save</span>.</li>
            <li>
                <p>Optional. Change the provisioning settings from the target <MadCap:variable name="okta-variables.ProductName" /> org to the source org:</p>
                <ol style="list-style-type: lower-alpha;">
                    <li>Click the <span class="wintitle">Provisioning</span> tab, and thenselect <span class="uicontrol">To App</span> in the <span class="uicontrol">SETTINGS</span> list.</li>
                    <li>Click <span class="uicontrol">Edit</span>.</li>
                    <li>Select the  <span class="uicontrol">Create Users</span>, <span class="uicontrol">Update User Attributes</span>, <span class="uicontrol">Deactivate Users</span>, or <span class="uicontrol">Sync Password</span> checkboxes.</li>
                </ol>
                <ol style="list-style-type: lower-alpha;" MadCap:continue="true">
                    <li>Click <span class="uicontrol">Save</span>.</li>
                </ol>
            </li>
            <li>Optional. Change the provisioning settings from the source org   to the target <MadCap:variable name="okta-variables.ProductName" /> org:<ol style="list-style-type: lower-alpha;"><li>Click the <span class="wintitle">Provisioning</span> tab, and then select <span class="uicontrol">To Okta</span> in the <span class="uicontrol">SETTINGS</span> list.</li><li>Click  <span class="uicontrol">Edit</span> in the <span class="wintitle">General</span>, <span class="uicontrol">User Creation &amp; Matching</span>, <span class="uicontrol">Profile &amp; Lifecycle Sourcing</span>, or <span class="uicontrol">Import Safeguard</span> areas to edit the settings.</li><p>When you select <span class="uicontrol">Allow Okta Org2Org to source Okta users</span> in the <span class="uicontrol">Profile &amp; Lifecycle Sourcing</span> area, the source org is the source for user profile data. When you import <MadCap:variable name="okta-variables.ProductName" /> users into your target org, updates made to user properties in the source org are applied to other apps that the user is assigned.</p></ol><ol style="list-style-type: lower-alpha;" MadCap:continue="true"><li>Click <span class="uicontrol">Save</span>.</li><li><p>Select an option for Initial status (<span class="code">initialStatus</span>). This attribute determines the status of the user in the connected org when they're created, linked, or reactivated. When <span class="uicontrol">active_with_pass</span> or <span class="uicontrol">pending_with pass</span> is selected, a temporary password is generated for the user. When Okta Password Sync is enabled, the temporary user password is overwritten when the user signs in.  The most common configuration for the initial status <span class="uicontrol">Attribute value</span> is <span class="uicontrol">Same value for all users</span> and <span class="uicontrol">active_with_pass</span>. Click <span class="uicontrol">Edit</span>. Choose your desired settings, and then click <span class="uicontrol">Save</span>.</p></li></ol></li>
            <li>Optional. Push new <MadCap:variable name="okta-variables.ProductName" /> groups to the connected org. See <MadCap:xref href="../../users-groups-profiles/usgp-group-push-main.htm">Manage Group Push</MadCap:xref>.</li>
        </ol>
    </body>
</html>