<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_okta_html5_topnav_nav_poc" data-mc-search-type="Stem" data-mc-help-system-file-name="okta_help.xml" data-mc-path-to-help-system="../../../../" data-mc-has-content-body="True" data-mc-toc-path="App integrations|[%=System.LinkedHeader%]|Microsoft Azure AD&#160;and Office 365|[%=System.LinkedHeader%]|[%=System.LinkedHeader%]" data-mc-conditions="MultiProdPubish.Core" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="typeofcontent" content="documentation" />
        <meta name="audience" content="admin" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Migrate registry-key-based Office 365 Silent Activation to new configuration</title>
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, height=device-height" />
        <link rel="shortcut icon" href="../../../Resources/Images/favicon.ico" type="image/x-icon" />
        <!-- Google Tag Manager -->
        <!-- End Google Tag Manager -->
        <!-- Google Tag Manager -->
        <!-- End Google Tag Manager -->
        <!-- Pendo Script (Per Chris Bank) -->
        <!-- End Pendo Script -->
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Resources/Stylesheets/okta-main-new-nav.css" rel="stylesheet" type="text/css" />
        <link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.5395/css/CoveoFullSearchNewDesign.css" />
        <style>/*&lt;meta /&gt;*/

.button.select-language-button
{
	-pie-background: linear-gradient(#ffffff, #ffffff);
}

.button.previous-topic-button
{
	-pie-background: linear-gradient(#ffffff, #ececec);
}

.button.next-topic-button
{
	-pie-background: linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../../Resources/TableStyles/standard.css" rel="stylesheet" data-mc-stylesheet-type="table" />
        <script src="../../../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js" type="text/javascript">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
        <script>
			/* <![CDATA[ */
			(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], 
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
			})(window,document,'script','dataLayer','GTM-NMZZV4P');
			/* ]]> */
		</script>
        <script>
			/* <![CDATA[ */
			(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], 
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
			})(window,document,'script','dataLayer','GTM-KXMLV58');
			/* ]]> */
		</script>
        <script>
		/* <![CDATA[ */
		(function(apiKey){
			(function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
			v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
			o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
			y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
			z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id:              'VISITOR-UNIQUE-ID'
            },	
            account: {
                id:           'ACCOUNT-UNIQUE-ID'
            }
        });
		})('a9bd3885-93ae-46ab-700b-dd29e613c19d');
		/* ]]> */
		</script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" role="banner" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1024px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="https://support.okta.com/help/s/" alt="Okta"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="2" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <!-- Google Tag Manager (noscript) -->
                                    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NMZZV4P" height="0" width="0" style="display:none;visibility:hidden"></iframe>
                                    </noscript>
                                    <!-- End Google Tag Manager (noscript) -->
                                    <!-- Google Tag Manager (noscript) -->
                                    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KXMLV58" height="0" width="0" style="display:none;visibility:hidden"></iframe>
                                    </noscript>
                                    <!-- End Google Tag Manager (noscript) -->
                                    <!-- Coveo config parameters -->
                                    <div id="coveo_org_id" style="Display:None"><span class="mc-variable okta-coveo-config.OrgId variable">oktaproduction9ounvcxa</span>
                                    </div>
                                    <div id="coveo_rest_uri" style="Display:None"><span class="mc-variable okta-coveo-config.PlatformRestUri variable">https://platform.cloud.coveo.com/rest/search</span>
                                    </div>
                                    <div id="coveo_search_url" style="Display:None"><span class="mc-variable okta-coveo-config.SearchPageUrl variable">https://support.okta.com/help/s/global-search/%40uri</span>
                                    </div>
                                    <div id="coveo_token_url" style="Display:None"><span class="mc-variable okta-coveo-config.SearchTokenServiceUrl variable">https://support.okta.com/help/services/apexrest/PublicSearchToken?site=help</span>
                                    </div>
                                    <!-- End Coveo config parameters -->
                                    <!-- ************** Coveo Search bar ************************************* -->
                                    <!-- set margin and size in /Content/Resources/Scripts/coveo-resources/css/Coveo.Okta.StandaloneSearchbox.min.css to make room for replacing Flare-generated top-nav with HTML code (see below)-->
                                    <div id="OLC_Coveo_Headline" class="coveo-headline-wrapper" data-mc-conditions="MultiProdPubish.SearchBar">
                                        <div class="slds-p-vertical_small">
                                            <!--Search Bar-->
                                            <div class="slds-grid slds-grid_align-center">
                                                <div id="customSelect" class="CoveoCustomSelect slds-float_right">
                                                </div>
                                                <div id="standaloneSearchbox">
                                                    <div class="CoveoAnalytics" data-search-hub="OktaCommunityFullSearch">
                                                    </div>
                                                    <div class="CoveoTab" data-id="Help" data-caption="Help" style="display:none">
                                                    </div>
                                                    <div class="CoveoSearchbox" data-enable-omnibox="true" data-enable-query-suggest-addon="true">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="replace_top_nav">
                                        <div class="navbar">
                                            <div class="dropdown" data-mc-conditions="MultiProdPubish.DocMenu">
                                                <button class="dropbtn">Documentation <i class="fa fa-caret-down"></i></button>
                                                <div class="dropdown-content">
                                                    <div><a href="https://help.okta.com/en-us/Content/Topics/ReleaseNotes/okta-relnotes.htm">Release notes</a>
                                                    </div>
                                                    <div><a href="https://help.okta.com/en-us/Content/index.htm">Product documentation</a>
                                                    </div>
                                                    <div><a href="https://developer.okta.com/documentation" target="_blank">Developer documentation<img src="../../../Resources/Images/okta-assets/external-link-icon.svg" style="margin-left: 8px;" /></a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="dropdown"><a href="https://support.okta.com/help/s/knowledge">Knowledge base</a>
                                            </div>
                                            <div class="dropdown">
                                                <button class="dropbtn">Community <i class="fa fa-caret-down"></i></button>
                                                <div class="dropdown-content">
                                                    <div><a href="https://support.okta.com/help/s/questions?language=en_US">Questions</a>
                                                    </div>
                                                    <div><a href="https://support.okta.com/help/s/group/CollaborationGroup/Recent?language=en_US">Discussions</a>
                                                    </div>
                                                    <div><a href="https://support.okta.com/help/s/events?language=en_US">Webinars</a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="dropdown">
                                                <button class="dropbtn">Product <i class="fa fa-caret-down"></i></button>
                                                <div class="dropdown-content">
                                                    <div><a href="https://support.okta.com/help/s/ideas" target="_blank">Ideas<img src="../../../Resources/Images/okta-assets/external-link-icon.svg" style="margin-left: 8px;" /></a>
                                                    </div>
                                                    <div><a href="https://support.okta.com/help/s/productroadmap?language=en_US">Roadmap</a>
                                                    </div>
                                                    <div><a href="https://support.okta.com/help/s/product-hub?language=en_US">Product hub</a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="dropdown"><a href="https://www.okta.com/services/education-services/" target="_blank">Training<span><img src="../../../Resources/Images/okta-assets/external-link-icon.svg" style="margin-left: 8px;" /></span></a>
                                            </div>
                                        </div>
                                        <div class="logo_container"><a class="logo" href="https://support.okta.com/help/s/"><img src="../../../Resources/Images/okta-assets/Logo.png" alt="Okta Support" title="Okta Support" /></a>
                                        </div>
                                    </div>
                                    <!-- **********************  Main content row  ********************** -->
                                    <div class="okta-topics">
                                        <!-- *** Col1: Body Col *** -->
                                        <div>
                                            <div class="is-not-in-mobile">
                                                <!-- Breadcrumbs -->
                                                <div class="nocontent">
                                                    <div class="MCBreadcrumbsBox_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider="  &gt;  " data-mc-breadcrumbs-count="3" data-mc-toc="True">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="toolbar-main">
                                                <div class="buttons popup-container clearfix topicToolbarProxy _Skins_okta_toolbar_no_expand mc-component nocontent" style="mc-topic-toolbar-items: ;">
                                                    <div class="button-group-container-left">
                                                        <button class="button needs-pie select-language-button" title="Change language">
                                                            <div>
                                                                <div role="img" class="button-icon-wrapper" aria-label="Change language">
                                                                    <div class="button-icon"> </div>
                                                                </div>
                                                            </div>
                                                        </button>
                                                        <button class="button needs-pie previous-topic-button" title="Previous topic" disabled="true">
                                                            <div>
                                                                <div role="img" class="button-icon-wrapper" aria-label="Navigate previous">
                                                                    <div class="button-icon"> </div>
                                                                </div>
                                                            </div>
                                                        </button>
                                                        <button class="button needs-pie next-topic-button" title="Next topic" disabled="true">
                                                            <div>
                                                                <div role="img" class="button-icon-wrapper" aria-label="Navigate next">
                                                                    <div class="button-icon"> </div>
                                                                </div>
                                                            </div>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="body-main">
                                                <!-- Main content body -->
                                                <div role="main" id="mc-main-content">
                                                    <h1>Migrate registry-key-based Office 365 Silent Activation to new configuration</h1>
                                                    <div class="noteOkta">
                                                        <img src="../../../Resources/Images/assets/Icons/Notes/Help.png" class="noteImgFloat" title="Info" alt="Info" />
                                                        <p class="noteHeading">Note</p>
                                                        <ul>
                                                            <li>
                                                                <p>This topic is intended for orgs that implemented the Early Access version of this feature prior to the 2019.09.0 release. If this applies to your org, you must complete this migration procedure.</p>
                                                            </li>
                                                            <li>
                                                                <p>If you are implementing this feature for the first time after the 2019.09.0 release, please follow the instructions in <a href="../Apps_O365_Silent_Activation.htm" class="MCXref xref">Office 365 Silent Activation: New Implementations</a>.</p>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                    <p>This procedure describes how to migrate your registry-key-based Office 365 Silent Activation configuration to the new Kerberos-based configuration. The new configuration uses Kerberos authentication which eliminates the need of registry keys.</p>
                                                    <h2>Start this procedure</h2>
                                                    <p>This procedure includes the following main steps:</p>
                                                    <p><a href="#A." class="MCXref xref">A. Create and test a new Kerberos subdomain</a>
                                                    </p>
                                                    <p><a href="#B." class="MCXref xref">B. Create and confirm a new DNS record for your org</a>
                                                    </p>
                                                    <p><a href="#C." class="MCXref xref">C. Test the new setup</a>
                                                    </p>
                                                    <div class="noteOkta">
                                                        <img src="../../../Resources/Images/assets/Icons/Notes/Help.png" class="noteImgFloat" title="Important Note" alt="Important Note" />
                                                        <p class="noteHeading">Important</p>
                                                        <p class="noteContent">
                                                            <ul>
                                                                <li>If a Client Access Policy in Office 365 is set to deny web browsers, it will also block the silent activation.</li>
                                                                <li>If your app or Okta sign-on policy requires MFA for web browsers, there will be no MFA&#160;when logging in through silent activation.</li>
                                                                <li> SWA sign-on is not supported.</li>
                                                            </ul>
                                                        </p>
                                                    </div>
                                                    <div>
                                                        <h3><a name="A."></a>A. Create and test a new Kerberos subdomain</h3>
                                                        <h4>1. Add a new kerberos subdomain SPN</h4>
                                                        <div class="note_cautionOkta">
                                                            <img src="../../../Resources/Images/assets/Icons/Notes/Alert.png" class="noteImgFloat" title="Caution" alt="Caution" />
                                                            <p class="noteHeading">Caution</p>
                                                            <p class="noteContent">Use the same service account that you are using currently. Changing the service account can cause Silent Activation authentication requests to fail.
			</p>
                                                        </div>
                                                        <ol>
                                                            <li value="1">In your <b>AD environment</b>, open a command prompt as an administrator.</li>
                                                            <li value="2">
                                                                <p>Run the following command to add a new Kerberos subdomain SPN:</p>
                                                                <p><span class="code">setspn -S HTTP/&lt;yourorg&gt;.kerberos.&lt;oktaorgtype&gt;.com &lt;serviceAccountName&gt;</span>
                                                                </p>
                                                                <table style="width: 100%;mc-table-style: url('../../../Resources/TableStyles/standard.css');" class="TableStyle-standard" cellspacing="0">
                                                                    <col class="TableStyle-standard-Column-Column1" style="width: 808px;" />
                                                                    <col class="TableStyle-standard-Column-Column1" />
                                                                    <thead>
                                                                        <tr class="TableStyle-standard-Head-Header1">
                                                                            <th class="TableStyle-standard-HeadF-Column1-Header1">
                                                                                <p>Placeholder</p>
                                                                            </th>
                                                                            <th class="TableStyle-standard-HeadD-Column1-Header1">
                                                                                <p>Value</p>
                                                                            </th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr class="TableStyle-standard-Body-Body1">
                                                                            <td class="TableStyle-standard-BodyF-Column1-Body1">
                                                                                <p><span class="code">HTTP/&lt;yourorg&gt;.kerberos.&lt;oktaorgtype&gt;.com</span>
                                                                                </p>
                                                                            </td>
                                                                            <td class="TableStyle-standard-BodyD-Column1-Body1">Your SPN.</td>
                                                                        </tr>
                                                                        <tr class="TableStyle-standard-Body-Body2">
                                                                            <td class="TableStyle-standard-BodyF-Column1-Body2">
                                                                                <p><span class="code">oktaorgtype</span>
                                                                                </p>
                                                                            </td>
                                                                            <td class="TableStyle-standard-BodyD-Column1-Body2">
                                                                                <p>Your Okta org type. For example: oktapreview, okta-emea, or okta-gov.</p>
                                                                            </td>
                                                                        </tr>
                                                                        <tr class="TableStyle-standard-Body-Body1">
                                                                            <td class="TableStyle-standard-BodyC-Column1-Body1">
                                                                                <p><span class="code">serviceAccountName</span>
                                                                                </p>
                                                                            </td>
                                                                            <td class="TableStyle-standard-BodyA-Column1-Body1">Your service account name. This is the name you used when configuring the Early Access version of Agentless Desktop SSO.</td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                                <p style="font-weight: bold;">Example</p>
                                                                <p id="code">setspn -S HTTP/qa-synth.kerberos.oktapreview.com spndefault</p>
                                                                <div class="noteOkta">
                                                                    <img src="../../../Resources/Images/assets/Icons/Notes/Help.png" class="noteImgFloat" title="Info" alt="Info" />
                                                                    <p class="noteHeading">Note</p>
                                                                    <p class="noteContent">This command does not create a new AD user account. Instead, it adds a new SPN to the existing AD user account. This command is applicable to all orgs, including those that are using a custom URL.</p>
                                                                </div>
                                                            </li>
                                                            <li value="3">
                                                                <p>If you have multiple AD forests, repeat Step 2 for each forest.</p>
                                                                <p>SPNs are unique across a forest so you only need to do this once in each forest.</p>
                                                            </li>
                                                        </ol>
                                                        <h4>2. Verify the new kerberos subdomain SPN</h4>
                                                        <ol>
                                                            <li value="1">
                                                                <p>In <span class="uicontrol">Windows Powershell</span>, enter the following command to confirm that the new DNS and SPN entries are updated:</p>
                                                                <p><span class="code">klist get HTTP/&lt;yourorg&gt;.kerberos.&lt;oktaorgtype&gt;.com</span>
                                                                </p>
                                                                <p><span class="uicontrol">Example</span>
                                                                </p>
                                                                <p> <span class="code">klist get HTTP/atko.kerberos.oktapreview.com</span></p>
                                                            </li>
                                                            <li value="2">
                                                                <p>Confirm that you get the message about successful ticket retrieval. 
</p>
                                                                <p><span class="uicontrol">Example</span>
                                                                </p>
                                                                <p><a class="MCPopupThumbnailLink MCPopupThumbnailPopup" href="../../../Resources/Images/Office365/test-spn-klist-result.png"><img class="MCPopupThumbnail img" data-mc-width="1082" data-mc-height="522" src="../../../Resources/Images/Office365/test-spn-klist-result_thumb_220_220.png" tabindex="" id="imgthumbnail" /></a>
                                                                </p>
                                                            </li>
                                                        </ol>
                                                        <h4>3. Add the new kerberos subdomain to intranet zone</h4>
                                                        <p>Add <code>https://&lt;yourorg&gt;.kerberos.&lt;oktaorgtype&gt;.com</code> to the intranet site list in your internet settings for all the devices that should use Silent Activation.</p>
                                                        <p style="font-weight: normal;">In Internet Explorer,</p>
                                                        <ol style="list-style-type: lower-alpha;">
                                                            <li value="1"> Go to <span class="uicontrol">Settings &gt;&#160;Internet Options &gt; Security.</span></li>
                                                            <li value="2">
                        On the <span class="uicontrol">Security</span> tab, click <span class="uicontrol">Local Intranet &gt;&#160;Sites &gt; Advanced</span>. </li>
                                                            <li value="3">
                                                                <p>Add the URL for your Okta org as configured in the earlier steps. </p>
                                                                <p><span class="url">https://&lt;yourorg&gt;.kerberos.&lt;oktaorgtype&gt;.com</span>
                                                                </p>
                                                                <p>Example: <span class="url">https://atkodemo.kerberos.oktapreview.com</span></p>
                                                            </li>
                                                            <li value="4">Click <span class="uicontrol">Close</span> and <span class="uicontrol">OK</span>&#160;on the other configuration options.</li>
                                                        </ol>
                                                    </div>
                                                    <div>
                                                        <h3><a name="B."></a>B. Create and confirm a new DNS record for your org</h3>
                                                        <p>Prerequisite: Domain administrator privileges  to set the SPN.</p>
                                                        <h4>1. Create a new DNS&#160;record for your org</h4>
                                                        <p>In the <span class="uicontrol">Okta Admin Console</span>, </p>
                                                        <ol>
                                                            <li value="1">Go to <span class="uicontrol">Security &gt; Delegated Authentication.</span></li>
                                                            <li value="2">On the <span class="uicontrol">Delegated Authentication</span> page, click the <span class="uicontrol">Active directory</span> tab.
</li>
                                                            <li value="3">
                                                                <p>Scroll down to the <span class="uicontrol">Agentless Desktop SSO and Silent Activation</span> section and click <span class="uicontrol">Edit</span>.</p>
                                                            </li>
                                                            <li value="4">
                                                                <p>If the <span class="uicontrol">service account username</span> is in the old format (for example:  <span class="code">HTTP/&lt;yourorg&gt;.&lt;oktaorgtype&gt;.com</span>), change it to the sAMAccountname or the username part of the UPN of the service account for which you set up the SPN in Part A.
</p>
                                                                <div class="noteOkta">
                                                                    <img src="../../../Resources/Images/assets/Icons/Notes/Help.png" class="noteImgFloat" title="Important Note" alt="Important Note" />
                                                                    <p class="noteContent">Service account username is case sensitive.</p>
                                                                </div>
                                                                <p><a class="MCPopupThumbnailLink MCPopupThumbnailPopup" href="../../../Resources/Images/Office365/ui-validate-save.png"><img class="MCPopupThumbnail img" data-mc-width="1192" data-mc-height="674" src="../../../Resources/Images/Office365/ui-validate-save_thumb_220_220.png" tabindex="" id="imgthumbnail" /></a>
                                                                </p>
                                                            </li>
                                                            <li value="5">Select <span class="uicontrol">Validate service account credential on save</span>.</li>
                                                            <li value="6">Click <span class="uicontrol">Save</span>.</li>
                                                        </ol>
                                                        <p>This triggers the creation of a new DNS record for your org. Creating a new DNS record can take a few minutes, or in some cases, a few hours.</p>
                                                        <h4>2. Confirm the creation of the new DNS&#160;record</h4>
                                                        <p>Use the following <span class="code">dig</span> (Mac) or <span class="code">nslookup</span> (Windows) commands to confirm that the new Kerberos URL is reachable. </p>
                                                        <div class="noteOkta">
                                                            <img src="../../../Resources/Images/assets/Icons/Notes/Help.png" class="noteImgFloat" title="Info" alt="Info" />
                                                            <p class="noteHeading">Note</p>
                                                            <p class="noteContent">If you do not see a success message, run the command again after a few minutes. In some cases, record creation can take several hours.
Refer to the respective command reference documentation for more information on the output messages.			</p>
                                                        </div>
                                                        <p style="text-decoration: underline;"><b>For Mac</b>
                                                        </p><span class="code">$ dig &lt;yourorg&gt;.kerberos.&lt;oktaorgtype&gt;.com
</span>
                                                        <p style="font-weight: bold;">Example</p>
                                                        <p><a class="MCPopupThumbnailLink MCPopupThumbnailPopup" href="../../../Resources/Images/Office365/test-dns-dig-result.png"><img class="MCPopupThumbnail img" data-mc-width="1138" data-mc-height="640" src="../../../Resources/Images/Office365/test-dns-dig-result_thumb_220_220.png" tabindex="" id="imgthumbnail" /></a>
                                                        </p>
                                                        <p>OR</p>
                                                        <p style="text-decoration: underline;"><b>For Windows</b>
                                                        </p><span class="code">$ nslookup &lt;yourorg&gt;.kerberos.&lt;oktaorgtype&gt;.com</span>
                                                        <p style="font-weight: bold;">Example</p>
                                                        <p><a class="MCPopupThumbnailLink MCPopupThumbnailPopup" href="../../../Resources/Images/Office365/test-dns-lookup-result.png"><img class="MCPopupThumbnail img" data-mc-width="2083" data-mc-height="472" src="../../../Resources/Images/Office365/test-dns-lookup-result_thumb_220_220.png" tabindex="" id="imgthumbnail" /></a>
                                                        </p>
                                                    </div>
                                                    <div>
                                                        <h3><a name="C."></a>C. Test the new setup</h3>
                                                        <p style="font-weight: bold;">Prerequisites</p>
                                                        <ul>
                                                            <li>Test user account that has assigned Office 365 app instance and works with old Silent Activation configuration.</li>
                                                            <li>Following credentials for the test user account:
<ul><li><b>Domain</b>: <code>&lt;yourorg&gt;.kerberos.&lt;oktaorgtype&gt;.com</code></li><li><b>External ID</b>: External ID&#160;of the org in which the test user is. You can find this in the script you used for the org's WS-Fed set up.
</li><li><b>Username</b>: Username part of the test user's UPN.</li><li><b>Password</b>: Password for the test user's account.</li></ul></li>
                                                            <li>Admin permissions on Windows.
</li>
                                                        </ul>
                                                        <p style="font-weight: bold;">Procedure</p>
                                                        <ol>
                                                            <li value="1">
                                                                <p>On <span class="uicontrol">Windows</span>, as an admin run the following PowerShell command:</p>
                                                                <p><span class="code">Get-ExecutionPolicy</span>
                                                                </p>
                                                            </li>
                                                            <li value="2">
                                                                <p>Write down the output policy. We will use this in the last step.</p>
                                                                <p><a class="MCPopupThumbnailLink MCPopupThumbnailPopup" href="../../../Resources/Images/Office365/test-mig-get-policy.png"><img class="MCPopupThumbnail img" data-mc-width="1148" data-mc-height="88" src="../../../Resources/Images/Office365/test-mig-get-policy_thumb_220_220.png" tabindex="" id="imgthumbnail" /></a>
                                                                </p>
                                                            </li>
                                                            <li value="3">
                                                                <p>Change the execution policy to <span class="code">Unrestricted</span> using the following command:</p>
                                                                <p> <span class="code">Set-ExecutionPolicy Unrestricted</span></p>
                                                                <p><a class="MCPopupThumbnailLink MCPopupThumbnailPopup" href="../../../Resources/Images/Office365/test-mig-set-policy.png"><img class="MCPopupThumbnail img" data-mc-width="2680" data-mc-height="288" src="../../../Resources/Images/Office365/test-mig-set-policy_thumb_220_220.png" tabindex="" id="imgthumbnail" /></a>
                                                                </p>
                                                            </li>
                                                            <li value="4">
                                                                <p>Test a user account:</p>
                                                                <ol style="list-style-type: lower-alpha;">
                                                                    <li value="1">
                                                                        <p>Copy the following script into a text file and save the file as <span class="code">Test_windowsTransport.ps1</span>.</p>
                                                                        <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="#" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage" aria-expanded="false"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Script</a></span>
                                                                            <div class="MCDropDownBody dropDownBody">
                                                                                <p id="code">param (</p>
                                                                                <p id="code">[Parameter(Mandatory=$true,</p>
                                                                                <p id="code">HelpMessage="Domain for org. No need to pass kerberos subdomain.")]</p>
                                                                                <p id="code">[string]$domain,</p>
                                                                                <p id="code">[Parameter(Mandatory=$true,</p>
                                                                                <p id="code">HelpMessage="External id of the Office365 app instance.")]</p>
                                                                                <p id="code">[string]$externalId,</p>
                                                                                <p id="code">[Parameter(Mandatory=$true,</p>
                                                                                <p id="code">HelpMessage="Username for the account on the box that should be used for authentication.")]</p>
                                                                                <p id="code">[string]$username,</p>
                                                                                <p id="code">[Parameter(Mandatory=$true,</p>
                                                                                <p id="code">HelpMessage="Password for the account on the box that should be used for authentication.")]</p>
                                                                                <p id="code">[string]$password</p>
                                                                                <p id="code">)</p>
                                                                                <p id="code">&#160;</p>
                                                                                <p id="code">$HTTPREQUEST_SETCREDENTIALS_FOR_SERVER = 0;</p>
                                                                                <p id="code">&#160;</p>
                                                                                <p id="code">$path = "app/office365/{0}/sso/wsfed/windowstransport" -f $externalId</p>
                                                                                <p id="code">$url = "https://{0}/{1}" -f $domain, $path</p>
                                                                                <p id="code">Write-Host ("Url: {0}" -f $url)</p>
                                                                                <p id="code">&#160;</p>
                                                                                <p id="code">$soapPayload =</p>
                                                                                <p id="code">@'</p>
                                                                                <p id="code">&lt;s:Envelope xmlns:s='http://www.w3.org/2003/05/soap-envelope'</p>
                                                                                <p id="code">xmlns:wsa='http://www.w3.org/2005/08/addressing'</p>
                                                                                <p id="code">xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'&gt;</p>
                                                                                <p id="code">&lt;s:Header&gt;</p>
                                                                                <p id="code">&lt;wsa:Action s:mustUnderstand='1'&gt;http://schemas.xmlsoap.org/ws/2005/02/trust/RST/Issue&lt;/wsa:Action&gt;</p>
                                                                                <p id="code">&lt;wsa:messageID&gt;urn:uuid:099B1123-4E9C-4244-8F51-B92937BFA08E&lt;/wsa:messageID&gt;</p>
                                                                                <p id="code">&lt;wsa:ReplyTo&gt;</p>
                                                                                <p id="code">&lt;wsa:Address&gt;http://www.w3.org/2005/08/addressing/anonymous&lt;/wsa:Address&gt;</p>
                                                                                <p id="code">&lt;/wsa:ReplyTo&gt;</p>
                                                                                <p id="code">&lt;wsa:To s:mustUnderstand='1'&gt;{0}&lt;/wsa:To&gt;</p>
                                                                                <p id="code">&lt;/s:Header&gt;</p>
                                                                                <p id="code">&lt;s:Body&gt;</p>
                                                                                <p id="code">&lt;wst:RequestSecurityToken xmlns:wst='http://schemas.xmlsoap.org/ws/2005/02/trust'&gt;</p>
                                                                                <p id="code">&lt;wsp:AppliesTo xmlns:wsp='http://schemas.xmlsoap.org/ws/2004/09/policy'&gt;</p>
                                                                                <p id="code">&lt;wsa:EndpointReference&gt;</p>
                                                                                <p id="code">&lt;wsa:Address&gt;urn:federation:MicrosoftOnline&lt;/wsa:Address&gt;</p>
                                                                                <p id="code">&lt;/wsa:EndpointReference&gt;</p>
                                                                                <p id="code">&lt;/wsp:AppliesTo&gt;</p>
                                                                                <p id="code">&lt;wst:KeyType&gt;http://schemas.xmlsoap.org/ws/2005/05/identity/NoProofKey&lt;/wst:KeyType&gt;</p>
                                                                                <p id="code">&lt;wst:RequestType&gt;http://schemas.xmlsoap.org/ws/2005/02/trust/Issue&lt;/wst:RequestType&gt;</p>
                                                                                <p id="code">&lt;/wst:RequestSecurityToken&gt;</p>
                                                                                <p id="code">&lt;/s:Body&gt;</p>
                                                                                <p id="code">&lt;/s:Envelope&gt;</p>
                                                                                <p id="code">'@ -f $url</p>
                                                                                <p id="code">&#160;</p>
                                                                                <p id="code">$winHttp = New-Object -Com "WinHttp.WinHttpRequest.5.1"</p>
                                                                                <p id="code">$winHttp.open("POST", $url, $false)</p>
                                                                                <p id="code">&#160;</p>
                                                                                <p id="code">$winHttp.SetRequestHeader("Content-Type", "application/soap+xml; charset=utf-8")</p>
                                                                                <p id="code">$winHttp.SetRequestHeader("SOAPAction", "http://schemas.xmlsoap.org/ws/2005/02/trust/RST/Issue")</p>
                                                                                <p id="code">$winHttp.SetRequestHeader("x-client-OS", "10.0.14393")</p>
                                                                                <p id="code">$winHttp.SetRequestHeader("x-client-SKU", "Win32")</p>
                                                                                <p id="code">$winHttp.SetRequestHeader("x-client-Ver", "v2.2.1.28801")</p>
                                                                                <p id="code">&#160;</p>
                                                                                <p id="code">$winHttp.send($soapPayload)</p>
                                                                                <p id="code">&#160;</p>
                                                                                <p id="code">if ($winHttp.Status -ne [int]401) {</p>
                                                                                <p id="code">Write-Error ("Received unexpected response status: {0}, expected 401." -f $winHttp.Status)</p>
                                                                                <p id="code">}</p>
                                                                                <p id="code">&#160;</p>
                                                                                <p id="code">Write-Host "Received 401 response status."</p>
                                                                                <p id="code">&#160;</p>
                                                                                <p id="code">$winHttp.SetCredentials($username, $password, $HTTPREQUEST_SETCREDENTIALS_FOR_SERVER)</p>
                                                                                <p id="code">$winHttp.send($soapPayload)</p>
                                                                                <p id="code">&#160;</p>
                                                                                <p id="code">if ($winHttp.Status -ne [int]200) {</p>
                                                                                <p id="code">Write-Error ("Received unexpected response status: {0}, expected 200." -f $http.Status)</p>
                                                                                <p id="code">}</p>
                                                                                <p id="code">&#160;</p>
                                                                                <p id="code">Write-Host ("Received {0} response status." -f $winHttp.Status)</p>
                                                                                <p id="code">&#160;</p>
                                                                                <p id="code">$samlTicket = [XML]$winHttp.ResponseText</p>
                                                                                <p id="code">&#160;</p>
                                                                                <p id="code">if (-not $samlTicket.Envelope.Body.RequestSecurityTokenResponse.RequestedSecurityToken) {</p>
                                                                                <p id="code">Write-Error ("Response did not contain saml ticket.")</p>
                                                                                <p id="code">}</p>
                                                                                <p id="code">&#160;</p>
                                                                                <p id="code">Write-Host ("Valid SAML ticket received.")</p>
                                                                            </div>
                                                                        </div>
                                                                    </li>
                                                                    <li value="2">
                                                                        <p>Run the following command in PowerShell:</p>
                                                                        <p><span class="code">.\Test_windowsTransport.ps1 -domain &lt;yourorg&gt;.kerberos.&lt;oktaorgtype&gt;.com -externalId &lt;orgexternalid&gt; -username &lt;testusername&gt; -password &lt;-testpassword&gt;</span>
                                                                        </p>
                                                                    </li>
                                                                    <li value="3">
                                                                        <p>Confirm that you get the following successful SAML message:</p>
                                                                        <p><span class="code">Valid SAML ticket received.</span>
                                                                        </p>
                                                                        <p><a class="MCPopupThumbnailLink MCPopupThumbnailPopup" href="../../../Resources/Images/Office365/test-mig-test-user.png"><img class="MCPopupThumbnail img" data-mc-width="2225" data-mc-height="148" src="../../../Resources/Images/Office365/test-mig-test-user_thumb_220_220.png" tabindex="" id="imgthumbnail" /></a>
                                                                        </p>
                                                                        <p>This confirms that Silent Activation is successful for the test user.</p>
                                                                    </li>
                                                                </ol>
                                                            </li>
                                                            <li value="5">
                                                                <p>Change the execution policy back to the initial one from step 2 using the following command:</p>
                                                                <p><span class="code">Set-ExecutionPolicy &lt;initialPolicy&gt;</span>
                                                                </p>
                                                            </li>
                                                        </ol>
                                                    </div>
                                                    <h2>See also</h2>
                                                    <p><a href="../Apps_O365_Silent_Activation.htm" class="MCXref xref">Office 365 Silent Activation: New Implementations</a>
                                                    </p>
                                                    <p><a href="advanced.htm" class="MCXref xref">Advanced integration topics for Office 365</a>
                                                    </p>
                                                    <p><a href="../Office365-Deployment/deploy-main.htm" class="MCXref xref">Typical workflow for deploying Microsoft Office 365 in Okta</a>
                                                    </p>
                                                </div>
                                                <!-- Back to Top button --><a href="#" class="sf-back-to-top"><span class="arrow"></span>Top</a>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- div class="toolbar-main">
            <MadCap:topicToolbarProxy data-mc-skin="/Project/Skins/okta-toolbar-no-expand.flskn" style="mc-topic-toolbar-items: ;" />
                </div -->
                                    <!-- *********************** Footer rows ********************************* -->
                                    <div class="footer2">
                                        <div>
                                            <p class="copyright">©  <span class="mc-variable okta-variables.Year variable">2022</span> <span class="mc-variable okta-variables.CompanyName variable">Okta, Inc</span>. All Rights Reserved. Various trademarks held by their respective owners.
	</p>
                                        </div>
                                    </div>
                                    <!-- Qualtrics setup to use with script below, replacing getfeedback -->
                                    <div id="ZN_6fGBJ8J3VcIBymN">
                                        <!--DO NOT REMOVE-CONTENTS PLACED HERE-->
                                    </div>
                                    <!-- ********************** Scripts ************************************* -->
                                    <!-- Foundation -->
                                    <script src="../../../Resources/Scripts/js/app.js">
                                    </script>
                                    <script src="../../../Resources/Scripts/js/vendor/what-input.js">
                                    </script>
                                    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.4.4-rc1/js/foundation.min.js">
                                    </script>
                                    <script type="text/javascript" src="../../../Resources/Scripts/js/vendor/qualtrics.js">
                                    </script>
                                    <!-- Coveo -->
                                    <script src="https://static.cloud.coveo.com/searchui/v2.5395/js/CoveoJsSearch.Lazy.min.js" defer="defer">
                                    </script>
                                    <script src="../../../Resources/Scripts/coveo-resources/js/cultures/en.js" id="coveoCultureScript" defer="defer">
                                    </script>
                                    <script src="../../../Resources/Scripts/coveo-resources/js/Coveo.MadcapFlare.RequireJS.js" id="coveoRequireScript" defer="defer">
                                    </script>
                                    <script src="../../../Resources/Scripts/coveo-resources/js/Coveo.MadcapFlare.Okta.js" id="coveoInitscript" defer="defer">
                                    </script>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>
