<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_okta_html5_topnav_nav_poc" data-mc-search-type="Stem" data-mc-help-system-file-name="okta_help.xml" data-mc-path-to-help-system="../../../" data-mc-has-content-body="True" data-mc-toc-path="Authentication|Multifactor Authentication|[%=System.LinkedHeader%]|[%=System.LinkedHeader%]" data-mc-conditions="MultiProdPublish.Classic+OIE" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="typeofcontent" content="documentation" />
        <meta name="audience" content="admin" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="description" content="Troubleshoot the MFA for Windows server RDP Credential Provider for Windows." /><title>Troubleshoot the MFA for Windows Credential Provider | Okta</title>
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, height=device-height" />
        <link rel="shortcut icon" href="../../Resources/Images/favicon.ico" type="image/x-icon" />
        <!-- Google Tag Manager -->
        <!-- End Google Tag Manager -->
        <!-- Google Tag Manager -->
        <!-- End Google Tag Manager -->
        <!-- Pendo Script (Per Chris Bank) -->
        <!-- End Pendo Script -->
        <link href="../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Resources/Stylesheets/okta-main-new-nav.css" rel="stylesheet" type="text/css" />
        <link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.5395/css/CoveoFullSearchNewDesign.css" />
        <style>/*&lt;meta /&gt;*/

.button.select-language-button
{
	-pie-background: linear-gradient(#ffffff, #ffffff);
}

.needs-pie
{
	behavior: url('../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <script src="../../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../Resources/Scripts/require.min.js" type="text/javascript">
        </script>
        <script src="../../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
        <script>
			/* <![CDATA[ */
			(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
			})(window,document,'script','dataLayer','GTM-NMZZV4P');
			/* ]]> */
		</script>
        <script>
			/* <![CDATA[ */
			(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
			})(window,document,'script','dataLayer','GTM-KXMLV58');
			/* ]]> */
		</script>
        <script>
		/* <![CDATA[ */
		(function(apiKey){
			(function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
			v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
			o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
			y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
			z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id:              'VISITOR-UNIQUE-ID'
            },
            account: {
                id:           'ACCOUNT-UNIQUE-ID'
            }
        });
		})('a9bd3885-93ae-46ab-700b-dd29e613c19d');
		/* ]]> */
        function openSurvey() {
            window.open('https://surveys.okta.com/jfe/form/SV_e4L0iW8a3tz8Yol?source=' + encodeURIComponent(document.location.href), '_blank');
        }
		</script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" role="banner" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1024px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="https://help.okta.com/okta_help.htm?id=csh-index" alt="Okta"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="2" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <!-- Google Tag Manager (noscript) -->
                                    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NMZZV4P" height="0" width="0" style="display:none;visibility:hidden"></iframe>
                                    </noscript>
                                    <!-- End Google Tag Manager (noscript) -->
                                    <!-- Google Tag Manager (noscript) -->
                                    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KXMLV58" height="0" width="0" style="display:none;visibility:hidden"></iframe>
                                    </noscript>
                                    <!-- End Google Tag Manager (noscript) -->
                                    <!-- Coveo config parameters -->
                                    <div id="coveo_org_id" style="Display:None"><span class="mc-variable okta-coveo-config.OrgId variable">oktaproduction9ounvcxa</span>
                                    </div>
                                    <div id="coveo_rest_uri" style="Display:None"><span class="mc-variable okta-coveo-config.PlatformRestUri variable">https://platform.cloud.coveo.com/rest/search</span>
                                    </div>
                                    <div id="coveo_search_url" style="Display:None"><span class="mc-variable okta-coveo-config.SearchPageUrl variable">https://support.okta.com/help/s/global-search/%40uri</span>
                                    </div>
                                    <div id="coveo_token_url" style="Display:None"><span class="mc-variable okta-coveo-config.SearchTokenServiceUrl variable">https://support.okta.com/help/services/apexrest/PublicSearchToken?site=help</span>
                                    </div>
                                    <div id="coveo_dev_org_id" style="Display:None"><span class="mc-variable okta-coveo-config.DevOrgId variable">oktanonproduction1il1gtac7</span>
                                    </div>
                                    <div id="coveo_dev_token" style="Display:None"><span class="mc-variable okta-coveo-config.DevSearchToken variable">xxb48840fe-d60d-4e40-b1d3-522d5a35c384</span>
                                    </div>
                                    <!-- End Coveo config parameters -->
                                    <!-- ************** Coveo Search bar ************************************* -->
                                    <!-- set margin and size in /Content/Resources/Scripts/coveo-resources/css/Coveo.Okta.StandaloneSearchbox.min.css to make room for replacing Flare-generated top-nav with HTML code (see below)-->
                                    <div id="OLC_Coveo_Headline" class="coveo-headline-wrapper" data-mc-conditions="MultiProdPublish.SearchBar">
                                        <div class="slds-p-vertical_small">
                                            <!--Search Bar-->
                                            <div class="slds-grid slds-grid_align-center">
                                                <div id="customSelect" class="CoveoCustomSelect slds-float_right">
                                                </div>
                                                <div id="standaloneSearchbox">
                                                    <div class="CoveoAnalytics" data-search-hub="OktaCommunityFullSearch">
                                                    </div>
                                                    <div class="CoveoTab" data-id="Help" data-caption="Help" style="display:none">
                                                    </div>
                                                    <div class="CoveoSearchbox" data-enable-omnibox="true" data-enable-query-suggest-addon="true">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="replace_top_nav">
                                        <div class="navbar" data-mc-conditions="Primary.live-site-only">
                                            <div class="dropdown" data-test="menuBarCategory" id="documentationMenu" data-mc-conditions="MultiProdPublish.DocMenu">
                                                <button class="dropbtn">Documentation <i class="fa fa-caret-down"></i></button>
                                                <div class="dropdown-content" data-test="menuBarItems">
                                                    <div><a href="https://help.okta.com/en-us/Content/index.htm" data-test="menuBarLink">Product documentation</a>
                                                    </div>
                                                    <div><a href="https://developer.okta.com" target="_blank" data-test="menuBarLink">Developer documentation</a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="dropdown" data-test="menuBarCategory" id="knowledgebaseMenu"><a href="https://support.okta.com/help/s/knowledge?language=en_US" data-test="menuBarLink">Knowledge base</a>
                                            </div>
                                            <div class="dropdown" data-test="menuBarCategory" id="communityMenu">
                                                <button class="dropbtn">Community <i class="fa fa-caret-down"></i></button>
                                                <div class="dropdown-content" data-test="menuBarItems">
                                                    <div><a href="https://support.okta.com/help/s/community?language=en_US" data-test="menuBarLink">Home</a>
                                                    </div>
                                                    <div><a href="https://support.okta.com/help/s/group/CollaborationGroup/Recent?language=en_US" data-test="menuBarLink">Discussions</a>
                                                    </div>
                                                    <div><a href="https://support.okta.com/help/s/questions?language=en_US" data-test="menuBarLink">Questions</a>
                                                    </div>
                                                    <div><a href="https://support.okta.com/help/s/ideas?language=en_US" target="_blank" data-test="menuBarLink">Ideas</a>
                                                    </div>
                                                    <div><a href="https://support.okta.com/help/s/events?language=en_US" data-test="menuBarLink">Webinars</a>
                                                    </div>
                                                    <div><a href="https://support.okta.com/help/s/blogs?language=en_US" data-test="menuBarLink">Blogs</a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="dropdown" data-test="menuBarCategory" id="productMenu">
                                                <button class="dropbtn">Product <i class="fa fa-caret-down"></i></button>
                                                <div class="dropdown-content" data-test="menuBarItems">
                                                    <div><a href="https://support.okta.com/help/s/productroadmap?language=en_US" data-test="menuBarLink">Roadmap</a>
                                                    </div>
                                                    <div><a href="https://support.okta.com/help/s/product-hub?language=en_US" data-test="menuBarLink">Product hub</a>
                                                    </div>
                                                    <div><a href="https://support.okta.com/help/s/mysuccesshub/get-started?language=en_US" data-test="menuBarLink">Customer success hub</a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="dropdown" data-test="menuBarCategory" id="trainingMenu"><a href="https://www.okta.com/services/education-services/" target="_blank" data-test="menuBarLink">Training</a>
                                            </div>
                                        </div>
                                        <div class="logo_container" id="OktaBanner" data-mc-conditions="Primary.live-site-only"><a class="logo" href="https://help.okta.com/okta_help.htm?id=csh-index" data-test="OktaBanner"><img src="../../Resources/Images/okta-assets/Logo.png" alt="Okta product documentation" title="Okta product documentation" data-test="OktaBannerImg" /></a>
                                        </div>
                                        <div class="toolbar-main" data-test="toolBar" data-mc-conditions="Primary.live-site-only">
                                            <div class="buttons popup-container clearfix topicToolbarProxy _Skins_okta_toolbar_no_expand mc-component nocontent" style="mc-topic-toolbar-items: ;">
                                                <div class="button-group-container-left">
                                                    <button class="button needs-pie select-language-button" title="Change language">
                                                        <div>
                                                            <div role="img" class="button-icon-wrapper" aria-label="Change language">
                                                                <div class="button-icon"> </div>
                                                            </div>
                                                        </div>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- **********************  Main content row  ********************** -->
                                    <div class="okta-topics" data-test="bodyWrapper">
                                        <!-- *** Col1: Body Col *** -->
                                        <div>
                                            <div class="is-not-in-mobile">
                                                <!-- Breadcrumbs -->
                                                <div class="nocontent">
                                                    <div class="MCBreadcrumbsBox_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider="  &gt;  " data-mc-breadcrumbs-count="3" data-mc-toc="True">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="oie-label" data-mc-conditions="MultiProdPublish.Classic">
                                                <img class="oie-label" title="Label: Okta Classic Engine content" src="../../Resources/Images/okta-assets/Classic_Engine.svg" />
                                            </div>
                                            <div class="body-main" data-test="bodyContent">
                                                <!-- Main content body -->
                                                <div role="main" id="mc-main-content">
                                                    <h1>Troubleshoot the MFA for Windows Credential Provider</h1>
                                                    <p>Troubleshooting scenarios and solutions</p>
                                                    <h3>MFA Bypass dialog displays during sign in</h3>
                                                    <p>Symptom: </p>
                                                    <p>The <span class="wintitle">MFA Bypass</span> dialog is displayed when signing in.</p>
                                                    <p>Solution: </p>
                                                    <p>Verify in Okta that the user is included in an MFA policy.
</p>
                                                    <div class="noteOkta">
                                                        <p class="noteContent">An App-SignOn Policy is the only policy that is relevant to the Microsoft RDP App.</p>
                                                    </div>
                                                    <h3><span class="wintitle">Display Failed</span> dialog displays during sign in </h3>
                                                    <p>Symptom:</p>
                                                    <p>The <span class="wintitle">Display Failed</span> dialog is displayed when signing in.</p>
                                                    <p>Verify:</p>
                                                    <ul>
                                                        <li>The client ID, the client secret, and the Okta URL are configured correctly.</li>
                                                        <li>The username entered into the Windows sign in matches the username in Okta.</li>
                                                    </ul>
                                                    <h3>Can't RDP into a server</h3>
                                                    <p>Symptom: </p>
                                                    <p>End user can't use an RDP client to connect to a Okta Credential Provider for Windows supported workstation or server.          </p>
                                                    <p>Solution: </p>
                                                    <p>Verify that <span class="uicontrol">Allow remote connections to this computer</span> and <span class="uicontrol">Allow connections only from computers running Remote Desktop with Network Level Authentication</span>  are enabled as shown in the <span class="wintitle">System Properties</span> dialog.</p>
                                                    <h3>System.Net.WebException
displayed					
						</h3>
                                                    <p>
            Symptom: </p>
                                                    <p>An exception, similar to that shown below, is displayed, the likely case is an older version of TLS. Okta requires TLS 1.2 or later.</p><span class="codeblock">System.Net.WebException: The underlying connection was closed: An unexpected error occurred on a send.
. . . 
System.IO.IOException: Unable to read data from the transport connection: An existing connection was forcibly closed by the remote host. 
. . . 
System.Net.Sockets.SocketException: An existing connection was forcibly closed by the remote host.</span>
                                                    <p>
            Solution: 				    </p>
                                                    <p>Open a PowerShell terminal as administrator and execute the following script:
</p>
                                                    <div>
                                                        <div class="codeSnippet"><a class="codeSnippetCopyButton" role="button" href="javascript:void(0);">Copy</a>
                                                            <div style="mc-code-lang: PowerShell;" class="codeSnippetBody" data-mc-continue="False" data-mc-line-number-start="1" data-mc-use-line-numbers="True"><pre><span class="codeSnippetLineNumbers" style="border-right: #AAA 2px solid;" aria-hidden="true">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
</span><code><span style="font-weight: bold; ">$is64bit</span> = [IntPtr]::Size * <span style="color: #333333; ">8</span> <span style="color: #795da3; ">-eq</span> <span style="color: #333333; ">64</span><br /><span style="color: #a71d5d; font-weight: bold; ">Write-Host</span> <span style="color: #df5000; ">"Is 64-bit script: $is64bit"</span><br /><span style="color: #969896; ">#helper function to check for if 0x800 bit is set</span><br /><span style="color: #a71d5d; font-weight: bold; ">function</span> checkTls12Bit([Int] <span style="font-weight: bold; ">$regValue</span>) {<br />    <span style="color: #a71d5d; ">return</span> (<span style="font-weight: bold; ">$regValue</span> <span style="color: #795da3; ">-band</span> <span style="color: #333333; ">0x800</span>) <span style="color: #795da3; ">-ne</span> <span style="color: #333333; ">0x800</span><br />}<br /><br /><span style="color: #a71d5d; font-weight: bold; ">function</span> setRegKeyToBitValue([string] <span style="font-weight: bold; ">$regBranch</span>, [string] <span style="font-weight: bold; ">$regKey</span>) {<br />    <span style="font-weight: bold; ">$current</span> = <span style="color: #a71d5d; font-weight: bold; ">Get-ItemProperty</span> -Path <span style="font-weight: bold; ">$regBranch</span> -ErrorAction SilentlyContinue<br />    <span style="color: #a71d5d; font-weight: bold; ">if</span> (<span style="font-weight: bold; ">$current</span> <span style="color: #795da3; ">-eq</span> <span style="font-weight: bold; ">$null</span>) {<br />        <span style="color: #a71d5d; font-weight: bold; ">Write-Host</span> <span style="color: #df5000; ">"$regBranch\$regKey does not exist. No change."</span> <br />        <span style="color: #a71d5d; ">return</span> <span style="font-weight: bold; ">$false</span><br />    }<br />    <span style="font-weight: bold; ">$regValue</span> = <span style="font-weight: bold; ">$current</span>.<span style="font-weight: bold; ">$regKey</span><br />    <span style="color: #a71d5d; font-weight: bold; ">if</span> (<span style="font-weight: bold; ">$regValue</span> <span style="color: #795da3; ">-eq</span> <span style="font-weight: bold; ">$null</span> <span style="color: #795da3; ">-or</span> (checkTls12Bit <span style="font-weight: bold; ">$regValue</span>) ) {<br />        <span style="color: #a71d5d; font-weight: bold; ">if</span> (<span style="font-weight: bold; ">$regValue</span> <span style="color: #795da3; ">-eq</span> <span style="font-weight: bold; ">$null</span>) {<br />            <span style="font-weight: bold; ">$regValue</span> = <span style="color: #333333; ">0x800</span><br />         } <span style="color: #a71d5d; font-weight: bold; ">else</span>    {<br />             <span style="font-weight: bold; ">$regValue</span> = <span style="font-weight: bold; ">$regValue</span> <span style="color: #795da3; ">-bor</span> <span style="color: #333333; ">0x800</span><br />          }<br /><br />         <span style="font-weight: bold; ">$p</span> = <span style="color: #a71d5d; font-weight: bold; ">New-ItemProperty</span> <span style="font-weight: bold; ">$regBranch</span> -Name <span style="font-weight: bold; ">$regKey</span> -PropertyType DWord -Value <span style="font-weight: bold; ">$regValue</span> -ErrorAction Stop -Force<br />         <span style="color: #a71d5d; font-weight: bold; ">Write-Host</span> <span style="color: #df5000; ">"Updated $regBranch\$regKey value to $regValue"</span> <br />         <span style="color: #a71d5d; ">return</span> <span style="font-weight: bold; ">$true</span><br />     }<br />    <span style="color: #a71d5d; font-weight: bold; ">Write-Host</span> <span style="color: #df5000; ">"$regBranch\$regKey value is $regValue. No change."</span><br />    <span style="color: #a71d5d; ">return</span> <span style="font-weight: bold; ">$false</span><br />}<br /><br /><span style="color: #a71d5d; font-weight: bold; ">function</span> setRegKeyToValueOfOne([string] <span style="font-weight: bold; ">$regBranch</span>, [string] <span style="font-weight: bold; ">$regKey</span>) {<br />    <span style="font-weight: bold; ">$current</span> = <span style="color: #a71d5d; font-weight: bold; ">Get-ItemProperty</span> -Path <span style="font-weight: bold; ">$regBranch</span> -ErrorAction SilentlyContinue<br />    <span style="color: #a71d5d; font-weight: bold; ">if</span> (<span style="font-weight: bold; ">$current</span> <span style="color: #795da3; ">-eq</span> <span style="font-weight: bold; ">$null</span>) {<br />        <span style="color: #a71d5d; font-weight: bold; ">Write-Host</span> <span style="color: #df5000; ">"$regBranch\$regKey does not exist. No change."</span> <br />        <span style="color: #a71d5d; ">return</span> <span style="font-weight: bold; ">$false</span><br />    }<br />    <span style="color: #a71d5d; font-weight: bold; ">if</span> (<span style="font-weight: bold; ">$current</span>.<span style="font-weight: bold; ">$regKey</span> <span style="color: #795da3; ">-ne</span> <span style="color: #333333; ">1</span>) {<br />        <span style="font-weight: bold; ">$p</span> = <span style="color: #a71d5d; font-weight: bold; ">New-ItemProperty</span> <span style="font-weight: bold; ">$regBranch</span> -Name <span style="font-weight: bold; ">$regKey</span> -PropertyType DWord -Value <span style="color: #333333; ">1</span> -ErrorAction Stop -Force<br />        <span style="color: #a71d5d; font-weight: bold; ">Write-Host</span> <span style="color: #df5000; ">"Updated $regBranch\$regKey value to 1"</span><br />        <span style="color: #a71d5d; ">return</span> <span style="font-weight: bold; ">$true</span><br />     }<br />    <span style="color: #a71d5d; font-weight: bold; ">Write-Host</span> <span style="color: #df5000; ">"$regBranch\$regKey value is 1. No change."</span><br />    <span style="color: #a71d5d; ">return</span> <span style="font-weight: bold; ">$false</span><br />}<br /><br /><span style="color: #969896; ">#setup .net tls settings</span><br /><span style="color: #a71d5d; font-weight: bold; ">function</span> setupTls4NET([boolean]<span style="font-weight: bold; ">$is64bit</span>, [string]<span style="font-weight: bold; ">$regBranch</span>, [string]<span style="font-weight: bold; ">$reg32bitBranch</span>) {<br /><span style="color: #969896; "># https://docs.microsoft.com/en-us/dotnet/framework/network-programming/tls</span><br />    <span style="font-weight: bold; ">$updated</span> = setRegKeyToValueOfOne <span style="font-weight: bold; ">$regBranch</span> <span style="color: #df5000; ">"SchUseStrongCrypto"</span><br />    <span style="font-weight: bold; ">$updated</span> = (setRegKeyToValueOfOne <span style="font-weight: bold; ">$regBranch</span> <span style="color: #df5000; ">"SystemDefaultTlsVersions"</span>) <span style="color: #795da3; ">-or</span> <span style="font-weight: bold; ">$updated</span><br /><br />    <span style="color: #a71d5d; font-weight: bold; ">if</span> (<span style="font-weight: bold; ">$is64bit</span>) {<br />        <span style="font-weight: bold; ">$updated</span> = (setRegKeyToValueOfOne <span style="font-weight: bold; ">$reg32bitBranch</span> <span style="color: #df5000; ">"SchUseStrongCrypto"</span>) <span style="color: #795da3; ">-or</span> <span style="font-weight: bold; ">$updated</span><br />        <span style="font-weight: bold; ">$updated</span> = (setRegKeyToValueOfOne <span style="font-weight: bold; ">$reg32bitBranch</span> <span style="color: #df5000; ">"SystemDefaultTlsVersions"</span>) <span style="color: #795da3; ">-or</span> <span style="font-weight: bold; ">$updated</span><br />    }<br /><br />    <span style="color: #a71d5d; ">return</span> <span style="font-weight: bold; ">$updated</span><br />}                            <br /><span style="color: #969896; "># https://docs.microsoft.com/en-us/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed</span><br /><br /><span style="font-weight: bold; ">$version</span> = <span style="color: #a71d5d; font-weight: bold; ">Get-ItemProperty</span> -Path <span style="color: #df5000; ">"HKLM:\Software\Microsoft\NET Framework Setup\NDP\v4\Full"</span> -Name Release<br /><span style="color: #969896; "># 394254 - .NET Framework 4.6.1, which is the current target of the installer</span><br /><span style="color: #a71d5d; font-weight: bold; ">if</span> (<span style="font-weight: bold; ">$version</span>.Release <span style="color: #795da3; ">-ge</span> <span style="color: #333333; ">394254</span>)  {<br />    <span style="font-weight: bold; ">$ev</span> = [environment]::Version<br />    <span style="font-weight: bold; ">$v</span> = <span style="color: #df5000; ">"v"</span> + <span style="font-weight: bold; ">$ev</span>.Major + <span style="color: #df5000; ">"."</span> + <span style="font-weight: bold; ">$ev</span>.Minor + <span style="color: #df5000; ">"."</span> + <span style="font-weight: bold; ">$ev</span>.Build<br />    <span style="font-weight: bold; ">$updated</span> = setupTls4NET <span style="font-weight: bold; ">$is64bit</span> <span style="color: #df5000; ">"HKLM:\SOFTWARE\Microsoft\.NETFramework\$v"</span> <span style="color: #df5000; ">"HKLM:\SOFTWARE\Wow6432Node\Microsoft\.NETFramework\$v"</span><br /><span style="color: #969896; "># https://support.microsoft.com/en-ca/help/3140245/update-to-enable-tls-1-1-and-tls-1-2-as-a-default-secure-protocols-in</span><br /><br />    <span style="font-weight: bold; ">$updated</span> = (setRegKeyToBitValue <span style="color: #df5000; ">"HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings\WinHttp"</span> <span style="color: #df5000; ">"DefaultSecureProtocols"</span>) <span style="color: #795da3; ">-or</span> <span style="font-weight: bold; ">$updated</span><br />    <span style="font-weight: bold; ">$updated</span> = (setRegKeyToBitValue <span style="color: #df5000; ">"HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings"</span> <span style="color: #df5000; ">"SecureProtocols"</span>) <span style="color: #795da3; ">-or</span> <span style="font-weight: bold; ">$updated</span><br /><br />    <span style="color: #969896; "># updated the 32-bit branches if we are on 64-bit machine</span><br />    <span style="color: #a71d5d; font-weight: bold; ">if</span> (<span style="font-weight: bold; ">$is64bit</span>) {<br />        <span style="font-weight: bold; ">$updated</span> = (setRegKeyToBitValue <span style="color: #df5000; ">"HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Internet Settings\WinHttp"</span> <span style="color: #df5000; ">"DefaultSecureProtocols"</span>) <span style="color: #795da3; ">-or</span> <span style="font-weight: bold; ">$updated</span><br />        <span style="font-weight: bold; ">$updated</span> = (setRegKeyToBitValue <span style="color: #df5000; ">"HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Internet Settings"</span> <span style="color: #df5000; ">"SecureProtocols"</span>) <span style="color: #795da3; ">-or</span> <span style="font-weight: bold; ">$updated</span><br />    }<br /><br />    <span style="color: #969896; "># current user settings</span><br />    <span style="font-weight: bold; ">$updated</span> = (setRegKeyToBitValue <span style="color: #df5000; ">"HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings"</span> <span style="color: #df5000; ">"SecureProtocols"</span>) <span style="color: #795da3; ">-or</span> <span style="font-weight: bold; ">$updated</span><br /><br />    <span style="color: #969896; "># local system account</span><br />    <span style="font-weight: bold; ">$userSid</span> = <span style="color: #df5000; ">".DEFAULT"</span><br />    <span style="font-weight: bold; ">$updated</span> = (setRegKeyToBitValue <span style="color: #df5000; ">"Registry::HKEY_USERS\$userSid\Software\Microsoft\Windows\CurrentVersion\Internet Settings"</span> <span style="color: #df5000; ">"SecureProtocols"</span>) <span style="color: #795da3; ">-or</span> <span style="font-weight: bold; ">$updated</span><br /><br />    <span style="color: #a71d5d; font-weight: bold; ">if</span> (<span style="font-weight: bold; ">$updated</span>) {<br />        <span style="color: #a71d5d; font-weight: bold; ">Write-Host</span> <span style="color: #df5000; ">"Done. Updated required settings."</span><br />    }<br />    <span style="color: #a71d5d; font-weight: bold; ">else</span><br />    {<br />        <span style="color: #a71d5d; font-weight: bold; ">Write-Host</span> <span style="color: #df5000; ">"Done. No updates are required."</span><br />    }<br />}<br /><span style="color: #a71d5d; font-weight: bold; ">else</span> <br />{<br />    <span style="color: #a71d5d; font-weight: bold; ">Write-Host</span> <span style="color: #df5000; ">"No changes were made. Your version of .NET Framework is earlier version than 4.6.1, please upgrade."</span><br />}        </code></pre>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <h3>Users locked out - disable credential provider using the registry editor</h3>
                                                    <p>Symptom: </p>
                                                    <p>End users can no longer use <a href="proc-mfa-win-creds-rdp.htm">MFA for Windows Credential Provider </a> and the Remote Desktop Protocol to access a Windows host. In effect end users are locked out. </p>
                                                    <p>Solution: </p>
                                                    <p>Use the <span class="wintitle">Windows Registry editor</span> to browse the remote servers registry and disable the MFA for Windows Credential Provider.</p>
                                                    <div class="noteOkta">
                                                        <p class="noteContent">This solution disables the MFA for Windows Credential Provider for all users and requires that an administrator have remote access to the registry of the locked server.Extreme caution should be exercised in editing the Windows registry.</p>
                                                    </div>
                                                    <ol>
                                                        <li value="1">
                                                            <p>Log on to another computer which can reach the host server as the administrator.</p>
                                                        </li>
                                                        <li value="2">
                                                            <p>Open the <span class="uicontrol">Registry Editor</span>.</p>
                                                        </li>
                                                        <li value="3">
                                                            <p>Select <span class="uicontrol">Connect Network Registry</span>. </p>
                                                        </li>
                                                        <li value="4">
                                                            <p>Enter the hostname of the remote server where the MFA for Windows Credential Provider is installed. </p>
                                                        </li>
                                                        <li value="5">
                                                            <p>Click <span class="uicontrol">Check Names</span>. After a moment the hostname will be validated.</p>
                                                        </li>
                                                        <li value="6">
                                                            <p>Click <span class="uicontrol">Ok</span>. The remote registry will open.</p>
                                                        </li>
                                                        <li value="7">
                                                            <p>Navigate to <span class="code">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\Credential Provider Filters</span>.</p>
                                                        </li>
                                                        <li value="8">
                                                            <p>Note the CLSID (or folder name) of the Okta Credential Provider.</p>
                                                        </li>
                                                        <li value="9">
                                                            <p>In <span class="code">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\Credential Providers</span>, locate the CLSID from the prior step.</p>
                                                        </li>
                                                        <li value="10">
                                                            <p>Right click and create a new DWORD with the name <span class="userinput">Disabled</span>  and a value of <span class="userinput">1</span>.</p>
                                                        </li>
                                                        <li value="11">
                                                            <p>Restart the server. On restart, the credential provider should be inactive. </p>
                                                        </li>
                                                    </ol>
                                                    <h3>Users locked out - disable credential provider using PSExec</h3>
                                                    <p>Symptom: </p>
                                                    <p>End users can no longer use <a href="proc-mfa-win-creds-rdp.htm">MFA for Windows Credential Provider</a>
      and the Remote Desktop Protocol to access a Windows host. In effect end users are locked out. </p>
                                                    <p>Additionally other solutions, such as using the Windows Registry editor remotely, can't be used.</p>
                                                    <p>Solution:</p>
                                                    <p> Use psexec to query and modify the registry of the server running the <a href="proc-mfa-win-creds-rdp.htm">MFA for Windows Credential Provider</a>
        to disable the provider.</p>
                                                    <div class="noteOkta">
                                                        <p class="noteContent">This solution requires the use of the System Internals PsExec application. Available for download from <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/psexec">https://docs.microsoft.com/en-us/sysinternals/downloads/psexec</a>.</p>
                                                    </div>
                                                    <div class="noteOkta">
                                                        <p class="noteContent">Enter-PSSession can be used as an alternative to psexec. See <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/enter-pssession">Enter-PSSession</a>. </p>
                                                    </div>
                                                    <ol>
                                                        <li value="1">Open a command prompt as administrator. Using psexec and the Windows reg query command, list the values found in <span class="code">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\Credential Provider Filters</span>. For example:<div class="codeSnippet"><a class="codeSnippetCopyButton" role="button" href="javascript:void(0);">Copy</a><div class="codeSnippetCaption"><p>Query remote registry</p></div><div class="codeSnippetBody" data-mc-continue="False" data-mc-line-number-start="1" data-mc-use-line-numbers="False"><pre><code>psexec \\ipaddress -u username -p password reg query "hklm\software\microsoft\windows\currentversion\authentication\Credential Provider Filters"</code></pre></div></div>Where: <span class="code">\\ipaddress</span> - refers to the IP address of the server running the MFA for Windows Credential provider. For example: \\192.168.1.199<span class="code">-u username</span> - refers to a valid user on the remote server represented by \\ipaddress. For example: -u validuser<span class="code">- p password</span> - refers to the password for the user specified by the <span class="code">-u</span> parameter. For example: -p pwdforValiduserWhich should return a result resembling:
					
<span class="codeblock">HKEY_LOCAL_MACHINE\software\microsoft\windows\currentversion\authentication\Credential Provider Filters\{6D269AEA-...-02AA9C14F310}
HKEY_LOCAL_MACHINE\software\microsoft\windows\currentversion\authentication\Credential Provider Filters\{DDC0EED2-...-EDE16A79A0DE}.
</span></li>
                                                        <li value="2">For each result shown, query to determine which is the OktaCredentialProvider:<div class="codeSnippet"><a class="codeSnippetCopyButton" role="button" href="javascript:void(0);">Copy</a><div class="codeSnippetCaption"><p>Query remote registry</p></div><div class="codeSnippetBody" data-mc-continue="False" data-mc-line-number-start="1" data-mc-use-line-numbers="False"><pre><code>psexec \\ipaddress -u username -p password reg query "hklm\software\microsoft\windows\currentversion\authentication\Credential Provider Filters\{6D269AEA-...-02AA9C14F310}"</code></pre></div></div>Which should return results similar to:<span class="codeblock">HKEY_LOCAL_MACHINE\software\microsoft\windows\currentversion\authentication\Credential Provider Filters\{6D269AEA-...-02AA9C14F310}
(Default)    REG_SZ    OktaCredentialProvider</span></li>
                                                        <li value="3">Using psexec and the reg add command and the class id for the Okta Credential Provider, create a new DWord value with name <span class="userinput">Disabled</span> and value <span class="userinput">1</span>. <div class="codeSnippet"><a class="codeSnippetCopyButton" role="button" href="javascript:void(0);">Copy</a><div class="codeSnippetCaption">Create Disabled entry</div><div class="codeSnippetBody" data-mc-continue="False" data-mc-line-number-start="1" data-mc-use-line-numbers="False"><pre><code>psexec \\ipaddress -u username -p password reg add "hklm\software\microsoft\windows\currentversion\authentication\Credential Provider Filters\{value from prior step}" /f /v Disabled /t REG_DWORD /d 1</code></pre></div></div>			Where:<span class="code">/f</span> - force overwriting<span class="code">/v {name of new entry}</span> - Name of new entry being added, Disabled. <span class="code">/t {type}</span> - Type of new entry added, REG_DWORD.<span class="code">/d {value}</span> - Value of new entry, 1. Which should return a result resembling:<span class="codeblock">The operation completed successfully.</span></li>
                                                        <li value="4">Re-run the prior query which should now return results showing the newly added element and resembling:<span class="codeblock">HKEY_LOCAL_MACHINE\software\microsoft\windows\currentversion\authentication\Credential Provider Filters\{6D269AEA-...-02AA9C14F310}
(Default)    REG_SZ    OktaCredentialProvider
             REG_DWORD Disabled 1</span></li>
                                                        <li value="5">Restart the remote computer using psexec and the shutdown command:<div class="codeSnippet"><a class="codeSnippetCopyButton" role="button" href="javascript:void(0);">Copy</a><div class="codeSnippetCaption"><p>Restart remote server</p></div><div class="codeSnippetBody" data-mc-continue="False" data-mc-line-number-start="1" data-mc-use-line-numbers="False"><pre><code>psexec \\ipaddress -u username -p password shutdown -f -r -t 0</code></pre></div></div>
					Where:
					<span class="code">-f</span> - Force running programs to exit without warning.<span class="code">-r</span> - Full shutdown and reboot.<span class="code">-t</span> 0

- Set timeout before shutdown to zero seconds.</li>
                                                    </ol>
                                                    <p>On restart the credential provider should be inactive.</p>
                                                    <p>After the root cause is determined, the Disabled value can be removed with a command similar to: </p>
                                                    <div class="codeSnippet"><a class="codeSnippetCopyButton" role="button" href="javascript:void(0);">Copy</a>
                                                        <div class="codeSnippetCaption">
                                                            <p>Delete Disabled entry</p>
                                                        </div>
                                                        <div class="codeSnippetBody" data-mc-continue="False" data-mc-line-number-start="1" data-mc-use-line-numbers="False"><pre><code>psexec \\ipaddress -u username -p password reg delete "hklm\software\microsoft\windows\currentversion\authentication\Credential Provider Filters\{class id from prior step}" /f /v Disabled </code></pre>
                                                        </div>
                                                    </div>
                                                    <h3>Credential provider cannot reach Okta</h3>
                                                    <p>Symptom: The credential provider cannot reach Okta. This can happen with or without a proxy.
An exception, similar to that shown below, is thrown.<span class="code">System.Net.WebException: The underlying connection was closed: An unexpected error occurred on a send. </span></p>
                                                    <p>Complete exception</p><span class="codeblock">exception thrown is - System.Net.WebException: The underlying connection was closed: An unexpected error occurred on a send. ---&gt; 
System.IO.IOException: Authentication failed because the remote party has closed the transport stream.
    at System.Net.Security.SslState.StartReadFrame (Byte[] buffer, Int32 readBytes, AsyncProtocolRequest asyncRequest)
    at System.Net.Security.SslState.StartReceiveBlob(Byte[] buffer, AsyncProtocolRequest asyncRequest)
    at System.Net.Security.SslState.CheckCompletionBeforeNextReceive(ProtocolToken message, AsyncProtocolRequest asyncRequest)
    at System.Net.Security.SslState.ForceAuthentication (Boolean receiveFirst, Byte[] buffer, AsyncProtocolRequest asyncRequest)
    at System.Net.Security.SslState.ProcessAuthentication(LazyAsyncResult lazyResult)
    at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean preserveSyncCtx)
    at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean preserveSyncCtx)
    at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)
    at System.Net.TlsStream.ProcessAuthentication(LazyAsyncResult result)
    at System.Net.TlsStream.Write(Byte[] buffer, Int32 offset, Int32 size)
    at System.Net.PooledStream.Write(Byte[] buffer, Int32 offset, Int32 size)
    at System.Net.ConnectStream.WritHeaders (Boolean async)
    --- End of inner exception stack trace ---
    at System.Net.HttpWebRequest.GetResponse()
    at OktaWidget.JwtService.GetStateTokenUsingJwt(String username)
    at OktaWidget.OktaWidgetForm..ctor(String username, Int64 parent, Int64 widgetFlow)
    at OktaWidget.OktaWidgetClass.displayWidget(Int64 parent, String username, Int64 flow)
</span>
                                                    <p>Solution:
</p>
                                                    <p>The likely case is that TLS is not correctly enabled. Okta requires TLS 1.2 or later.</p>
                                                    <p>To correct the issue:</p>
                                                    <ol>
                                                        <li value="1">If proxy is in use and TLS is terminated at the proxy disable SslPinningEnabled. See <a href="proc-mfa-win-creds-rdp-install.htm#Modify">Modify additional properties</a> in <a href="proc-mfa-win-creds-rdp-install.htm" class="MCXref xref" xrefformat="{para}">Install the Okta Credential Provider for Windows</a>.</li>
                                                        <li value="2">Enable TLS 1.2 in the registry. Open a PowerShell terminal as administrator and execute the following script:

                    <div><div class="codeSnippet"><a class="codeSnippetCopyButton" role="button" href="javascript:void(0);">Copy</a><div style="mc-code-lang: PowerShell;" class="codeSnippetBody" data-mc-continue="False" data-mc-line-number-start="1" data-mc-use-line-numbers="True"><pre><span class="codeSnippetLineNumbers" style="border-right: #AAA 2px solid;" aria-hidden="true">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
</span><code><span style="font-weight: bold; ">$is64bit</span> = [IntPtr]::Size * <span style="color: #333333; ">8</span> <span style="color: #795da3; ">-eq</span> <span style="color: #333333; ">64</span><br /><span style="color: #a71d5d; font-weight: bold; ">Write-Host</span> <span style="color: #df5000; ">"Is 64-bit script: $is64bit"</span><br /><span style="color: #969896; ">#helper function to check for if 0x800 bit is set</span><br /><span style="color: #a71d5d; font-weight: bold; ">function</span> checkTls12Bit([Int] <span style="font-weight: bold; ">$regValue</span>) {<br />    <span style="color: #a71d5d; ">return</span> (<span style="font-weight: bold; ">$regValue</span> <span style="color: #795da3; ">-band</span> <span style="color: #333333; ">0x800</span>) <span style="color: #795da3; ">-ne</span> <span style="color: #333333; ">0x800</span><br />}<br /><br /><span style="color: #a71d5d; font-weight: bold; ">function</span> setRegKeyToBitValue([string] <span style="font-weight: bold; ">$regBranch</span>, [string] <span style="font-weight: bold; ">$regKey</span>) {<br />    <span style="font-weight: bold; ">$current</span> = <span style="color: #a71d5d; font-weight: bold; ">Get-ItemProperty</span> -Path <span style="font-weight: bold; ">$regBranch</span> -ErrorAction SilentlyContinue<br />    <span style="color: #a71d5d; font-weight: bold; ">if</span> (<span style="font-weight: bold; ">$current</span> <span style="color: #795da3; ">-eq</span> <span style="font-weight: bold; ">$null</span>) {<br />        <span style="color: #a71d5d; font-weight: bold; ">Write-Host</span> <span style="color: #df5000; ">"$regBranch\$regKey does not exist. No change."</span> <br />        <span style="color: #a71d5d; ">return</span> <span style="font-weight: bold; ">$false</span><br />    }<br />    <span style="font-weight: bold; ">$regValue</span> = <span style="font-weight: bold; ">$current</span>.<span style="font-weight: bold; ">$regKey</span><br />    <span style="color: #a71d5d; font-weight: bold; ">if</span> (<span style="font-weight: bold; ">$regValue</span> <span style="color: #795da3; ">-eq</span> <span style="font-weight: bold; ">$null</span> <span style="color: #795da3; ">-or</span> (checkTls12Bit <span style="font-weight: bold; ">$regValue</span>) ) {<br />        <span style="color: #a71d5d; font-weight: bold; ">if</span> (<span style="font-weight: bold; ">$regValue</span> <span style="color: #795da3; ">-eq</span> <span style="font-weight: bold; ">$null</span>) {<br />            <span style="font-weight: bold; ">$regValue</span> = <span style="color: #333333; ">0x800</span><br />         } <span style="color: #a71d5d; font-weight: bold; ">else</span>    {<br />             <span style="font-weight: bold; ">$regValue</span> = <span style="font-weight: bold; ">$regValue</span> <span style="color: #795da3; ">-bor</span> <span style="color: #333333; ">0x800</span><br />          }<br /><br />         <span style="font-weight: bold; ">$p</span> = <span style="color: #a71d5d; font-weight: bold; ">New-ItemProperty</span> <span style="font-weight: bold; ">$regBranch</span> -Name <span style="font-weight: bold; ">$regKey</span> -PropertyType DWord -Value <span style="font-weight: bold; ">$regValue</span> -ErrorAction Stop -Force<br />         <span style="color: #a71d5d; font-weight: bold; ">Write-Host</span> <span style="color: #df5000; ">"Updated $regBranch\$regKey value to $regValue"</span> <br />         <span style="color: #a71d5d; ">return</span> <span style="font-weight: bold; ">$true</span><br />     }<br />    <span style="color: #a71d5d; font-weight: bold; ">Write-Host</span> <span style="color: #df5000; ">"$regBranch\$regKey value is $regValue. No change."</span><br />    <span style="color: #a71d5d; ">return</span> <span style="font-weight: bold; ">$false</span><br />}<br /><br /><span style="color: #a71d5d; font-weight: bold; ">function</span> setRegKeyToValueOfOne([string] <span style="font-weight: bold; ">$regBranch</span>, [string] <span style="font-weight: bold; ">$regKey</span>) {<br />    <span style="font-weight: bold; ">$current</span> = <span style="color: #a71d5d; font-weight: bold; ">Get-ItemProperty</span> -Path <span style="font-weight: bold; ">$regBranch</span> -ErrorAction SilentlyContinue<br />    <span style="color: #a71d5d; font-weight: bold; ">if</span> (<span style="font-weight: bold; ">$current</span> <span style="color: #795da3; ">-eq</span> <span style="font-weight: bold; ">$null</span>) {<br />        <span style="color: #a71d5d; font-weight: bold; ">Write-Host</span> <span style="color: #df5000; ">"$regBranch\$regKey does not exist. No change."</span> <br />        <span style="color: #a71d5d; ">return</span> <span style="font-weight: bold; ">$false</span><br />    }<br />    <span style="color: #a71d5d; font-weight: bold; ">if</span> (<span style="font-weight: bold; ">$current</span>.<span style="font-weight: bold; ">$regKey</span> <span style="color: #795da3; ">-ne</span> <span style="color: #333333; ">1</span>) {<br />        <span style="font-weight: bold; ">$p</span> = <span style="color: #a71d5d; font-weight: bold; ">New-ItemProperty</span> <span style="font-weight: bold; ">$regBranch</span> -Name <span style="font-weight: bold; ">$regKey</span> -PropertyType DWord -Value <span style="color: #333333; ">1</span> -ErrorAction Stop -Force<br />        <span style="color: #a71d5d; font-weight: bold; ">Write-Host</span> <span style="color: #df5000; ">"Updated $regBranch\$regKey value to 1"</span><br />        <span style="color: #a71d5d; ">return</span> <span style="font-weight: bold; ">$true</span><br />     }<br />    <span style="color: #a71d5d; font-weight: bold; ">Write-Host</span> <span style="color: #df5000; ">"$regBranch\$regKey value is 1. No change."</span><br />    <span style="color: #a71d5d; ">return</span> <span style="font-weight: bold; ">$false</span><br />}<br /><br /><span style="color: #969896; ">#setup .net tls settings</span><br /><span style="color: #a71d5d; font-weight: bold; ">function</span> setupTls4NET([boolean]<span style="font-weight: bold; ">$is64bit</span>, [string]<span style="font-weight: bold; ">$regBranch</span>, [string]<span style="font-weight: bold; ">$reg32bitBranch</span>) {<br /><span style="color: #969896; "># https://docs.microsoft.com/en-us/dotnet/framework/network-programming/tls</span><br />    <span style="font-weight: bold; ">$updated</span> = setRegKeyToValueOfOne <span style="font-weight: bold; ">$regBranch</span> <span style="color: #df5000; ">"SchUseStrongCrypto"</span><br />    <span style="font-weight: bold; ">$updated</span> = (setRegKeyToValueOfOne <span style="font-weight: bold; ">$regBranch</span> <span style="color: #df5000; ">"SystemDefaultTlsVersions"</span>) <span style="color: #795da3; ">-or</span> <span style="font-weight: bold; ">$updated</span><br /><br />    <span style="color: #a71d5d; font-weight: bold; ">if</span> (<span style="font-weight: bold; ">$is64bit</span>) {<br />        <span style="font-weight: bold; ">$updated</span> = (setRegKeyToValueOfOne <span style="font-weight: bold; ">$reg32bitBranch</span> <span style="color: #df5000; ">"SchUseStrongCrypto"</span>) <span style="color: #795da3; ">-or</span> <span style="font-weight: bold; ">$updated</span><br />        <span style="font-weight: bold; ">$updated</span> = (setRegKeyToValueOfOne <span style="font-weight: bold; ">$reg32bitBranch</span> <span style="color: #df5000; ">"SystemDefaultTlsVersions"</span>) <span style="color: #795da3; ">-or</span> <span style="font-weight: bold; ">$updated</span><br />    }<br /><br />    <span style="color: #a71d5d; ">return</span> <span style="font-weight: bold; ">$updated</span><br />}                            <br /><span style="color: #969896; "># https://docs.microsoft.com/en-us/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed</span><br /><br /><span style="font-weight: bold; ">$version</span> = <span style="color: #a71d5d; font-weight: bold; ">Get-ItemProperty</span> -Path <span style="color: #df5000; ">"HKLM:\Software\Microsoft\NET Framework Setup\NDP\v4\Full"</span> -Name Release<br /><span style="color: #969896; "># 394254 - .NET Framework 4.6.1, which is the current target of the installer</span><br /><span style="color: #a71d5d; font-weight: bold; ">if</span> (<span style="font-weight: bold; ">$version</span>.Release <span style="color: #795da3; ">-ge</span> <span style="color: #333333; ">394254</span>)  {<br />    <span style="font-weight: bold; ">$ev</span> = [environment]::Version<br />    <span style="font-weight: bold; ">$v</span> = <span style="color: #df5000; ">"v"</span> + <span style="font-weight: bold; ">$ev</span>.Major + <span style="color: #df5000; ">"."</span> + <span style="font-weight: bold; ">$ev</span>.Minor + <span style="color: #df5000; ">"."</span> + <span style="font-weight: bold; ">$ev</span>.Build<br />    <span style="font-weight: bold; ">$updated</span> = setupTls4NET <span style="font-weight: bold; ">$is64bit</span> <span style="color: #df5000; ">"HKLM:\SOFTWARE\Microsoft\.NETFramework\$v"</span> <span style="color: #df5000; ">"HKLM:\SOFTWARE\Wow6432Node\Microsoft\.NETFramework\$v"</span><br /><span style="color: #969896; "># https://support.microsoft.com/en-ca/help/3140245/update-to-enable-tls-1-1-and-tls-1-2-as-a-default-secure-protocols-in</span><br /><br />    <span style="font-weight: bold; ">$updated</span> = (setRegKeyToBitValue <span style="color: #df5000; ">"HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings\WinHttp"</span> <span style="color: #df5000; ">"DefaultSecureProtocols"</span>) <span style="color: #795da3; ">-or</span> <span style="font-weight: bold; ">$updated</span><br />    <span style="font-weight: bold; ">$updated</span> = (setRegKeyToBitValue <span style="color: #df5000; ">"HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings"</span> <span style="color: #df5000; ">"SecureProtocols"</span>) <span style="color: #795da3; ">-or</span> <span style="font-weight: bold; ">$updated</span><br /><br />    <span style="color: #969896; "># updated the 32-bit branches if we are on 64-bit machine</span><br />    <span style="color: #a71d5d; font-weight: bold; ">if</span> (<span style="font-weight: bold; ">$is64bit</span>) {<br />        <span style="font-weight: bold; ">$updated</span> = (setRegKeyToBitValue <span style="color: #df5000; ">"HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Internet Settings\WinHttp"</span> <span style="color: #df5000; ">"DefaultSecureProtocols"</span>) <span style="color: #795da3; ">-or</span> <span style="font-weight: bold; ">$updated</span><br />        <span style="font-weight: bold; ">$updated</span> = (setRegKeyToBitValue <span style="color: #df5000; ">"HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Internet Settings"</span> <span style="color: #df5000; ">"SecureProtocols"</span>) <span style="color: #795da3; ">-or</span> <span style="font-weight: bold; ">$updated</span><br />    }<br /><br />    <span style="color: #969896; "># current user settings</span><br />    <span style="font-weight: bold; ">$updated</span> = (setRegKeyToBitValue <span style="color: #df5000; ">"HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings"</span> <span style="color: #df5000; ">"SecureProtocols"</span>) <span style="color: #795da3; ">-or</span> <span style="font-weight: bold; ">$updated</span><br /><br />    <span style="color: #969896; "># local system account</span><br />    <span style="font-weight: bold; ">$userSid</span> = <span style="color: #df5000; ">".DEFAULT"</span><br />    <span style="font-weight: bold; ">$updated</span> = (setRegKeyToBitValue <span style="color: #df5000; ">"Registry::HKEY_USERS\$userSid\Software\Microsoft\Windows\CurrentVersion\Internet Settings"</span> <span style="color: #df5000; ">"SecureProtocols"</span>) <span style="color: #795da3; ">-or</span> <span style="font-weight: bold; ">$updated</span><br /><br />    <span style="color: #a71d5d; font-weight: bold; ">if</span> (<span style="font-weight: bold; ">$updated</span>) {<br />        <span style="color: #a71d5d; font-weight: bold; ">Write-Host</span> <span style="color: #df5000; ">"Done. Updated required settings."</span><br />    }<br />    <span style="color: #a71d5d; font-weight: bold; ">else</span><br />    {<br />        <span style="color: #a71d5d; font-weight: bold; ">Write-Host</span> <span style="color: #df5000; ">"Done. No updates are required."</span><br />    }<br />}<br /><span style="color: #a71d5d; font-weight: bold; ">else</span> <br />{<br />    <span style="color: #a71d5d; font-weight: bold; ">Write-Host</span> <span style="color: #df5000; ">"No changes were made. Your version of .NET Framework is earlier version than 4.6.1, please upgrade."</span><br />}        </code></pre></div></div></div></li>
                                                    </ol>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- div class="toolbar-main">
            <MadCap:topicToolbarProxy data-mc-skin="/Project/Skins/okta-toolbar-no-expand.flskn" style="mc-topic-toolbar-items: ;" />
                </div -->
                                    <!-- *********************** Footer rows ********************************* -->
                                    <div class="footer2" data-test="footer">
                                        <div>
                                            <p class="copyright" data-test="copyrightNotice">  <span class="mc-variable okta-variables.Year variable">2023</span> <span class="mc-variable okta-variables.CompanyName variable">Okta, Inc</span>. All Rights Reserved. Various trademarks held by their respective owners.
	</p>
                                        </div>
                                    </div>
                                    <!-- ********************** Scripts ************************************* -->
                                    <script src="../../Resources/Scripts/js/ignore-dompurify.js">
                                    </script>
                                    <script src="../../Resources/Scripts/js/app.js">
                                    </script>
                                    <script src="../../Resources/Scripts/js/vendor/what-input.js">
                                    </script>
                                    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.4.4-rc1/js/foundation.min.js">
                                    </script>
                                    <!-- Coveo -->
                                    <script src="https://static.cloud.coveo.com/searchui/v2.5395/js/CoveoJsSearch.Lazy.min.js" defer="defer">
                                    </script>
                                    <script src="../../Resources/Scripts/coveo-resources/js/cultures/en.js" id="coveoCultureScript" defer="defer">
                                    </script>
                                    <script src="../../Resources/Scripts/coveo-resources/js/Coveo.MadcapFlare.RequireJS.js" id="coveoRequireScript" defer="defer">
                                    </script>
                                    <script src="../../Resources/Scripts/coveo-resources/js/Coveo.MadcapFlare.Okta.js" id="coveoInitscript" defer="defer">
                                    </script>
                                    <!-- Feedback tab for Qualtrics survey -->
                                    <div id="feedback-tab" data-mc-conditions="Primary.live-site-only"><a id="feedback-link" href="#" onclick="openSurvey();  return false" target="_blank" title="Submit feedback"><div id="feedback-container"><p id="feedback-text" translate="no">Feedback</p></div></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>
