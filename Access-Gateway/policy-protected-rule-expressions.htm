<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:onlyLocalStylesheets="False" MadCap:searchable="True" MadCap:fileTags="Tags/okta-authors.Patrick Calnan">
    <head>
        <link rel="canonical" href="https://help.okta.com/oag/en-us/Content/Topics/Access-Gateway/policy-protected-rule-expressions.htm" />
        <link href="../../Resources/TableStyles/standard-shaded-rows.css" rel="stylesheet" MadCap:stylesheetType="table" /><title>[%=Heading.Level1%] | Okta</title>
        <link href="" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <h1>Protected rule resource matching rule expressions</h1>
        <p>Protected Policy rules require a resource matching rule to determine if an end user matches a rule. Resource matching rules are based on regular expressions.</p>
        <p><MadCap:variable name="okta-feature-names.Access Gateway" /> provides a set of menu items with common baseline expressions that can be selected and modified to meet a specific need.</p>
        <h2>Modify a protected rule based on a provided expression</h2>
        <ol>
            <li>Go to the <MadCap:variable name="okta-feature-names.Access&#160;Gateway UI" />.</li>
            <li>
                <p>Select the <span class="wintitle">Applications</span> tab.</p>
            </li>
            <li>
                <p>Select an application that contains an existing or needs a new protected rule and click <span class="uicontrol">Edit</span>.</p>
            </li>
            <li>
                Select the <span class="wintitle">Policies</span> section.</li>
            <li>Select an existing protected rule and click <span class="uicontrol">Edit</span>. Alternatively, create a new protected rule. For details of adding a new protected rule, see <MadCap:xref href="managing-oag-policy.htm">Managing Application Policy</MadCap:xref>.</li>
            <li>Click the policy menu and select one of the <MadCap:xref href="#item2">Predefined policies</MadCap:xref>, then click <span class="uicontrol">Use this</span>. 
			<p><img src="../../Resources/Images/access-gateway/policy-protected-rule-expressions-01.png" class="thumbnail" /></p></li>
            <li>Modify the policy as required.</li>
        </ol>
        <h3><a name="item2"></a>Predefined policies</h3>
        <p>The following predefined policies are provided:</p>
        <table style="mc-table-style: url('../../Resources/TableStyles/standard-shaded-rows.css');" class="TableStyle-srb_header_alt_shade" cellspacing="0">
            <col class="TableStyle-srb_header_alt_shade-Column-Column1" />
            <col class="TableStyle-srb_header_alt_shade-Column-Column1" />
            <thead>
                <tr class="TableStyle-srb_header_alt_shade-Head-Header1">
                    <th class="TableStyle-srb_header_alt_shade-HeadF-Column1-Header1">Policy</th>
                    <th class="TableStyle-srb_header_alt_shade-HeadD-Column1-Header1">Description</th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-srb_header_alt_shade-Body-Body1">
                    <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1">Allow Group</td>
                    <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body1">Allows access to the given resource if the end user is a member of the single specified group.<p>Example: <span class="code">Groups=((?=(|.:)Everyone(R|:.*)))</span></p></td>
                </tr>
                <tr class="TableStyle-srb_header_alt_shade-Body-Body2">
                    <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2">Deny Group</td>
                    <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body2">Denies access to the given resource if the end user is a member of the single specified group. <p>Example: <span class="code">Groups=((?!(|.*:)Everyone(\R|:.*)))</span></p></td>
                </tr>
                <tr class="TableStyle-srb_header_alt_shade-Body-Body1">
                    <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1">Allow RemoteIP</td>
                    <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body1">Allows access to the given resource if the end users IP matches the provided regular expression. <p>Example: <span class="code">RemoteIP=(?=192\..*)</span></p></td>
                </tr>
                <tr class="TableStyle-srb_header_alt_shade-Body-Body2">
                    <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2">Deny RemoteIP</td>
                    <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body2">Denies access to the given resource if the end users IP matches the provided regular expression. <p>Example:&#160;<span class="code">RemoteIP=(?!192\..*)</span></p></td>
                </tr>
                <tr class="TableStyle-srb_header_alt_shade-Body-Body1">
                    <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1">Allow OR Groups</td>
                    <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body1">Allow access to resource if user has group membership to one OR another group.<p>Example: <span class="code">Groups=((?=(|.*:)Everyone(\R|:.*)))|((?=(|.*:)Group2(\R|:.*)))</span></p></td>
                </tr>
                <tr class="TableStyle-srb_header_alt_shade-Body-Body2">
                    <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2">Allow AND&#160;Groups</td>
                    <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body2">Allow access to resource if user has group membership to one AND another group.<p>Example: <span class="code">Groups=((?=(|.*:)Everyone(\R|:.*)))((?=(|.*:)Group2(\R|:.*)))</span></p></td>
                </tr>
                <tr class="TableStyle-srb_header_alt_shade-Body-Body1">
                    <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1">Allow User</td>
                    <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body1">Allow access to resource if UserName matches.<p>Example: <span class="code">UserName=user@example.com</span></p></td>
                </tr>
                <tr class="TableStyle-srb_header_alt_shade-Body-Body2">
                    <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2">Deny User</td>
                    <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body2">
                        <p>Deny access to resource if UserName matches.</p>
                        <p>Example: UserName=(?!test@example.com)</p>
                    </td>
                </tr>
                <tr class="TableStyle-srb_header_alt_shade-Body-Body1">
                    <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1">Allow Group AND User</td>
                    <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body1">Allow access to resource if user has group membership AND UserName matches.<p>Example: <span class="code">(?=.*Groups=(?=(|.:)Everyone(R|:.*)))(?=.*UserName=user1@domain.tld)</span></p></td>
                </tr>
                <tr class="TableStyle-srb_header_alt_shade-Body-Body2">
                    <td class="TableStyle-srb_header_alt_shade-BodyC-Column1-Body2">Allow Group AND Deny User</td>
                    <td class="TableStyle-srb_header_alt_shade-BodyA-Column1-Body2">Allow access to resource if user has group membership AND UserName doesn't match.<p>Example: <span class="code">(?=.*Groups=(?=(|.:)Everyone(R|:.*)))(?=.*UserName=(?!user3@domain.tld))</span></p></td>
                </tr>
            </tbody>
        </table>
        <p>After being selected, the expression can be modified to meet a specific need.</p>
        <h3><a name="RMRFields"></a>Resource Matching Rule fields</h3>
        <p>Resource matching rules are regular expressions based on application attributes. Predefined polices use attributes such as Groups, UserName and RemoteIP. Any application attribute can be used in a resource matching rule. Common attribute mappings include:</p>
        <table style="width: 275px;mc-table-style: url('../../Resources/TableStyles/standard-shaded-rows.css');" class="TableStyle-srb_header_alt_shade" cellspacing="0">
            <col class="TableStyle-srb_header_alt_shade-Column-Column1" />
            <col class="TableStyle-srb_header_alt_shade-Column-Column1" />
            <col class="TableStyle-srb_header_alt_shade-Column-Column1" />
            <thead>
                <tr class="TableStyle-srb_header_alt_shade-Head-Header1">
                    <th class="TableStyle-srb_header_alt_shade-HeadF-Column1-Header1">Data Source</th>
                    <th class="TableStyle-srb_header_alt_shade-HeadF-Column1-Header1">Field</th>
                    <th class="TableStyle-srb_header_alt_shade-HeadD-Column1-Header1">Name</th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-srb_header_alt_shade-Body-Body1">
                    <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1">IDP</td>
                    <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1">Groups</td>
                    <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body1">Groups</td>
                </tr>
                <tr class="TableStyle-srb_header_alt_shade-Body-Body2">
                    <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2">IDP</td>
                    <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2">email</td>
                    <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body2">UserName</td>
                </tr>
                <tr class="TableStyle-srb_header_alt_shade-Body-Body1">
                    <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1">IDP</td>
                    <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1">login</td>
                    <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body1">login</td>
                </tr>
                <tr class="TableStyle-srb_header_alt_shade-Body-Body2">
                    <td class="TableStyle-srb_header_alt_shade-BodyC-Column1-Body2" colspan="2">Provided and not required to be defined as attributes. </td>
                    <td class="TableStyle-srb_header_alt_shade-BodyA-Column1-Body2">RemoteIP<p>USER_AGENT</p></td>
                </tr>
            </tbody>
        </table>
        <div class="noteOkta">
            <p class="noteContent">Attributes used exclusively in resource matching rules should be <span class="uicontrol">Send Attribute</span> disabled.</p>
            <p>
                <img src="../../Resources/Images/access-gateway/policy-protected-rule-expressions-dont-send.png" id="img_new" />
            </p>
        </div>
        <h2><span>Related topics</span>
        </h2>
        <p>
            <MadCap:xref href="example-policy.htm">Example [%=okta-feature-names.Access Gateway%] policy</MadCap:xref>
        </p>
        <p>
            <MadCap:xref href="managing-oag-policy.htm">Managing Application Policy</MadCap:xref>
        </p>
    </body>
</html>