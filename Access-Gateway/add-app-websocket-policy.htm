<?xml version="1.0" encoding="utf-8"?>
<html MadCap:onlyLocalStylesheets="False" MadCap:searchable="True" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:fileTags="Tags/okta-authors.Patrick Calnan">
    <head>
        <link rel="canonical" href="https://help.okta.com/oag/en-us/Content/Topics/Access-Gateway/add-app-websocket-policy.htm" />
        <link href="../../Resources/TableStyles/standard-shaded-rows.css" rel="stylesheet" MadCap:stylesheetType="table" /><title>[%=Heading.Level1%] | Okta</title>
        <link href="" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <h1>Add required access policy</h1>
        <div>
            <p>Create a  policy that's required to turn a connection into a WebSocket.<br /></p>
            <p>Add access policy for each web socket URI:</p>
            <ol>
                <li>For the web socket application navigate to the <span class="uicontrol">Policies</span> tab.</li>
                <li>Click <span class="uicontrol">Add</span> (<img src="../../Resources/Images/access-gateway/icon.plus.png" style="vertical-align: bottom;" />) in the policy list header and choose <span class="uicontrol">Protected</span>. See <MadCap:xref href="learn-about-oag-policy-types.htm">Learn About [%=okta-feature-names.Access Gateway%] Policy Types</MadCap:xref>.</li>
                <li>Enter the following:<br /><table style="mc-table-style: url('../../Resources/TableStyles/standard-shaded-rows.css');" class="TableStyle-srb_header_alt_shade" cellspacing="0"><col class="TableStyle-srb_header_alt_shade-Column-Column1" /><col class="TableStyle-srb_header_alt_shade-Column-Column1" /><thead><tr class="TableStyle-srb_header_alt_shade-Head-Header1"><th class="TableStyle-srb_header_alt_shade-HeadF-Column1-Header1">Field</th><th class="TableStyle-srb_header_alt_shade-HeadD-Column1-Header1">Value</th></tr></thead><tbody><tr class="TableStyle-srb_header_alt_shade-Body-Body1"><td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1">Name</td><td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body1">An appropriate name for the policy such as <span class="uicontrol">WebSocket URI</span>.</td></tr><tr class="TableStyle-srb_header_alt_shade-Body-Body2"><td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2">Policy Type</td><td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body2"><span class="uicontrol">Protected</span></td></tr><tr class="TableStyle-srb_header_alt_shade-Body-Body1"><td class="TableStyle-srb_header_alt_shade-BodyC-Column1-Body1">Resource Path</td><td class="TableStyle-srb_header_alt_shade-BodyA-Column1-Body1">URL to the web socket (for example <span class="code">/path/to/ws1</span>).</td></tr></tbody></table></li>
                <li>Expand <span class="wintitle">Advanced</span>. </li>
                <li>In the <span class="uicontrol">Custom Configuration</span> text area enter the following code:
<span class="codeblock">proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection "upgrade";
</span></li>
                <li>Click <span class="uicontrol">Not validated</span> to validate the code block. After being successfully validated, the label changes to <span class="uicontrol">Valid</span>.</li>
                <li>Correct any errors. Click <span class="uicontrol">Okay</span> to finalize the policy. </li>
                <li>Repeat for each web socket URI</li>
                <li>Click <span class="uicontrol">Done</span> to complete the application.</li>
            </ol>
            <h2>Related topics</h2>
            <p>See <a href="http://nginx.org/en/docs/http/websocket.html" target="_blank">WebSocket proxying</a> for more information on NGINX support for WebSockets.</p>
            <div>
                <h2>Next steps</h2>
                <p>
                    <MadCap:xref href="add-app-websocket-test.htm">Test web socket based applications</MadCap:xref>
                </p>
            </div>
        </div>
    </body>
</html>