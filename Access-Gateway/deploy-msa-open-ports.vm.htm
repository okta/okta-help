<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:fileTags="Tags/okta-authors.Patrick Calnan">
    <head>
        <link rel="canonical" href="https://help.okta.com/oag/en-us/Content/Topics/Access-Gateway/deploy-msa-open-ports.vm.htm" /><title>[%=Heading.Level1%] | Okta</title>
        <link href="" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <div>
            <h1>Configure networking</h1>
            <div>
                <p>Create a Microsoft Azure virtual machine, a security group, and inbound security rules, then associate the security rules with the virtual machine.</p>
            </div>
            <ul class="tabs" data-tabs="data-tabs" data-deep-link="true" id="production-tabs">
                <li class="tabs-title is-active"><a href="#console-panel" aria-selected="true">Console</a>
                </li>
                <li class="tabs-title"><a href="#command-panel">Command Line</a>
                </li>
            </ul>
            <div class="tabs-content" data-tabs-content="production-tabs">
                <div class="tabs-panel is-active" id="console-panel">
                    <h3>Create a security group</h3>
                    <ol>
                        <li>Sign in to the Microsoft Azure Portal.</li>
                        <li>From the menu, select <span class="uicontrol">All Services</span> and search for <span class="uicontrol">Resource Groups</span>. Alternatively, select <span class="uicontrol">Resource Groups</span> from the favorites list.</li>
                        <li>Click the name of the resource group where you want to add the network security rule set.</li>
                        <li>Click <span class="uicontrol">Add</span>.</li>
                        <li>Search and select <span class="uicontrol">Network security group</span>.</li>
                        <li>Select <span class="uicontrol">Create</span>.</li>
                        <li>Name the security group. </li>
                        <li>Click <span class="uicontrol">Create and Review</span>. </li>
                        <li>Click <span class="uicontrol">Create</span>. </li>
                    </ol>
                    <h3>Create inbound security rules</h3>
                    <ol>
                        <li>In <span class="wintitle">Settings</span>, click <span class="uicontrol">Inbound security rules</span>.</li>
                        <li>Click <span class="uicontrol">Add</span>. </li>
                        <li>Enter the following values:
							<ul><li><span class="uicontrol">Destination port range</span>: <span class="userinput">80/443</span></li><li><span class="uicontrol">Protocol</span>: <span class="userinput">TCP</span></li><li><span class="uicontrol">Name</span>: <span class="userinput">Port80/Port443 Rule</span></li><li><span class="uicontrol">Priority</span>: <span class="userinput">100/101</span></li></ul><div class="noteOkta"><p class="noteContent">Port 80 is optional. </p></div></li>
                        <li>Click <span class="uicontrol">Add</span>. </li>
                        <li>Repeat these steps to create rules for ports 80 and 443.</li>
                    </ol>
                    <h3>Associate security rules </h3>
                    <ol>
                        <li>Go to <span class="uicontrol">HOME &gt;&#160;VM</span>.</li>
                        <li>Click the name of <MadCap:variable name="okta-feature-names.Access Gateway" /> virtual machine.</li>
                        <li>In <span class="uicontrol">Settings</span>, select <span class="uicontrol">Subnets</span>.</li>
                        <li>Click <span class="uicontrol">Associate</span>.</li>
                        <li>Search for the security group that you created earlier and associate it with the virtual machine.</li>
                    </ol>
                </div>
                <div class="tabs-panel" id="command-panel">
                    <ol>
                        <li>Create a network security using the <span class="code">az network nsg create</span> command:
							<p><span class="code">az network nsg create --resource-group AccessGateway --location &lt;location&gt; --name &lt;name&gt;</span></p><ul><li><span class="code">&lt;location&gt;</span> is the region to house the security group.</li><li><span class="code">&lt;resource-group&gt;</span> is the name of the resource group that you created earlier.</li><li><span class="code">&lt;name&gt;</span> is the name of the new security group.</li></ul><p>Here is an example of the <span class="code">az network nsg create</span> command with the parameters populated with values:</p><p><span class="code">az network nsg create --resource-group AccessGateway --location eastus --name AGSecurityGroup </span></p><p>When you run the <span class="code">az network nsg create</span> command, the following results appear:</p><p><span class="codeblock">{ "NewNSG": {
   "defaultSecurityRules": [
   {
  "destinationAddressPrefixes": [],
  "destinationApplicationSecurityGroups": null,
   . . . ]}
}	</span></p></li>
                        <li>Add a network security rule for port 80 using the <span class="code">az network nsg rule create </span> command. Port 80 is optional:<p><span class="code">az network nsg rule create \
--resource-group &lt;resource-group&gt;\
--nsg-name &lt;network-security-group&gt;\
--name &lt;rule-name&gt;\
--protocol tcp \
--priority 1000 \
--destination-port-range 80</span></p><ul><li><span class="code">&lt;resource-group&gt;</span> is the name of the previously created resource group.</li><li><span class="code">&lt;nework-security-group&gt;</span> is the name of the new security group.</li><li><span class="code">&lt;rule-name&gt;</span> is a name for the rule.</li></ul><p>Here is an example of the <span class="code">az network nsg rule create </span> command with the parameters populated with values:</p><p><span class="code">az network nsg rule create --resource-group AccessGateway  --nsg-name AGSecurityGroup    \
    --name Port80GroupRule --protocol tcp --priority 1000 --destination-port-range 80</span><p>When you run the <span class="code">az network nsg rule create </span> command, the following results appear:</p></p><p><span class="codeblock">{- Finished 
    "access": "Allow",
&#160;   "description": null,
&#160;   "destinationAddressPrefix": "*",
    . . . 
}	</span></p></li>
                        <li>Add a network security rule for port 443 using the <span class="code">az network nsg rule create </span> command:
								<p><span class="code">az network nsg rule create --resource-group AccessGateway --nsg-name AGSecurityGroup    \ 
    --name Port443GroupRule --protocol tcp --priority 1001 --destination-port-range 443</span></p><p>When you run the <span class="code">az network nsg rule create </span> command, the following results appear:</p><span class="codeblock">{- Finished 
    "access": "Allow",
    "description": null,
    "destinationAddressPrefix": "*",
    . . . 
}	</span></li>
                        <li>Associate the new security group with the VM nic using the <span class="code">az network nic update</span> command:
								<p><span class="code">az network nic update \
    --resource-group &lt;resource-group&gt;\
    --name &lt;nic-name&gt;\
    --network-security-group &lt;security-group-name&gt;</span></p><ul><li><span class="code">&lt;resource-group&gt;</span> is the name of the resource group created earlier.</li><li><span class="code">&lt;nic-name&gt;</span> is the name of nic to associate the security group with.</li><li><span class="code">&lt;nework-security-group&gt;</span> is the name of the new security group.</li></ul><p>Here's an example of the <span class="code">az network nic update</span> command with the parameters populated with values:</p><span class="codeblock"># obtain the name of the nic.
az vm nic list --resource-group AccessGateway --vm-name "OAG5.0vm"
[{
 "id": "/subscriptions/. . . /networkInterfaces/OAG5.0VMVMNic",
     . . .
}]

# Assign the security group to the nic
az network nic update \
    --resource-group AccessGateway\
    --name OAG5.0VMMVNic
    --network-security-group AGSecurityGroup </span><p>When you run the <span class="code">az network nic update</span> command, the following results appear:</p><span class="codeblock" xml:space="preserve">{{"dnsSettings": {
    "dnsSettings": {
    appliedDnsServers": [],
    . . .
}</span></li>
                    </ol>
                </div>
            </div>
        </div>
        <div>
            <h3>Related topics</h3>
            <p> <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/linux/nsg-quickstart">Network security groups quick start - CLI</a></p>
            <p> <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/nsg-quickstart-portal">Network security groups quick start - Portal</a></p>
        </div>
        <div>
            <h2>Next steps</h2>
            <p>
                <MadCap:xref href="#">Configure Networking</MadCap:xref>
            </p>
        </div>
    </body>
</html>