<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd"
      MadCap:conditions="MultiProdPublish.Classic+OIE"
      MadCap:fileTags="Tags/okta-authors.Patrick Calnan"
      description="Define how and when user data is imported when you install the Okta AD Agent or the needs of your business change.">
   <head>
      <title>[%=Heading.Level1%] | Okta</title>
   </head>
   <body>
      <h1>
         <a name="ADimportprov"/>Configure Active Directory  import and account settings</h1>
      <p>When you install the <MadCap:variable name="okta-feature-names.AD agent short"/> or the needs of your business change, you define how and when user data is imported. Defining the username format is a critical part of this process. The username is used to associate the user in Active Directory (AD) to <MadCap:variable name="okta-variables.ProductName"/>. It's important to choose the correct username format as this affects how your users sign in to <MadCap:variable name="okta-variables.ProductName"/>. </p>
      <p>By default <MadCap:variable name="okta-variables.ProductName"/> uses the <MadCap:variable name="okta-variables.ProductName"/> user profile username during delegated authentication. For example, if the AD app-user username is <span class="term">samAccountName</span> and the <MadCap:variable name="okta-variables.ProductName"/> user profile username (login field) is <span class="term">UPN</span>, then <MadCap:variable name="okta-variables.ProductName"/>  use <span class="term">UPN</span> to sign the user in. </p>
      <p>If your AD domain functional level is 2003, your AD usernames must have a UPN that includes a <span class="uicontrol">domain.name</span> format.      </p>
      <ol>
         <li>
                In the <MadCap:variable name="okta-feature-names.Administrator dashboard"/>, go to <span class="menucascade">
               <span class="uicontrol">Directory</span>
               <span class="uicontrol">Directory Integrations</span>
            </span>.</li>
         <li>Click <span class="uicontrol">Active Directory</span>  and then click the <span class="uicontrol">Provisioning</span> tab.</li>
         <li>Click <span class="uicontrol">Integration</span> in the <span class="uicontrol">Settings</span> list and in the <span class="uicontrol">Import Settings</span> area, complete these fields:
						<ul style="margin-left: 0;">
               <li>
                  <span class="uicontrol">User OUs connected to <MadCap:variable name="okta-variables.ProductName"/>
                  </span> —  Add or remove the Organizational Units (OUs) used to import users.</li>
               <MadCap:snippetBlock src="../../Resources/Snippets/ea-banner.flsnp"/>
               <li>
                  <span class="uicontrol">User Filter</span>— Create a syntax query to selectively import users matching the criteria that you specify. The default is <span class="code">sAMAccountType=805306368</span>.</li>
            </ul>
            <p style="text-align: left;margin-left: 40px;">Changing the default filter queries can result in deprovisioning users. To avoid unintended results, <MadCap:variable name="okta-variables.ProductName"/> strongly recommends that you test these filters in your directory environment to make sure that the results match your expectations.</p>
            <ul MadCap:continue="true" style="text-align: left;margin-left: 0;">
               <li>
                  <span class="uicontrol">Group OUs connected to <MadCap:variable name="okta-variables.ProductName"/>
                  </span>  —  Add or remove the OUs used to import groups.</li>
               <MadCap:snippetBlock src="../../Resources/Snippets/ea-banner.flsnp"/>
               <li>
                  <p>
                     <span class="uicontrol">Group Filter</span> —Create a syntax query to selectively import groups matching the criteria that you specify. The default is <span class="code">objectCategory=group</span>.</p>
                  <p> Changing the default filter queries can result in deprovisioning groups. To avoid unintended results, <MadCap:variable name="okta-variables.ProductName"/> strongly recommends that you test these filters in your directory environment to make sure that the results match your expectations. </p>
                  <p>Back-linked attributes, such as memberOf, are computed attributes and aren't stored in your AD database. As a result, changes to the user object are not visible to <MadCap:variable name="okta-variables.ProductName"/> and  an import operation isn't performed when  changes occur. <MadCap:variable name="okta-variables.ProductName"/> recommends that you avoid the use of computed attributes as mapped attributes, especially if you require changes in downstream systems as a result of attribute changes. The use of computed attributes as mapped attributes can lead to inconsistent data between your on-premises Active Directory instance and Universal Directory. For more information, see <a href="https://msdn.microsoft.com/en-us/library/cc223384.aspx">https://msdn.microsoft.com/en-us/library/cc223384.aspx.</a>
                  </p>
               </li>
            </ul>
         </li>
         <li>
            <MadCap:snippetBlock src="../../Resources/Snippets/task steps/Click_Save.flsnp"/>
         </li>
         <li>Optional. In the <span class="uicontrol">Delegated Authentication</span> section, select <span class="uicontrol">Enable delegated authentication to Active Directory</span> if you want AD to authenticate your users when they sign in to <MadCap:variable name="okta-variables.ProductName"/>. </li>
         <li>Click <span class="uicontrol">Save</span>.
</li>
         <li>Click <span class="uicontrol">To Okta</span> in the <span class="uicontrol">Settings</span> list, click <span class="uicontrol">Edit</span>, and in the <span class="uicontrol">General</span> area, complete these fields:</li>
         <ul style="margin-left: 0;">
            <li>
               <span class="uicontrol">Schedule Import</span>    —Select the frequency  to import users from AD to <MadCap:variable name="okta-variables.ProductName"/>.

            </li>
         </ul>
         <p style="margin-left: 40px;">Following a successful import, under specific conditions <MadCap:variable name="okta-variables.ProductName"/> automatically sends an email to designated administrators. The email details the number of users and groups scanned, added, updated, or removed during the import. <MadCap:variable name="okta-variables.ProductName"/> only sends the email if the scan detects any new users or groups, or changes to any existing user profile or group membership.</p>
         <ul>
            <li>
               <p>
                  <span class="uicontrol">
                     <MadCap:variable name="okta-variables.ProductName"/> username format</span>    —The username format you select must match the format you used when you first imported users. Changing the value can cause errors for existing users. Choose  one of the following options:

								</p>
               <ul>
                  <li>
                     <span class="uicontrol">User Principal Name (UPN)</span>     —Select this option to use the UPN from AD to create the <MadCap:variable name="okta-variables.ProductName"/> username.</li>
                  <li>
                     <span class="uicontrol">Email address</span>    —Select this option to use an email address for the <MadCap:variable name="okta-variables.ProductName"/> username.</li>
                  <li>
                     <span class="uicontrol">SAM Account name</span>    —Select this option to combine the <span class="uicontrol">SAM Account Name</span> and the AD domain to generate the <MadCap:variable name="okta-variables.ProductName"/> username. For example, if the SAM Account Name is <span class="uicontrol">jdoe</span> and the AD domain is <span class="uicontrol">mycompany.okta.com</span>, then the <MadCap:variable name="okta-variables.ProductName"/> username is <span class="uicontrol">jdoe@mycompany.okta.com</span>.</li>
                  <li>
                     <span class="uicontrol">Custom</span>    —Select this option to use a custom username to sign in to <MadCap:variable name="okta-variables.ProductName"/>. Enter the <MadCap:variable name="okta-variables.ProductName"/> Expression Language to define the <MadCap:variable name="okta-variables.ProductName"/> username format. To validate your mapping expression, enter a username and click <span class="uicontrol">View</span>.</li>
               </ul>
            </li>
         </ul>
         <div class="noteOkta">
            <p class="noteContent">Note: All <MadCap:variable name="okta-variables.ProductName"/> users can sign in by entering the alias part of their usernames as long as it maps to a single user in your org. For example, <span class="uicontrol">jdoe@mycompany.okta.com</span> could sign in using <span class="uicontrol">jdoe</span>.</p>
            </div>
         <ul>
            <li>
               <p style="margin-left: 0;">
                  <span class="uicontrol">JIT Provisioning</span> —Select <span class="uicontrol">Create and update users on login</span> to automatically create <MadCap:variable name="okta-variables.ProductName"/> user profiles  the first time a user authenticates with AD Delegated Authentication. When an AD sourced user profile exists in <MadCap:variable name="okta-variables.ProductName"/>, the existing user profile is updated when the user signs in, or when an admin views the profile.</p>
            </li>
         </ul>
         <p style="margin-left: 40px;">The security groups to which the user belongs are also imported if the group belongs to a selected OU. If a user signing in doesn't belong to a selected OU, the sign in fails. If you enable JIT, Delegated Authentication must also be enabled. This option can be used with or without scheduled imports. For details about JIT and AD domain scenarios, see <MadCap:xref href="Directory_FAQ_Okta_and_AD_Groups.htm">Active Directory integration FAQ</MadCap:xref>.</p>
         <div class="noteOkta" style="margin-left: 40px;">
            <p class="noteContent">There are membership inconsistencies that can occur between “regular” imports and JIT provisioning. These membership anomalies can occur when using nested groups. During regular imports, a child group that is outside the scope of an AD OU or LDAP object filter can't be detected. If a parent group is within an OU/object filter scope but its child groups aren't, the parent group membership is incorrectly resolved during import. JIT provisioning would correctly resolve these memberships to the parent group because its function only detects "flat" memberships.</p>
         </div>
         <p>
            <ul>
               <li>
                  <p MadCap:conditions="Primary.review-only">
                     <span class="uicontrol">Update users on sign-in</span>: Select <span class="uicontrol">Update user profiles from Active Directory on sign-in</span> to automatically update user profiles imported from AD when users sign in.</p>
               </li>
            </ul>
            <ul>
               <li MadCap:conditions="MultiProdPublish.Classic">
                  <p>
                     <span class="uicontrol">USG support</span>      —Select <span class="uicontrol">Universal Security Group Support</span> to ignore domain boundaries when importing group memberships for your  users. This assumes that the relevant domains are connected in <MadCap:variable name="okta-variables.ProductName"/>.
You must also deploy an AD agent for every domain in your forest that contains the USG object that you want to sync with <MadCap:variable name="okta-variables.ProductName"/>. Each connected domain then imports its groups. When a user's group memberships match any groups that were imported (from any connected domain in the forest), <MadCap:variable name="okta-variables.ProductName"/> syncs the memberships for the user to each group. Only groups from connected domains are imported. This setting can't be selected unless <span class="uicontrol">JIT provisioning</span> is selected first. </p>
               </li>
               <li MadCap:conditions="MultiProdPublish.OIE">
                  <p>
                     <span class="uicontrol">USG support</span>      —Select <span class="uicontrol">Universal Security Group Support</span> to ignore domain boundaries when importing group memberships for your  users. This assumes that the relevant domains are connected in <MadCap:variable name="okta-variables.ProductName"/>.
You must also deploy an AD agent for every domain in your forest that contains the USG object that you want to sync with <MadCap:variable name="okta-variables.ProductName"/>. Each connected domain then imports its groups. When a user's group memberships match any groups that were imported (from any connected domain in the forest), <MadCap:variable name="okta-variables.ProductName"/> syncs the memberships for the user to each group. Only groups from connected domains are imported. This setting can't be selected unless <span class="uicontrol">Update users on sign-in</span> is selected first. </p>
               </li>
            </ul>
            <ul>
               <li>
                  <p>
                     <span class="uicontrol">Do not import users</span>      —Select <span class="uicontrol">Skip users during import</span>  to keep user profiles and groups synchronized without importing new users from your directory. Use this option when you want to   use import functionality to synchronize groups, but want to create <MadCap:variable name="okta-variables.ProductName"/> users  using Just In Time (JIT) provisioning.</p>
               </li>
               <p>Groups are imported when <span class="uicontrol">Skip users during import</span> is selected,  but group memberships aren't updated until a user import is completed. </p>
               <p>When <span class="uicontrol">Skip users during import</span> is selected, all imports will run as a full import.</p>
            </ul>
            <ul>
               <li>
                  <p>
                     <span class="uicontrol">Activation emails</span>      — Select this option to prevent <MadCap:variable name="okta-variables.ProductName"/> from sending an activation email to new users. Admins can activate users.<p>Okta recommends that you select not to send activation emails while you're doing the initial AD integration and configuration in your Preview environment. This prevents end users from receiving activation emails before you're ready for them to begin enrolling in and using <MadCap:variable name="okta-variables.ProductName"/>.</p>
                  </p>
               </li>
            </ul>
         </p>
      </ol>
      <ol start="8">
         <li>
            <MadCap:snippetBlock src="../../Resources/Snippets/task steps/Click_Save.flsnp"/>
         </li>
         <li>
            <a name="Matching"/>In the <span class="uicontrol">User Creation &amp; Matching</span> section, click <span class="uicontrol">Edit</span> and select the conditions under which imported users will be identified as matching existing <MadCap:variable name="okta-variables.ProductName"/> users.<p>Matching rules are used in the import of users from all apps and directories that allow importing.  If there is an existing <MadCap:variable name="okta-variables.ProductName"/> account, AD allows you to import and confirm users automatically. AD, OPP, and all provisioning-enabled apps support automatic importation and confirmation of users into <MadCap:variable name="okta-variables.ProductName"/>. Establishing matching criteria (or rules) allows you to specify how an imported user should be mapped to an existing <MadCap:variable name="okta-variables.ProductName"/> user. Clearly defining rules for matching helps to prevent multiple instances for the same user from being created.</p>
            <p>Note: This feature does not apply to CSV-imported user lists.</p>
         </li>
         <ul>
            <li>
               <span class="uicontrol">Imported user is an exact match to an <MadCap:variable name="okta-variables.ProductName"/> user if</span>     — Choose  one of the following options:<ul>
                  <li>
                     <span class="uicontrol">
                        <MadCap:variable name="okta-variables.ProductName"/> username format matches</span>
                  </li>
                  <li>
                     <span class="uicontrol">Email matches</span>
                  </li>
                  <li>
                     <span class="uicontrol">The following required attributes match</span>         — Select from the list of options to establish your criteria. For the new imported user to be considered an exact match, each option that you select must be true.</li>
                  <li>
                     <span class="uicontrol">The following  attributes match</span>         — Select from the list of options to establish your criteria. For the new imported user to be considered an exact match, each option that you select must be true.</li>
               </ul>
            </li>
         </ul>
         <ul>
            <li>
               <span class="uicontrol">Allow partial matches</span>         —  Select this option to allow a match when the first and family name of an imported user match an existing <MadCap:variable name="okta-variables.ProductName"/> user, but the user's username or email address don't. </li>
            <li>
               <span class="uicontrol">Confirm matched users</span>         — Select <span class="uicontrol">Auto-confirm exact matches</span> or <span class="uicontrol">Auto-confirm partial matches</span> to  automatically confirm exact or partial matches. If you don't select an option, matches are confirmed manually after the matching status is established and users are activated on the <span class="uicontrol">People</span> page (<span class="menucascade">
                  <span class="uicontrol">Directory</span>
                  <span class="uicontrol">People</span>
               </span>).</li>
            <li>
               <span class="uicontrol">Confirm new users</span>         — Select <span class="uicontrol">Auto-confirm new users</span> or <span class="uicontrol">Auto-activate new users</span> to automatically confirm or activate new users   when the matching criteria is met. If you don't select an option, new users are confirmed or activated manually on the <span class="uicontrol">People</span> page (<span class="menucascade">
                  <span class="uicontrol">Directory</span>
                  <span class="uicontrol">People</span>
               </span>).</li>
         </ul>
      </ol>
      <ol MadCap:continue="true">
         <li>
            <MadCap:snippetBlock src="../../Resources/Snippets/task steps/Click_Save.flsnp"/>
         </li>
         <li>To define your <span class="uicontrol">Profile &amp; Lifecycle Sourcing</span> settings, click <span class="uicontrol">Edit</span> and complete the following settings:</li>
         <ul>
            <li>
               <span class="uicontrol">Allow Active Directory to source <MadCap:variable name="okta-variables.ProductName"/> users</span> — This option is enabled by default. Profile sourcing makes AD the identity authority for connected users. When enabled, user profiles aren't editable in <MadCap:variable name="okta-variables.ProductName"/> and changes are synced to <MadCap:variable name="okta-variables.ProductName"/> during provisioning events. You can disable this option to have AD treated as a normal application. If you disable this feature, user updates you perform in AD aren't  pushed back to the user profile in <MadCap:variable name="okta-variables.ProductName"/>. For example, if you change a user's name in AD, the change doesn't affect the <MadCap:variable name="okta-variables.ProductName"/> user. However, users can reset their AD passwords in Okta using self-service password reset as long as Delegated Authentication is enabled.</li>
            <li>
               <span class="uicontrol">When a user is deactivated in the app</span>  — Specify what action <MadCap:variable name="okta-variables.ProductName"/> should take if the user's account is deactivated in <MadCap:variable name="okta-variables.ProductName"/>.<ul>
                  <li>
                     <span class="uicontrol">Do nothing</span>   — No action is taken.</li>
                  <li>
                     <span class="uicontrol">Deactivate</span>   — Deactivates users' LDAP  account when they are unassigned in <MadCap:variable name="okta-variables.ProductName"/> or their <MadCap:variable name="okta-variables.ProductName"/> account is deactivated. Accounts can be reactivated if the app is reassigned to a user in <MadCap:variable name="okta-variables.ProductName"/>.</li>
                  <li>
                     <span class="uicontrol">Suspend</span>   — Suspends users' LDAP  account when they are unassigned in <MadCap:variable name="okta-variables.ProductName"/> or their <MadCap:variable name="okta-variables.ProductName"/> account is deactivated. Accounts can be reactivated if the app is reassigned to a user in <MadCap:variable name="okta-variables.ProductName"/>.</li>
               </ul>
            </li>
         </ul>
         <p>
            <ul>
               <li>
                  <span class="uicontrol">When a user is reactivated in the app</span>: Specify what action <MadCap:variable name="okta-variables.ProductName"/> should take if the user's account is reactivated in <MadCap:variable name="okta-variables.ProductName"/>.<ul>
                     <li>
                        <span class="uicontrol">Reactivate suspended <MadCap:variable name="okta-variables.ProductName"/> users</span>  — Reactivate suspended <MadCap:variable name="okta-variables.ProductName"/> users if they are reactivated in LDAP.</li>
                     <li>
                        <span class="uicontrol">Reactivate deactivated <MadCap:variable name="okta-variables.ProductName"/> users</span>  — Reactivate deactivated <MadCap:variable name="okta-variables.ProductName"/> users if they  are reactivated in LDAP.</li>
                  </ul>
               </li>
            </ul>
         </p>
         <li>
            <MadCap:snippetText src="../../Resources/Snippets/task steps/Click_Save.flsnp">
                </MadCap:snippetText>
         </li>
         <li>Optional. To define the <span class="uicontrol">Import Safeguard</span> settings, click <span class="uicontrol">Edit</span> and complete the following:<ul>
               <li>
                  <span class="uicontrol">App unassignment safeguard</span> — Select <span class="uicontrol">Enabled</span> to enable import safeguards, or select <span class="uicontrol">Disabled</span> to disable import safeguards.</li>
               <li>
                  <span class="uicontrol">is the threshold for unassignments from any app</span> — Enter the percentage of allowable app or org unassignments, or select <span class="uicontrol">Set to default</span> to set the percentage to the default value.</li>
               <li>
                  <p>
                     <span class="uicontrol">Org-wide unassignment safeguard</span> — Select <span class="uicontrol">Enabled</span> to enable import safeguards for the entire org, or select <span class="uicontrol">Disabled</span> to disable import safeguards for the entire org.</p>
               </li>
               <li>
                  <p>
                     <span class="uicontrol">is the threshold for unassignments across the org</span>  — Enter the percentage of allowable app or org unassignments for the org, or select <span class="uicontrol">Set to default</span> to set the percentage for the org to the default value.</p>
               </li>
            </ul>
         </li>
         <li>
            <p>
                    Click <span class="uicontrol">Save</span>.
                </p>
         </li>
      </ol>
      <h2>Next steps</h2>
      <p>
         <MadCap:xref href="ad-agent-configure-provisioning.htm">Configure Active Directory provisioning settings</MadCap:xref>
      </p>
   </body>
</html>
