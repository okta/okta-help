<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd"
       MadCap:onlyLocalStylesheets="False"
       MadCap:searchable="True"
       MadCap:conditions="MultiProdPublish.Classic+OIE,Primary.do-not-publish"
       MadCap:fileTags="Tags/okta-authors.Patrick Calnan">
   <head>
      <title>[%=Heading.Level1%] | Okta</title>
      <link href="" rel="stylesheet" type="text/css"/>
      <meta name="description"
             content="Use Okta LDAP agent log information or an LDAP browser like Apache Directory Studio to troubleshoot LDAP issues."/>
   </head>
   <body>
      <h1>LDAP integration troubleshooting</h1>
      <p>To troubleshoot LDAP issues, obtain an LDAP browser such as <span class="uicontrol">Apache Directory Studio</span>.</p>
      <p>Note that the schema templates are suggestions based on common values. Each LDAP environment is unique and might require you to override the default values with your environment-specific settings. You can use Apache Directory Studio to examine attributes for existing users and groups to verify the template values, or you can select the appropriate setting.</p>
      <p>Changing templates modifies all template default values. Settings that you override are not changed.</p>
      <br/>
      <MadCap:dropDown>
         <MadCap:dropDownHead>
            <MadCap:dropDownHotspot>Error when installing the agent</MadCap:dropDownHotspot>
         </MadCap:dropDownHead>
         <MadCap:dropDownBody>
            <p>During agent installation, after clicking <span class="uicontrol">Allow Access</span>, the following error message displays:</p>
            <p>
               <span class="msgblock">Failed to parse response from Okta and Unable to register the agent. Error code 12</span>.</p>
            <p>Check the log and look for this entry:</p>
            <span class="msgblock">javax.net.ssl.SSLHandshakeException: java.security.cert.CertificateException: No valid public key found in certificate chain.</span>
            <p>If the log contains the above entry, then you are probably attempting to install Java LDAP agent <span class="uicontrol">version 5.3.1</span> or later and your environment is one in which the agent's support for SSL certificate pinning prevents communication with the Okta server. This is most likely to occur in environments that rely on <span class="uicontrol">SSL proxies</span>. To allow installation to complete in this case, Okta recommends that you bypass SSL proxy processing by adding the domain <span class="url">okta.com</span> to a allowlist.</p>
            <p>Alternatively, you can choose to disable SSL pinning as described below, but be aware that doing so disables a security enhancement provided by the agent.</p>
            <p>To disable support for SSL certificate pinning, perform the procedure below appropriate for your operating system:</p>
            <h4>Windows</h4>
            <p>Install the <MadCap:variable name="okta-feature-names.LDAP agent short"/> from a command line.</p>
            <ol>
               <li>On the host server, sign in to <MadCap:variable name="okta-variables.ProductName"/> using an <MadCap:variable name="okta-variables.ProductName"/> admin account with <span class="uicontrol">Super</span> admin permissions, to access the Admin Console.</li>
               <li>Download the <MadCap:variable name="okta-feature-names.LDAP agent short"/>:<ol style="list-style-type: lower-alpha;">
                     <li>In the <MadCap:variable name="okta-feature-names.Administrator dashboard"/>, go to <span class="menucascade">
                           <span class="uicontrol">Directory</span>
                           <span class="uicontrol"> Directory Integrations</span>
                        </span>.</li>
                     <li>Click <span class="menucascade">
                           <span class="uicontrol">Add Directory</span>
                           <span class="uicontrol">Add LDAP Directory</span>
                        </span>.</li>
                     <li>Review the installation requirements, and then click <span class="uicontrol">Set Up LDAP</span>.</li>
                     <li>Click <span class="uicontrol">Download Agent</span> and select <span class="uicontrol">Download EXE Installer</span> and download it to your Windows server.</li>
                  </ol>
               </li>
               <li>Open a command line and run this command:</li>
            </ol>
            <span class="code">OktaADAgentSetup.exe OktaDisableSslPinning=1</span>
            <ol MadCap:continue="true">
               <li>Complete the installation:<ol style="list-style-type: lower-alpha;">
                     <li>If the message displays <span class="uicontrol">Do you want to allow the following program to make changes to this computer?</span>, click <span class="uicontrol">Yes</span>.</li>
                     <li>Click <span class="uicontrol">Next</span>.</li>
                     <li>Accept the license agreement and click <span class="uicontrol">Next</span>.</li>
                     <li>Accept the default installation folder location, or click <span class="uicontrol">Browse</span> to select another location, and click <span class="uicontrol">Install</span>.</li>
                     <li>Optional. If you want to enable LDAP over SSL (LDAPS), complete <MadCap:xref href="ldap-agent-enable-LDAP-SSL.htm">Enable LDAP over SSL</MadCap:xref>, and then continue with this procedure.</li>
                     <li>On the LDAP configuration screen, enter the following information:<ul>
                           <li>
                              <span class="uicontrol">LDAP Server</span> —  Enter the LDAP host and port in the form of <span class="userinput">host:port</span>. For example: <span class="url">ldap.mycompany.com:389</span>.</li>
                           <li>
                              <span class="uicontrol">Root DN</span> —  The root distinguished name of the DIT from which users and groups are searched.</li>
                           <li>
                              <span class="uicontrol">Bind DN</span> —  The distinguished name of the bind LDAP user that is used to connect to the LDAP directory by the agent.</li>
                           <li>
                              <span class="uicontrol">Bind Password</span> — The password of the bind distinguished name that is used to connect to the LDAP directory by the agent.</li>
                           <li>Optional. <span class="uicontrol">Use SSL connection</span> —  Select  if you have enabled LDAP over SSL (LDAPS). (<span class="uicontrol">Note:</span> If you select this without performing the steps in <MadCap:xref href="ldap-agent-enable-LDAP-SSL.htm">Enable LDAP over SSL</MadCap:xref>, the error <span class="uicontrol">Failed to connect to the specified LDAP server</span> displays.)</li>
                        </ul>
                     </li>
                  </ol>
               </li>
            </ol>
            <ol MadCap:continue="true">
               <li>Click <span class="uicontrol">Next</span>.</li>
               <li>	Optional. Enter a proxy server for the <MadCap:variable name="okta-feature-names.LDAP agent short"/> on the <MadCap:variable name="okta-variables.ProductName"/> LDAP Agent Proxy Configuration page, and then click <span class="uicontrol">Next</span>.</li>
            </ol>
            <p style="text-align: left;margin-left: 40px;">If the LDAP proxy server returns its own schema, issues importing user data can occur when the proxy server schema and LDAP server schemas are different. To avoid data importation issues, make sure the LDAP proxy server and LDAP server schemas are identical.</p>
            <ol MadCap:continue="true">
               <li>	To register the <MadCap:variable name="okta-feature-names.LDAP agent short"/> with the <MadCap:variable name="okta-variables.ProductName"/> service, enter your <MadCap:variable name="okta-variables.ProductName"/> subdomain name, and then click <span class="uicontrol">Next</span>.</li>
               <li>	On the <span class="uicontrol">
                     <MadCap:variable name="okta-variables.ProductName"/> Sign In</span> page, enter the username and password for your <MadCap:variable name="okta-variables.ProductName"/> admin account, and then click <span class="uicontrol">Sign In</span>.</li>
               <li>	Click <span class="uicontrol">Allow Access</span> to access the <MadCap:variable name="okta-variables.ProductName"/> API. <span class="uicontrol">Note</span>: If an error message appears, see <MadCap:xref href="ldap-agent-log-info.htm">Locate the [%=okta-variables.ProductName%] LDAP agent log</MadCap:xref>.</li>
               <li>	Click <span class="uicontrol">Finish</span>.</li>
               <li>Configure the LDAP integration settings.</li>
            </ol>
            <p>If you want to re-enable support for SSL certificate pinning if it was disabled:</p>
            <ol>
               <li>Locate and open the AD agent configuration file:<span class="filepath">C:\Program Files (x86)\Okta\Okta AD Agent\OktaAgentSetup.exe.config</span>
               </li>
            </ol>
            <ol MadCap:continue="true">
               <li>Change the SSL pinning enabled setting to True:<p style="font-family: 'Courier New';">
                     <span class="code">"SslPinningEnabled" value="True"</span>
                  </p>
               </li>
            </ol>
            <ol MadCap:continue="true">
               <li>Save the configuration file and restart the agent.</li>
            </ol>
            <h4>Linux</h4>
            <ol>
               <li>From a command line, change the SSL pinning enabled setting to false:<span class="code">$ sudo /opt/Okta/OktaLDAPAgent/scripts/configure_agent.sh -sslPinningEnabled false</span>
               </li>
            </ol>
            <ol MadCap:continue="true">
               <li>Save the configuration file and restart the agent.</li>
            </ol>
            <p>If you want to re-enable support for SSL certificate pinning after you have completed installation, open <span class="uicontrol">OktaLDAPAgent.conf</span> and change the SSL pinning enabled setting to <span class="code">true</span>.</p>
            <p>For more information about SSL certificate pinning, see the article by the <a href="https://www.owasp.org/index.php/Certificate_and_Public_Key_Pinning">Open Web Application Security Project</a>.</p>
         </MadCap:dropDownBody>
      </MadCap:dropDown>
      <br/>
      <MadCap:dropDown>
         <MadCap:dropDownHead>
            <MadCap:dropDownHotspot>
               <a name="ImportLDAPRoleObjects"/>Difficulty importing LDAP role objects</MadCap:dropDownHotspot>
         </MadCap:dropDownHead>
         <MadCap:dropDownBody>
            <h3>Use case</h3>
            <p>You created a new role in your LDAP directory, but the role is not imported into Okta when users assigned to the role sign in to Okta, even though JIT is enabled.</p>
            <h4>When does Okta bring LDAP roles into Okta?</h4>
            <p>Okta brings LDAP roles into Okta only during imports, not during JIT. Once brought into Okta, LDAP roles are represented as groups.</p>
            <h4>When does Okta bring LDAP groups into Okta?</h4>
            <p>Okta brings LDAP groups into Okta during imports and JIT.</p>
            <h3>Workarounds</h3>
            <p>If you don’t want to import all user accounts into Okta, consider implementing any of the following workarounds in your Preview org. If you get the results that you expect, you can then implement the workaround in your Production org.</p>
            <h4>Import a group into Okta that has the same membership as a particular LDAP role</h4>
            <ol>
               <li>
                  <p>Create a group in LDAP that has the same membership as the role in LDAP that you want to import.</p>
               </li>
               <li>
                  <p>Using either JIT provisioning or an LDAP Import, bring that group and its membership into Okta and assign it to the desired application or integration.</p>
               </li>
            </ol>
            <h4>Perform an LDAP import into Okta without confirming undesired objects</h4>
            <ol>
               <li>
                  <p>In Okta, go to <span class="menucascade">
                        <span class="uicontrol">Directory</span>
                        <span class="uicontrol">Directory Integrations</span>
                        <span class="uicontrol">LDAP</span>
                        <span class="uicontrol">Settings</span>
                        <span class="uicontrol">Import Settings</span>
                     </span>.</p>
               </li>
               <li>
                  <p>In the <span class="uicontrol">Import Matching Rules</span> section, scroll down to <span class="uicontrol">When no match found</span> and select <span class="uicontrol">Manually confirm new user</span>. This ensures that no new user accounts are created in Okta automatically when you run an import.</p>
               </li>
               <li>
                  <p>Run an import against your LDAP directory to import the group you created in Step 1. Group members are added to the group later when they JIT into Okta.</p>
               </li>
            </ol>
            <h4>Temporarily segregate inactive LDAP accounts</h4>
            <p>If you don’t want to perform an import because your LDAP directory contains a large number of inactive user accounts, you can perform the following workaround to identify likely inactive accounts and segregate them before you import:</p>
            <ol>
               <li>
                  <p>Run a query against your LDAP directory for the attribute <span class="code">lastlogon</span> (or another attribute that filters for inactive accounts).</p>
               </li>
               <li>
                  <p>Move the inactive user objects out of their synchronization container to ensure they are not introduced into Okta during import. You can move these objects back in after the import is finished.</p>
               </li>
            </ol>
         </MadCap:dropDownBody>
      </MadCap:dropDown>
      <br/>
      <MadCap:dropDown>
         <MadCap:dropDownHead>
            <MadCap:dropDownHotspot>Error when verifying username</MadCap:dropDownHotspot>
         </MadCap:dropDownHead>
         <MadCap:dropDownBody>
            <p>When verifying your username, you receive this error</p>
            <p>
               <span class="msgblock">Username: Does not match required pattern</span>
            </p>
            <p>The username must be in an email format. Verify the import settings are set correctly. See <a href="ldap-agent-install-configure.htm">Install and configure the Okta LDAP agent</a>.</p>
         </MadCap:dropDownBody>
      </MadCap:dropDown>
      <br/>
      <MadCap:dropDown>
         <MadCap:dropDownHead>
            <MadCap:dropDownHotspot>Error after selecting the SSL check box</MadCap:dropDownHotspot>
         </MadCap:dropDownHead>
         <MadCap:dropDownBody>
            <p>You selected the <span class="uicontrol">Use SSL connection</span> check box and you receive the error</p>
            <p>
               <span class="msgblock">Failed to connect to the specified LDAP server displays.</span>
            </p>
            <p>Make sure that you have enabled LDAP over SSL (LDAPS). See <a href="ldap-agent-enable-LDAP-SSL.htm">Enable LDAP over SSL</a>.</p>
         </MadCap:dropDownBody>
      </MadCap:dropDown>
      <br/>
      <MadCap:dropDown MadCap:conditions="Primary.review-only">
         <MadCap:dropDownHead>
            <MadCap:dropDownHotspot>Authenticate user with AD agent - Failure - Delegated authentication request was not processed.        No agents are connected to <MadCap:variable name="okta-variables.ProductName"/>
            </MadCap:dropDownHotspot>
         </MadCap:dropDownHead>
         <MadCap:dropDownBody>
            <p>This error message appears because the agent didn't return data fast enough and delegated authentication timed out.</p>
         </MadCap:dropDownBody>
      </MadCap:dropDown>
      <br/>
      <MadCap:dropDown MadCap:conditions="Primary.review-only">
         <MadCap:dropDownHead>
            <MadCap:dropDownHotspot>Sign-in Failed – Not Specified</MadCap:dropDownHotspot>
         </MadCap:dropDownHead>
         <MadCap:dropDownBody>
            <p>The cause of this error message can include:</p>
            <ul>
               <li>The user is not found in LDAP. If this is the cause, the error message includes: <span class="uicontrol">failure: User not found while executing query: ((query))</span>
               </li>
               <li>The user is inactive in LDAP</li>
               <li>A miscellaneous operational error, such as a transition to read only midway though Just In Time (JIT) provisioning </li>
            </ul>
         </MadCap:dropDownBody>
      </MadCap:dropDown>
      <br/>
      <MadCap:dropDown MadCap:conditions="Primary.review-only">
         <MadCap:dropDownHead>
            <MadCap:dropDownHotspot>Sign-in Failed – Invalid Credentials</MadCap:dropDownHotspot>
         </MadCap:dropDownHead>
         <MadCap:dropDownBody>
            <p>This error message appears when a user enters a blank user name or password, or an incorrect password is entered. </p>
         </MadCap:dropDownBody>
      </MadCap:dropDown>
   </body>
</html>
