<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd"
      MadCap:fileTags="Tags/okta-topic-status.Complete,Tags/okta-authors.Patrick Calnan"
      MadCap:onlyLocalStylesheets="False"
      MadCap:searchable="True"
      MadCap:conditions="MultiProdPublish.Classic+OIE">
   <head>
      <link href="../../Resources/TableStyles/standard-shaded-rows.css"
            rel="stylesheet"
            MadCap:stylesheetType="table"/>
      <title>[%=Heading.Level1%] | Okta</title>
      <link href="" rel="stylesheet" type="text/css"/>
      <meta name="description"
            content="Install the Okta Password Sync agent so password changes in AD are reflected in Okta accounts and automatically pushed to mobile devices. "/>
   </head>
   <body>
      <h1>Synchronize passwords from Active Directory to <MadCap:variable name="okta-variables.ProductName"/>
      </h1>
      <p>You use the <MadCap:variable name="okta-feature-names.Okta AD Password Sync Agent"/> to synchronize passwords from Active Directory (AD) to <MadCap:variable name="okta-variables.ProductName"/> and to integrated apps with password synchronization.</p>
      <p>When delegated authentication to AD is enabled, directory passwords are not synchronized to <MadCap:variable name="okta-variables.ProductName"/> because delegated authentication performs the authentication and there is no <MadCap:variable name="okta-variables.ProductName"/> password. With delegated authentication users use their directory password to sign on to <MadCap:variable name="okta-variables.ProductName"/>.</p>
      <p>Occasionally, directory passwords need to be synchronized from a directory through <MadCap:variable name="okta-variables.ProductName"/> to an application. To accomplish this synchronization, a user uses their directory password to sign on to <MadCap:variable name="okta-variables.ProductName"/>. <MadCap:variable name="okta-variables.ProductName"/> checks the password and then determines if the user is assigned to an application using password synchronization. If there are no assigned applications using password synchronization, the password is cached for five days. If the application uses password synchronization, the password is synchronized to the application, the password is stored in <MadCap:variable name="okta-variables.ProductName"/> as the application password, and then the directory password is cached for five days. </p>
      <p>If users sign in to <MadCap:variable name="okta-variables.ProductName"/> using Desktop Single Sign-on (DSSO) instead of using a username or password, the Password Sync Agent is required to track password changes in AD and then synchronize the changes to <MadCap:variable name="okta-variables.ProductName"/>. Alternatively, you can ask your users to change their AD passwords in <MadCap:variable name="okta-variables.ProductName"/> or ask them to sign in to <MadCap:variable name="okta-variables.ProductName"/> after a password change  in AD to sync their password with applications.</p>
      <p>The scenarios described in the following table are intended to help you determine if you need to install the <MadCap:variable name="okta-feature-names.Okta AD Password Sync Agent"/>.</p>
      <table style="width: 100%;mc-table-style: url('../../Resources/TableStyles/standard-shaded-rows.css');"
             class="TableStyle-srb_header_alt_shade"
             cellspacing="0">
         <col style="width: 25%;"
              class="TableStyle-srb_header_alt_shade-Column-Column1"/>
         <col style="width: 25%;"
              class="TableStyle-srb_header_alt_shade-Column-Column1"/>
         <col style="width: -139px;"
              class="TableStyle-srb_header_alt_shade-Column-Column1"/>
         <thead>
            <tr class="TableStyle-srb_header_alt_shade-Head-Header1">
               <th class="TableStyle-srb_header_alt_shade-HeadF-Column1-Header1">
                        Scenario
                    </th>
               <th class="TableStyle-srb_header_alt_shade-HeadF-Column1-Header1">
                        User Experience
                    </th>
               <th class="TableStyle-srb_header_alt_shade-HeadD-Column1-Header1">
                        Outcome
                    </th>
            </tr>
         </thead>
         <tbody>
            <tr class="TableStyle-srb_header_alt_shade-Body-Body1">
               <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1"
                   MadCap:conditions="Primary.do-not-publish">
                  <MadCap:variable name="okta-variables.ProductName"/> is connected to an AD domain. An <MadCap:variable name="okta-feature-names.Okta AD Password Sync Agent"/> is not deployed.</td>
               <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1">
                  <ul>
                     <li>The user changes their password from their workstation sign in screen.</li>
                     <li>The user signs on to their device.</li>
                     <li>The user attempts to sign in to another application with password synchronization.</li>
                  </ul>
               </td>
               <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body1"
                   MadCap:conditions="Primary.do-not-publish">The user receives a password error message because the new password has not been synced to the application. To synchronize the new password to <MadCap:variable name="okta-variables.ProductName"/> integrated apps, users need to sign out from <MadCap:variable name="okta-variables.ProductName"/> and then sign in to <MadCap:variable name="okta-variables.ProductName"/>.</td>
            </tr>
            <tr class="TableStyle-srb_header_alt_shade-Body-Body2">
               <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2"
                   MadCap:conditions="Primary.do-not-publish">
                  <MadCap:variable name="okta-variables.ProductName"/> is connected to an AD domain and Desktop Single Sign-on (DSSO) is implemented. An <MadCap:variable name="okta-feature-names.Okta AD Password Sync Agent"/> is not deployed.</td>
               <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2">
                  <ul>
                     <li MadCap:conditions="Primary.do-not-publish">The user changes their password from their workstation sign in screen.</li>
                     <li MadCap:conditions="Primary.do-not-publish">The user signs on to their device.</li>
                     <li MadCap:conditions="Primary.do-not-publish">The user attempts to sign in to another application that uses password sync.</li>
                  </ul>
               </td>
               <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body2"
                   MadCap:conditions="Primary.do-not-publish">The user receives a password error message because the new password has not been synced to the application. To synchronize the new password, users need to sign out from <MadCap:variable name="okta-variables.ProductName"/> and then sign in to <MadCap:variable name="okta-variables.ProductName"/>.</td>
            </tr>
            <tr class="TableStyle-srb_header_alt_shade-Body-Body1">
               <td class="TableStyle-srb_header_alt_shade-BodyC-Column1-Body1"
                   MadCap:conditions="Primary.do-not-publish">
                  <MadCap:variable name="okta-variables.ProductName"/> is connected to an AD domain and DSSO may or may not be implemented. An <MadCap:variable name="okta-feature-names.Okta AD Password Sync Agent"/> is installed on every domain controller in the domain.</td>
               <td class="TableStyle-srb_header_alt_shade-BodyC-Column1-Body1">
                  <ul>
                     <li MadCap:conditions="Primary.do-not-publish">The user changes their password from their workstation sign in screen.</li>
                     <li MadCap:conditions="Primary.do-not-publish">The user signs on to their device.</li>
                     <li MadCap:conditions="Primary.do-not-publish">The user attempts to sign in to another application that uses password sync.</li>
                  </ul>
               </td>
               <td class="TableStyle-srb_header_alt_shade-BodyA-Column1-Body1"
                   MadCap:conditions="Primary.do-not-publish">The user accesses the application successfully. The <MadCap:variable name="okta-feature-names.Okta AD Password Sync Agent"/>  intercepted the password change event and pushed it to <MadCap:variable name="okta-variables.ProductName"/>.</td>
            </tr>
         </tbody>
      </table>
      <h2>Active Directory password reset workflow</h2>
      <p>When a user changes their AD password in <MadCap:variable name="okta-variables.ProductName"/>, <MadCap:variable name="okta-variables.ProductName"/> uses the AD Agent to send the request to AD. An AD password reset is not a password synchronization event.</p>
      <p>This is a typical password reset workflow:</p>
      <ul>
         <li>A user unsuccessfully attempts to sign on to <MadCap:variable name="okta-variables.ProductName"/>.</li>
         <li>The user requests a password reset.</li>
         <li>The user successfully answers the forgotten password question or SMS authentication which includes a forgotten password question.</li>
         <li>The user is authenticated to <MadCap:variable name="okta-variables.ProductName"/>, but not AD.</li>
         <li>The user is asked to enter a new password.</li>
         <li>The new password is temporarily held by <MadCap:variable name="okta-variables.ProductName"/>.</li>
         <li>
            <MadCap:variable name="okta-variables.ProductName"/> pushes the password to AD. This requires elevated permissions on the <MadCap:variable name="okta-feature-names.AD agent"/> service account.</li>
         <li>The AD password reset activates password synchronization to applications using password synchronization.</li>
         <li>
            <MadCap:variable name="okta-variables.ProductName"/> forgets the password.</li>
      </ul>
      <h2>
         <a name="SystemRequirements"/>Before you begin</h2>
      <ul>
         <li>You have an AD domain integrated with <MadCap:variable name="okta-variables.ProductName"/>.</li>
         <li>The <MadCap:variable name="okta-feature-names.AD agent"/> is installed and configured in each integrated domain in your forest.</li>
         <li>The <MadCap:variable name="okta-feature-names.Okta AD Password Sync Agent"/> is installed and configured on all domain controllers in each integrated domain in your forest.</li>
         <li>Delegated Authentication is enabled. For more about Delegated Authentication, see <a href="../Security/Security_Authentication.htm">Authentication</a>.					</li>
         <li>The <MadCap:variable name="okta-variables.ProductName"/> username format must be <span class="uicontrol">UPN</span> or <span class="uicontrol">SAM Account Name</span>. If you have mapped Active Directory to <MadCap:variable name="okta-variables.ProductName"/> using any other username format the <MadCap:variable name="okta-feature-names.Okta AD Password Sync Agent"/> will fail.</li>
         <li>To improve the security of our integrations, we now only communicate using the TLS1.2 security protocol. For Windows 2008 R2 TLS 1.2 is disabled by default and <span class="uicontrol">must</span> be enabled through the registry. If you have Windows 2008 R2,  ensure the following regkeys are set correctly:<br/>
            <br/>
            <span class="code">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server] "Enabled"=dword:00000001</span>
            <p>
               <span class="code">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server] "DisabledByDefault"=dword:00000000</span>
            </p>
            <span class="code">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client] "Enabled"=dword:00000001</span>
            <p>
               <span class="code">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client] "DisabledByDefault"=dword:00000000</span>
            </p>
         </li>
      </ul>
      <h2>
         <a id="InstallingADPasswordSyncAgent" name="InstallingADPasswordSyncAgent"/>Install the <MadCap:variable name="okta-feature-names.Okta AD Password Sync Agent"/>
      </h2>
      <p>When installing  Okta Active Directory Password Sync Agent versions 1.4.0 and later, the Microsoft Visual C++ Redistributable for Visual Studio 2019 is installed if it hasn't been installed previously.</p>
      <ol>
         <li> On the domain controller, go to the <MadCap:variable name="okta-variables.ProductName"/> Admin Console, click <span class="menucascade">
               <span class="uicontrol">Security</span>
               <span class="uicontrol">Delegated Authentication</span>
            </span> and in the right pane scroll down and click <span class="uicontrol">Download <MadCap:variable name="okta-variables.ProductName"/> AD Password Sync</span>.
	</li>
         <li>Double-click the installer file and follow the prompts.</li>
         <li>When prompted, enter your <MadCap:variable name="okta-variables.ProductName"/> URL. For example, <span class="term">https://mycompany.okta.com</span>. You must use the <span class="term">https://</span> protocol in your entry.</li>
         <li>When prompted, choose where you want to install the <MadCap:variable name="okta-feature-names.Okta AD Password Sync Agent"/>, and then click <span class="uicontrol">Install</span>.</li>
         <li>Click <span class="uicontrol">Finish</span>.</li>
         <li>Restart the server.</li>
         <li>Optional. Repeat steps 1 to 6 on every domain controller in your forest that you want to integrate with <MadCap:variable name="okta-variables.ProductName"/>.</li>
      </ol>
      <h3>Unattended installation</h3>
      <p>You can use a script or  a command to perform an unattended install of the <MadCap:variable name="okta-feature-names.Okta AD Password Sync Agent"/>. The unattended mode does not restart the system after the installation is complete. You must restart the system manually or use the <span class="code">shutdown /r</span> command. </p>
      <p>The syntax for an unattended installation is: <span class="code">OktaPasswordSyncSetup.exe /install /q2 OktaURL=https://mycompany.okta.com</span> or <span class="code">msiexec /i OktaPasswordSyncSetup.msi /quiet EXEOPTIONS="/q2 OktaURL=https://mycompany.okta.com"</span>.</p>
      <p>If installing on multiple servers, you may want to create a registry file that sets the <MadCap:variable name="okta-variables.ProductName"/> username format used by the <MadCap:variable name="okta-feature-names.Okta AD Password Sync Agent"/>. Creating a DWORD Value called <span class="uicontrol">
            <MadCap:variable name="okta-variables.ProductName"/> Username Format</span> allows you to choose between SAM Account Name (value = 1) or UPN (value = 0).</p>
      <p>For example, to set the <span class="uicontrol">Username</span> format to SAM Account Name, create a .reg file with the following:</p>
      <span class="code">[HKEY_LOCAL_MACHINE\SOFTWARE\Okta\AD Password Sync]</span>
      <br/>
      <span class="code">"Okta username format"=dword:00000001</span>
      <p>
         <a name="InstallationCore"/>
      </p>
      <h3>Install the <MadCap:variable name="okta-feature-names.Okta AD Password Sync Agent"/> on Windows Server Core, Release 2</h3>
      <p>Before you can install the Active Directory (AD) Password Sync agent on Windows Server Core, you must do the following:</p>
      <ol>
         <li>
            <p>Install the hotfix from here: <a href="http://support.microsoft.com/kb/2624641" target="_blank">http://support.microsoft.com/kb/2624641</a>
            </p>
         </li>
         <li>
            <p>If you are downgrading to an earlier version of the agent, manually uninstall previous versions of the Tarma installer. The uninstaller is located here:</p>
            <p>
               <span class="code">%ProgramData%\InstallMate\{5433CCD3-328D-4326-9E1A-56C9B1D3A7E1}\Setup.exe</span>
            </p>
            <p>To perform an unattended uninstall:  <span class="code">%ProgramData%\InstallMate{5433CCD3-328D-4326-9E1A-56C9B1D3A7E1}\Setup.exe /remove /q2</span>
            </p>
         </li>
         <li>
            <p>The <MadCap:variable name="okta-feature-names.Okta AD Password Sync Agent"/> does not support the management console and you must use <span class="code">regedit</span> to disable the setting. You can monitor the <MadCap:variable name="okta-feature-names.Okta AD Password Sync Agent"/> logs  located at: <span class="uicontrol">%ProgramData%\<MadCap:variable name="okta-variables.ProductName"/>\AD Password Sync\logs</span>.</p>
         </li>
         <li>Install the <MadCap:variable name="okta-feature-names.Okta AD Password Sync Agent"/>. See <a href="#InstallingADPasswordSyncAgent">Install the Okta Password Sync agent.</a>
         </li>
      </ol>
      <h2>
         <a name="Configuration"/>Configure the <MadCap:variable name="okta-feature-names.Okta AD Password Sync Agent"/>
      </h2>
      <ol>
         <li>Click <span class="menucascade">
               <span class="uicontrol">Start</span>
               <span class="uicontrol">All Programs</span>
               <span class="uicontrol">Okta </span>
               <span class="uicontrol">Okta AD Password Sync</span>
               <span class="uicontrol">Okta AD Password Synchronization Agent Management Console</span>
            </span>. </li>
         <li>Click <span class="uicontrol">Verify URL</span> to check the <MadCap:variable name="okta-variables.ProductName"/> URL is correct and the target server is reachable. If the URL is valid, a success message appears below the <MadCap:variable name="okta-variables.ProductName"/> URL field.</li>
      </ol>
      <p style="text-align: left;margin-left: 40px;">
         Note: If an <span class="uicontrol">error message</span> appears, see <MadCap:xref href="password-sync-troubleshoot.htm">Troubleshoot password synchronization</MadCap:xref>.</p>
      <p style="text-align: left;margin-left: 40px;">You can optionally change the <span class="uicontrol">Log severity level</span> setting. You can control the information that goes into logging reports by selecting one of the following options:</p>
      <ul style="text-align: left;margin-left: 45px;">
         <li>
            <span class="uicontrol">None</span>: Logs nothing.</li>
         <li>
            <span class="uicontrol">Debug</span>: Logs debug, info, and error events.</li>
         <li>
            <span class="uicontrol">Info</span>: Logs info and error events. This is the default logging level .</li>
         <li>
            <span class="uicontrol">Error</span>: Logs error events only.</li>
      </ul>
   </body>
</html>
