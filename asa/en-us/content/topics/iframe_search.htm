<!DOCTYPE html>
<head>
    <meta charset="UTF-8" >

    <link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.10110/css/CoveoFullSearch.min.css" />
    <script class="coveo-script" src="https://static.cloud.coveo.com/searchui/v2.10110/js/CoveoJsSearch.Lazy.min.js"></script>
    <script src="https://static.cloud.coveo.com/searchui/v2.10110/js/templates/templates.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var getMadcapFlareVariable = function (id) {
                var content = '';
                var wrapper = window.parent.document.getElementById(id);
                if (wrapper) {
                    content = wrapper.firstChild.textContent || '';
                }
                return content;
            };

            let isProd = window.location.host === 'help.okta.com';
            // let coveo_org_id = getMadcapFlareVariable(isProd ? 'coveo_org_id' : 'coveo_dev_org_id');

            let coveo_org_id = "oktaproduction9ounvcxa";
            let coveo_rest_uri = "https://platform.cloud.coveo.com/rest/search";
            let coveo_token_url = "https://support.okta.com/help/services/apexrest/PublicSearchToken?site=help"
            coveo_token_url = "https://support.okta.com/help/services/apexrest/PublicSearchToken?site=help"
            //fetch("https://wt1ugse0be.execute-api.us-west-2.amazonaws.com/prod/token?site=help1", console.log)
            //fetch("https://support.okta.com/help/services/apexrest/PublicSearchToken?site=help1", console.log)

            var tokenPromise = new Promise(function (resolve, reject) {
                let okta_token = "eyJhbGciOiJIUzI1NiJ9.eyJmaWx0ZXIiOiIoKChAY29tbW9uY29udGVudHR5cGUgTk9UIEBjb21tb25jb250ZW50dHlwZT09KENhc2VzLFBlb3BsZSkpIE9SIChAY29tbW9uY29udGVudHR5cGU9PVBlb3BsZSBAc2ZvaGNhZ3JlZWR0ZXJtc2FuZGNvbmRpdGlvbnNjPXRydWUgQHNmcmVtb3ZlbWVzZWFyY2hjPWZhbHNlKSkgTk9UIEBzZmtiaWQgKChOT1QgQGNvbW1vbmNvbnRlbnR0eXBlPT0oSWRlYXMsRXZlbnRzLEdyb3VwcykpIE9SIChAY29tbW9uY29udGVudHR5cGU9PUV2ZW50cyBAc2ZndWVzdHVzZXJhY2Nlc3NjPT10cnVlKSkpIE9SIChAc2ZrYmlkIChAc2Zpc3Zpc2libGVpbnBrYj1cInRydWVcIikpIiwidXNlckdyb3VwcyI6WyJPa3RhIEhlbHAgQ2VudGVyIFByb2ZpbGUiXSwic2VhcmNoSHViIjoiT2t0YUNvbW11bml0eUZ1bGxTZWFyY2giLCJ2OCI6dHJ1ZSwidG9rZW5JZCI6Ind6Y2V6YWNlMjU3YTQ2Zml4NGpzNGJjang0Iiwib3JnYW5pemF0aW9uIjoib2t0YXByb2R1Y3Rpb245b3VudmN4YSIsInVzZXJJZHMiOlt7InR5cGUiOiJVc2VyIiwibmFtZSI6ImFub255bW91cyIsInByb3ZpZGVyIjoiRW1haWwgU2VjdXJpdHkgUHJvdmlkZXIifV0sInJvbGVzIjpbInF1ZXJ5RXhlY3V0b3IiXSwiaXNzIjoiU2VhcmNoQXBpIiwiZXhwIjoxNzI1MDI4MDQ2LCJpYXQiOjE3MjQ5NDE2NDZ9.W5tKlxEG0Uyh3f_e4OTy_5rouXc-OfIAyulLtAdbGZw"
                let devs_token = "eyJhbGciOiJIUzI1NiJ9.eyJmaWx0ZXIiOiJAc291cmNlPT0ob2t0YS1kZXZlbG9wZXItZm9ydW0sb2t0YS1kZXZlbG9wZXIsb2t0YS1kZXZlbG9wZXItZ2l0aHViLG9rdGEtZ2l0aHViKSBOT1QgQGZpbGV0eXBlPT0oVG9waWMsQ2F0ZWdvcnkpIiwidXNlckdyb3VwcyI6WyJPa3RhIERldmVsb3BlciBHdWVzdCBQcm9maWxlIl0sInNlYXJjaEh1YiI6ImRldmVsb3Blci1va3RhLWNvbSIsInY4Ijp0cnVlLCJ0b2tlbklkIjoic3M1Y2Fjbm16aXNyNnl0ZzRlbWpqYWtkNDQiLCJvcmdhbml6YXRpb24iOiJva3RhcHJvZHVjdGlvbjlvdW52Y3hhIiwidXNlcklkcyI6W3sidHlwZSI6IlVzZXIiLCJuYW1lIjoiYW5vbnltb3VzIiwicHJvdmlkZXIiOiJFbWFpbCBTZWN1cml0eSBQcm92aWRlciJ9XSwicm9sZXMiOlsicXVlcnlFeGVjdXRvciJdLCJpc3MiOiJTZWFyY2hBcGkiLCJleHAiOjE3MjQ4NjE2MzgsImlhdCI6MTcyNDc3NTIzOH0.6r83m5bSax8CpcoT8CaEyRkKL4ei52XSN92pAT7bkjE"
                devs_token = "eyJhbGciOiJIUzI1NiJ9.eyJmaWx0ZXIiOiIoQHd3d2NvbW1vbmNvbnRlbnR0eXBlIE5PVCBAc2ZrYmlkKSBPUiAoQHNma2JpZCAoQHNmaXN2aXNpYmxlaW5wa2I9XCJ0cnVlXCIpKSIsInVzZXJHcm91cHMiOlsiT2t0YSBIZWxwIENlbnRlciBQcm9maWxlIl0sInY4Ijp0cnVlLCJ0b2tlbklkIjoid2RybjNkN2EycXF3M2JramhnZXRrNWtnZHUiLCJvcmdhbml6YXRpb24iOiJva3RhcHJvZHVjdGlvbjlvdW52Y3hhIiwidXNlcklkcyI6W3sidHlwZSI6IlVzZXIiLCJuYW1lIjoiYW5vbnltb3VzIiwicHJvdmlkZXIiOiJFbWFpbCBTZWN1cml0eSBQcm92aWRlciJ9XSwicm9sZXMiOlsicXVlcnlFeGVjdXRvciJdLCJpc3MiOiJTZWFyY2hBcGkiLCJleHAiOjE3MjUwMjc4MzcsImlhdCI6MTcyNDk0MTQzN30.xqNKRo1QskCJlzR2DpgVIFCD9rixNj4TpNAvWXj6pvw"
                let www_okta = 'eyJhbGciOiJIUzI1NiJ9.eyJmaWx0ZXIiOiIoQHd3d2NvbW1vbmNvbnRlbnR0eXBlIE5PVCBAc2ZrYmlkKSBPUiAoQHNma2JpZCAoQHNmaXN2aXNpYmxlaW5wa2I9XCJ0cnVlXCIpKSIsInVzZXJHcm91cHMiOlsiT2t0YSBHdWVzdCBQcm9maWxlIl0sInNlYXJjaEh1YiI6Ind3dy1va3RhLWNvbSIsInY4Ijp0cnVlLCJ0b2tlbklkIjoicXVrZzRlb2o1aG9ncHEyYWh2cnVsNmNidjQiLCJvcmdhbml6YXRpb24iOiJva3RhcHJvZHVjdGlvbjlvdW52Y3hhIiwidXNlcklkcyI6W3sidHlwZSI6IlVzZXIiLCJuYW1lIjoiYW5vbnltb3VzIiwicHJvdmlkZXIiOiJFbWFpbCBTZWN1cml0eSBQcm92aWRlciJ9XSwicm9sZXMiOlsicXVlcnlFeGVjdXRvciJdLCJpc3MiOiJTZWFyY2hBcGkiLCJleHAiOjE3MjUwNDM3NDMsImlhdCI6MTcyNDk1NzM0M30.sD_YacMKJbs6repBtv9LK5UsvUGNcbF7ueOqyrf4JlA'
                let okta_dev_token = "xxf1de37f5-c8aa-42db-a8ef-0cbf06dfa5e3"


                let okta_token_test = "eyJhbGciOiJIUzI1NiJ9.eyJmaWx0ZXIiOiIoKChAY29tbW9uY29udGVudHR5cGUgTk9UIEBjb21tb25jb250ZW50dHlwZT09KENhc2VzLFBlb3BsZSkpIE9SIChAY29tbW9uY29udGVudHR5cGU9PVBlb3BsZSBAc2ZvaGNhZ3JlZWR0ZXJtc2FuZGNvbmRpdGlvbnNjPXRydWUgQHNmcmVtb3ZlbWVzZWFyY2hjPWZhbHNlKSkgTk9UIEBzZmtiaWQgKChOT1QgQGNvbW1vbmNvbnRlbnR0eXBlPT0oSWRlYXMsRXZlbnRzLEdyb3VwcykpIE9SIChAY29tbW9uY29udGVudHR5cGU9PUV2ZW50cyBAc2ZndWVzdHVzZXJhY2Nlc3NjPT10cnVlKSkpIE9SIChAc2ZrYmlkIChAc2Zpc3Zpc2libGVpbnBrYj1cInRydWVcIikpIiwidXNlckdyb3VwcyI6WyJPa3RhIEhlbHAgQ2VudGVyIFByb2ZpbGUiXSwidjgiOnRydWUsInRva2VuSWQiOiJ2c3hreWZrdDJxaGhzczduMzd0eHZoa2J5ZSIsIm9yZ2FuaXphdGlvbiI6Im9rdGFwcm9kdWN0aW9uOW91bnZjeGEiLCJ1c2VySWRzIjpbeyJ0eXBlIjoiVXNlciIsIm5hbWUiOiJhbm9ueW1vdXMiLCJwcm92aWRlciI6IkVtYWlsIFNlY3VyaXR5IFByb3ZpZGVyIn1dLCJyb2xlcyI6WyJxdWVyeUV4ZWN1dG9yIl0sImlzcyI6IlNlYXJjaEFwaSIsImV4cCI6MTcyNTExMjUyMywiaWF0IjoxNzI1MDI2MTIzfQ.8d6x4eQGEcqCfWsS1El2-7V5MvwotZ1WIsCkMfPWJMw"

                //resolve("eyJhbGciOiJIUzI1NiJ9.eyJmaWx0ZXIiOiIoQGNvbW1vbmNvbnRlbnR0eXBlIE5PVCBAc291cmNlPT0oXCJva3RhLXdlYmZvcnVtXCIpIE5PVCBAc2ZrYmlkIE5PVCBAY29tbW9uY29udGVudHR5cGU9PShJZGVhcyxHcm91cHMpKSBPUiAoQHNma2JpZCAoQHNmaXN2aXNpYmxlaW5wa2I9XCJ0cnVlXCIpKSIsInVzZXJHcm91cHMiOlsiT2t0YSBIZWxwIENlbnRlciBQcm9maWxlIl0sInNlYXJjaEh1YiI6Ik9rdGFDb21tdW5pdHlGdWxsU2VhcmNoIiwidjgiOnRydWUsInRva2VuSWQiOiJxZGg0bHdhNWd2a2Rnc3RvZ3BoZHpjY2R5YSIsIm9yZ2FuaXphdGlvbiI6Im9rdGFwcm9kdWN0aW9uOW91bnZjeGEiLCJ1c2VySWRzIjpbeyJ0eXBlIjoiVXNlciIsIm5hbWUiOiJhbm9ueW1vdXMiLCJwcm92aWRlciI6IkVtYWlsIFNlY3VyaXR5IFByb3ZpZGVyIn1dLCJyb2xlcyI6WyJxdWVyeUV4ZWN1dG9yIl0sImlzcyI6IlNlYXJjaEFwaSIsImV4cCI6MTcyNjc0OTYwOSwiaWF0IjoxNzI2NjYzMjA5fQ.4x5sicYbhHGwdIKr65nYoi8HuAtz0orIbDu44Dpdzv8")
                resolve(okta_dev_token)
                return;

                var MS_IN_A_DAY = 1000 * 60 * 60 * 24;
                var tokenObj = JSON.parse(localStorage.getItem("CoveoSearchToken"));
                var renewTokenNeeded = true;
                if (tokenObj) {
                    var difference = new Date().getTime() - tokenObj.timestamp;
                    var daysDifference = Math.floor(difference / MS_IN_A_DAY);
                    renewTokenNeeded = daysDifference > 0;
                }
                if (!renewTokenNeeded) {
                    resolve(tokenObj.value);
                }
                else {
                    fetch(coveo_token_url, function (response) {
                        var parsedResponse = JSON.parse(response);
                        var token = parsedResponse.token ? parsedResponse.token : parsedResponse;
                        var newTokenObj = { value: token, timestamp: new Date().getTime() };
                        localStorage.setItem("CoveoSearchToken", JSON.stringify(newTokenObj));
                        resolve(newTokenObj.value);
                    });
                }
            });
            tokenPromise.then(function (token) {
                ////////////////
                Coveo.TemplateHelpers.registerTemplateHelper("categoryTag", function(source) {
                    return `<span class="highlight">${source}</span>`;
                });
                ////////////////
                // listeners

                Coveo.$$(document.body).on("newResultDisplayed", function(event, args) {
                    const maxLength = 80;
                    const result = args.result;
                    const resultElement = args.item;
                    const primaryResultLink = resultElement.querySelector(
                        ".is-primary .CoveoResultLink"
                    );
                    const secondaryResultLink = resultElement.querySelector(
                        ".is-secondary .CoveoResultLink"
                    );
                    const source = resultElement.CoveoResult.raw.source;
                    let clickUri = resultElement.CoveoResult.clickUri;
                    let title = result.title;

                    if (!title || !primaryResultLink || !secondaryResultLink) {
                        return;
                    }

                    // Add external link icon to links that are not www.okta.com.
                    if (source !== "okta-developer") {
                        primaryResultLink.classList.add("is-external-link");
                    }

                    // Trim title if over max character limit set above.
                    if (title.length > maxLength) {
                        title = `${title.substring(0, maxLength)} ...`;
                    }

                    // Use the processed title for the anchor text.
                    primaryResultLink.innerHTML = title;

                    // Use the result clickUri for the anchor text.
                    secondaryResultLink.innerHTML = clickUri;

                    // Populate the href attribute.
                    primaryResultLink.href = clickUri;
                    secondaryResultLink.href = clickUri;
                });

                ////////////
                Coveo.SearchEndpoint.configureCloudV2Endpoint(coveo_org_id, token, coveo_rest_uri);
                Coveo.init(document.body, {
                    searchInterfaceConfig: {
                        searchHub1: "okta.help.com",
                        pipeline1: "okta-help-com",
                        enableHistory: true,
                        enableAutomaticResponsiveMode: false,
                        Omnibox: true,
                        Pager: {
                            numberOfPages: 3
                        }
                    }

                });

                var root = document.getElementById("search");
                Coveo.$$(root).on('afterInitialization', function() {
                    Coveo.$$(document.getElementById("search")).on('buildingQuery', function(e, args) {

                        var createQre = function (expression, modifier) {
                            var qre = "";
                            if (expression && modifier) {
                                qre = "$qre(expression:'" + expression + "', modifier:'" + modifier + "')";
                            }
                            return qre;
                        };

                        const queryBuilder = args.queryBuilder;
                        queryBuilder.advancedExpression.add("@filetype=html")
                        queryBuilder.advancedExpression.add("@source=okta-help")
                        queryBuilder.advancedExpression.add("@uri='/en-us/content/'")
                        queryBuilder.numberOfResults = 5
                        queryBuilder.requiredFields =  ['auth_engine, product_category, uri']


                        var qre = createQre("@uri=https://help.okta.com/oag", "100")
                        queryBuilder.advancedExpression.add(qre)

                    })

                    parent.postMessage("coveo_loaded", "*")
                })
            });
        })
    </script>

    <style>
        .coveo-result-cell.header {
            padding-bottom: 20px;
            font-size: 23px;
        }
        .coveo-result-cell.bottom-link {
            padding-top: 20px;
            font-size: 16px;
        }
        .coveo-result-cell.excecrt {
            font-size: 18px;
            .coveo-highlight {
                font-weight: 700;
                color: black;
            }
        }
        .coveo-facet-value-count {
            display: none;
        }
        .coveo-facet-value-caption {
            font-size: 17px;
        }
        .coveo-facet-values {
            padding-bottom: 10px;
            padding-top: 10px;
        }
        .CoveoPager.custom {
            margin-top: 15px;
            .coveo-pager-list-item {
                font-size: 18px;
                margin-right: 10px;
            }
        }
        .coveo-result-cell.custom-product {
            padding-top: 7px;
            .CoveoFieldValue {
                background-color: rgb(240, 240, 240);
                padding: 3px;
                .coveo-clickable {
                    color: black;
                }
            }
        }

    </style>
</head>

<body id="search" class='CoveoSearchInterface' data-enable-history="true" style="height:400px" data-search-page>
    <base target="_parent">
    <div class='coveo-search-section'>
        <div class="CoveoSearchbox" data-enable-omnibox="true" data-enable-query-suggest-addon="true">
        </div>
    </div>

    <div class="coveo-main-section">
        <div class="coveo-facet-column">
            <div class="CoveoFacet custom"
                data-title="Auth Engine"
                data-field="@auth_engine"
                data-tab="All"
                data-enable-facet-search='false'
                data-include-in-omnibox="false"
                data-enable-settings='false'>
            </div>
            <div class="CoveoFacet custom"
                data-title="Products"
                data-field="@product_category"
                data-tab="All"
                data-number-of-values="20"
                data-allowed-values1="Workflows"
                data-enable-facet-search='false'
                data-enable-settings='false'>
            </div>
            <div class="CoveoFacet1"
                data-title="Source"
                data-field="@source"
                data-tab="All"
                data-enable-facet-search='false'
                data-enable-settings='false'>
            </div>
        </div>

        <div class="coveo-results-column">
            <div class="coveo-results-header">
                <div class="coveo-summary-section">
                    <span class="CoveoQuerySummary"></span>
                    <span class="CoveoQueryDuration"></span>
                </div>
                <div class="coveo-result-layout-section">
                    <span class="CoveoResultLayout"></span>
                </div>
            </div>

            <div class="CoveoResultList">
                <script
                    id="Default"
                    class="result-template"
                    type="text/html"
                    data-layout="list"
                >
                    <div class="coveo-result-frame">
                    <div class="coveo-result-cell">
                        <div class="coveo-result-row is-primary">
                        <div class="coveo-result-cell header">
                            <a class="CoveoResultLink"></a>
                        </div>
                        </div>

                        <div class="coveo-result-row">
                            <div class="coveo-result-cell excecrt">
                                <span class="CoveoExcerpt"></span>
                            </div>
                        </div>
                        <div class="coveo-result-row is-secondary">
                        <div class="coveo-result-cell bottom-link">
                            <a class="CoveoResultLink"></a>
                        </div>
                        </div>
                        <div class="coveo-result-cell custom-product">
                            <span class="CoveoFieldValue" data-field="@product_category" data-helper="categoryTag" data-html-value="true"></span>
                        </div>

                    </div>
                    </div>
                </script>
            </div>
            <div class="CoveoPager custom" data-number-of-pages="5"></div>
        </div>
    </div>
</body>
</htm>