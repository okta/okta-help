<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd"
      MadCap:fileTags="Tags/okta-authors.Mark Cowan"
      MadCap:conditions="MultiProdPublish.Classic+OIE">
   <head>
      <link href="../../Resources/TableStyles/standard.css"
            rel="stylesheet"
            MadCap:stylesheetType="table"/>
   </head>
   <body>
      <h1>Office 365 Silent Activation: Old Implementations</h1>
      <div class="noteOkta">
         <img src="../../Resources/Images/assets/Icons/Notes/Help.png"
              class="noteImgFloat"
              title="Info"
              alt="Info"/>
         <p class="noteHeading">Note</p>
         <p class="noteContent">The steps in this topic apply to orgs that implemented the Early Access version of this feature prior to the 2019.09.0 release. If you are implementing this feature for the first time after September 1, 2019 (after 2019.09.0), refer to the instructions in <MadCap:xref href="Apps_O365_Silent_Activation.htm">Office 365 Silent Activation: New Implementation</MadCap:xref>.
			</p>
      </div>
      <p>Okta Office 365 Silent Activation allows for a seamless experience for accessing Microsoft Office. Using Okta as an identity provider, this option enables silent activation for shared workstation or VDI environments. Once your end users have logged into a domain-joined Windows machine, they will be automatically signed into Office 365 applications.</p>
      <p>For more information on how to setup a shared workstation for Microsoft Office 365, refer to <a href="https://docs.microsoft.com/en-us/DeployOffice/overview-of-shared-computer-activation-for-office-365-proplus">Overview of shared computer activation for Microsoft 365 Apps</a> on the Microsoft website.
</p>
      <h2>
                    Prerequisites
                </h2>
      <ul>
         <li>
You have an Active Directory domain (or multiple domains) integrated with your Okta org. For more information on integrating AD domains in Okta, see <MadCap:xref href="../Directory/ad-agent-main.htm">Active Directory integration</MadCap:xref>.</li>
         <li>
            <p>You have permissions in Active Directory to configure a Service Principle Name (SPN). For more information on permissions, see <a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/cc731241(v=ws.11)#delegating-authority-to-modify-spns">Delegating Authority to Modify SPNs</a>.</p>
         </li>
         <li>You will need to create a service account, as described below. For this service account:<ul>
               <li>A domain user account is recommended, for the Okta tenant Kerberos service, instead of a domain admin account as a security best practice.</li>
               <li>To further lock down the account, the <span class="uicontrol">logon to</span> restriction can be turned on with a fictitious host name, and the account can be marked as <span class="uicontrol">Account is sensitive and cannot be delegated</span>. This is also for security reasons.</li>
            </ul>
         </li>
         <li>The user's Active Directory UPN must match the Office 365 UPN. The Office 365 application username can be configured to map any AD attribute. For more details, refer to <a href="https://docs.microsoft.com/en-us/office365/enterprise/prepare-for-directory-synchronization?redirectSourcePath=%252fen-us%252farticle%252fprepare-to-provision-users-through-directory-synchronization-to-office-365-01920974-9e6f-4331-a370-13aea4e82b3e">Prepare for directory synchronization to Microsoft 365</a> on the Microsoft website.</li>
         <li>Verify that all Office 365 end users have valid licenses.</li>
         <li>All end users must be assigned to the Office 365 instance associated with their specific domain.</li>
         <li>Users must be able to reach domain controllers.</li>
      </ul>
      <h2>Limitations</h2>
      <p>The following configurations and restrictions prohibit enablement of Silent Activation for Office 365:</p>
      <ul>
         <li>If a Client Access Policy in Office 365 is set to deny web browsers, it will also block the Silent Activation.</li>
         <li>If your app or Okta sign-on policy requires MFA for web browsers, there will be no MFA when logging in through Silent Activation.</li>
         <li> SWA sign-on is not supported.</li>
      </ul>
      <h2>Supported configurations</h2>
      <ul>
         <li>All versions of Windows currently supported by Microsoft</li>
         <li>
Office 2016 and later</li>
      </ul>
      <h2>
Setup instructions </h2>
      <p>
Okta uses Kerberos authentication to enable Silent Activation for Office 365. Setup for this exchange requires the creation of a new service account, and a unique service principal name (SPN) for the account. </p>
      <h3>
STEP 1: Create a service account and configure an SPN </h3>
      <ol>
         <li>Sign in to a server from which you can access Active Directory Users and Computers. </li>
         <li>
            <p>Create a new account with the following properties:</p>
            <table style="width: 100%;mc-table-style: url('../../Resources/TableStyles/standard.css');"
                   class="TableStyle-standard"
                   cellspacing="0">
               <col class="TableStyle-standard-Column-Column1"/>
               <col class="TableStyle-standard-Column-Column1"/>
               <thead>
                  <tr class="TableStyle-standard-Head-Header1">
                     <th class="TableStyle-standard-HeadF-Column1-Header1">
                        <p>Property</p>
                     </th>
                     <th class="TableStyle-standard-HeadD-Column1-Header1">
                        <p>Value</p>
                     </th>
                  </tr>
               </thead>
               <tbody>
                  <tr class="TableStyle-standard-Body-Body1">
                     <td class="TableStyle-standard-BodyF-Column1-Body1">User logon name</td>
                     <td class="TableStyle-standard-BodyD-Column1-Body1">&lt;username&gt;</td>
                  </tr>
                  <tr class="TableStyle-standard-Body-Body2">
                     <td class="TableStyle-standard-BodyC-Column1-Body2">User logon name (pre-Windows 2000)</td>
                     <td class="TableStyle-standard-BodyA-Column1-Body2">&lt;username&gt; (can be any username)
</td>
                  </tr>
               </tbody>
            </table>
            <div class="noteOkta">
               <img src="../../Resources/Images/assets/Icons/Notes/Help.png"
                    class="noteImgFloat"
                    title="Info"
                    alt="Info"/>
               <p class="noteHeading">Note</p>
               <p class="noteContent">Admin permissions are not required for the service account, but specific permissions are needed to set the SPN, as documented in <a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/cc731241(v=ws.11)">Delegating Authority to Modify SPNs</a> on the Microsoft site.
					</p>
            </div>
         </li>
         <li>
            <p>Create a password and check the <span class="uicontrol">Password never expires</span> box, as shown below:</p>
            <p>
               <img src="../../Resources/Images/O365_SilentAWin2.png" class="thumbnail"/>
            </p>
         </li>
         <li>
            <p>Open a Command Prompt and use the following syntax to configure an SPN for the service account:</p>
         </li>
         <span class="userinput">Setspn -S HTTP/yourorg.kerberos.oktapreview.com &lt;username&gt;</span>
         <p>Where <code>HTTP/yourorg.kerberos.oktapreview.com</code> is the SPN and <code>&lt;username&gt;</code> is the value specified in Step 2 of this section.</p>
         <p>Example:</p>
         <p>
            <img src="../../Resources/Images/Office365/sa-cmd-2.png" class="thumbnail"/>
         </p>
         <li>
            <p>Verify that the SPN is correct by entering the following
text: </p>
         </li>
         <span class="userinput">Setspn -l &lt;username&gt;</span>
         <p>
            <img src="../../Resources/Images/Office365/sa-cmd-1.png" class="thumbnail"/>
         </p>
      </ol>
      <h3>
STEP 2: Deploy registry keys </h3>
      <ol>
         <li>Deploy registry key to client machines. See <MadCap:xref href="../Directory/ad-desktop-sso-main.htm">Active Directory Desktop Single Sign-on</MadCap:xref>.</li>
         <li>Use the following content to create a REG file on the client machine, when deploying registry keys on a single machine:</li>
      </ol>
      <blockquote>
         <p>
            <code>[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Internet Explorer\MAIN\FeatureControl\FEATURE_USE_CNAME_FOR_SPN_KB911149] "winword.exe"=dword:00000001</code>
         </p>
         <p>
            <code>[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Internet Explorer\MAIN\FeatureControl\FEATURE_USE_CNAME_FOR_SPN_KB911149] "powerpnt.exe"=dword:00000001</code>
         </p>
         <p>
            <code>[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Internet Explorer\MAIN\FeatureControl\FEATURE_USE_CNAME_FOR_SPN_KB911149] "outlook.exe"=dword:00000001</code>
         </p>
      </blockquote>
      <h3>STEP 3: Configure your browsers on Windows</h3>
      <p>There are three main steps involved in configuring your browsers on Windows:</p>
      <ol>
         <li>
            <p>Enabling IWA on the browsers</p>
         </li>
         <li>
            <p>Adding Okta as a trusted site to the Local Intranet Zone in Internet Explorer (IE)</p>
         </li>
         <li>
            <p>Creating a GPO to apply these settings across all your client machines</p>
         </li>
      </ol>
      <p>To configure your browsers:</p>
      <ol>
         <li>
            <p style="font-weight: bold;">Enable IWA on the browsers</p>
            <ol style="list-style-type: lower-alpha;">
               <li>
                  <p>In Internet Explorer, select <span class="menucascade">
                        <span class="uicontrol">Tools</span>
                        <span class="uicontrol">Internet Options</span>
                     </span>.
                  </p>
               </li>
               <li>Click the <span class="uicontrol">Advanced</span> tab, scroll down to the <span class="uicontrol">Security</span> settings, and select <span class="uicontrol">Enable Integrated Windows Authentication</span>.
               </li>
               <li>
                  <p>Click <span class="uicontrol">OK.</span>
                  </p>
                  <p>
                     <div class="noteOkta">
                        <img src="../../Resources/Images/assets/Icons/Notes/Help.png"
                             class="noteImgFloat"
                             title="Info"
                             alt="Info"/>
                        <p class="noteHeading">Note</p>
                        <p class="noteContent">Make sure that Internet Explorer can save session cookies (<span class="menucascade">
                              <span class="uicontrol">Internet Options</span>
                              <span class="uicontrol">Privacy</span>
                           </span> tab). If it cannot, neither SSO nor standard sign in can work.</p>
                     </div>
                  </p>
               </li>
            </ol>
         </li>
         <li>
            <p style="font-weight: bold;">Configure the Local Intranet Zone to trust Okta:</p>
            <ol style="list-style-type: lower-alpha;">
               <li>In Internet Explorer, open <span class="menucascade">
                     <span class="uicontrol">Options</span>
                     <span class="uicontrol">Security</span>
                  </span>.
               </li>
               <li>
                  <p>Click <span class="menucascade">
                        <span class="uicontrol">Local Intranet</span>
                        <span class="uicontrol">Sites</span>
                        <span class="uicontrol">Advanced</span>
                     </span> and add the URL for your Okta org as configured in the earlier steps.</p>
                  <p>For example: <code>https://&lt;myorg&gt;.kerberos.okta.com</code>.</p>
               </li>
               <li>Click <span class="uicontrol">Close</span> and <span class="uicontrol">OK</span> on the other configuration options.</li>
            </ol>
         </li>
         <li style="font-weight: bold;">Create a GPO to roll this out to all client machines that will use Silent Activation.</li>
      </ol>
      <h3>STEP 4: Enable Silent Activation
</h3>
      <p>The next step is to enable Agentless Desktop SSO within Okta.</p>
      <ol>
         <li>

From the <span class="wintitle">Administrative Dashboard</span>, hover over the <span class="uicontrol">Security</span> drop-down menu.</li>
         <li>Scroll down and choose <span class="uicontrol">Delegated Authentication.</span>
         </li>
         <li>On the <span class="wintitle">Delegated Authentication</span> page, click the <span class="uicontrol">Active Directory</span> tab.</li>
         <li>
Scroll down to find the <span class="uicontrol">Agentless Desktop SSO</span> section.</li>
         <li>
            <p>Click the <span class="uicontrol">Edit</span> button at the top right corner of the <span class="uicontrol">Agentless Desktop SSO</span> section.</p>
         </li>
         <li>Under <span class="uicontrol">AD Instances</span>, find the instance for which you configured the Service Account Username.</li>
         <li>
            <p>Configure this instance with the following username format:</p>
            <table style="width: 100%;mc-table-style: url('../../Resources/TableStyles/standard.css');"
                   class="TableStyle-standard"
                   cellspacing="0">
               <col class="TableStyle-standard-Column-Column1"/>
               <col class="TableStyle-standard-Column-Column1"/>
               <thead>
                  <tr class="TableStyle-standard-Head-Header1">
                     <th class="TableStyle-standard-HeadF-Column1-Header1">
                        <p>Field</p>
                     </th>
                     <th class="TableStyle-standard-HeadD-Column1-Header1">
                        <p>Value</p>
                     </th>
                  </tr>
               </thead>
               <tbody>
                  <tr class="TableStyle-standard-Body-Body1">
                     <td class="TableStyle-standard-BodyF-Column1-Body1">Desktop SSO</td>
                     <td class="TableStyle-standard-BodyD-Column1-Body1">Enabled
</td>
                  </tr>
                  <tr class="TableStyle-standard-Body-Body2">
                     <td class="TableStyle-standard-BodyF-Column1-Body2">Service Account Username</td>
                     <td class="TableStyle-standard-BodyD-Column1-Body2">
                        <p>&lt;username&gt;</p>
                        <p>Note:This is the Active Directory sign-on name that you created in <span class="uicontrol">STEP 1: Create a service account and configure an SPN</span> , without any domain suffix or Netbios name prefix. It can be the sAMAccountName or the username part of the UPN. These two may be the same string unless the Org admin chose to use different values.</p>
                     </td>
                  </tr>
                  <tr class="TableStyle-standard-Body-Body1">
                     <td class="TableStyle-standard-BodyC-Column1-Body1">Service account password</td>
                     <td class="TableStyle-standard-BodyA-Column1-Body1">Your AD password</td>
                  </tr>
               </tbody>
            </table>
         </li>
         <li>
            <p>Click the <span class="uicontrol">Save</span> button.</p>
         </li>
      </ol>
      <p>Now you can test your Office 365 Silent Activation on an Active Directory joined machine (VDI or shared workstation).</p>
      <h3>STEP 5: Validate Office 365 Silent Activation
</h3>
      <p>Complete the following steps on a machine that has the Office 2016 client installed:</p>
      <ol>
         <li>
Run the Office 365 Client:</li>
         <ol style="list-style-type: lower-alpha;">
            <li>Open an Office 2016 client application such as Microsoft Word.</li>
            <li>
               <p>Validate that you are signed in and that the client is automatically activated.</p>
               <p> You should see a message like the one below:</p>
               <p>
                  <img src="../../Resources/Images/O365_SilentA9.png" class="thumbnail"/>
               </p>
            </li>
         </ol>
         <li>Access the Okta <span class="wintitle">System Log</span> page to check for authentication via Kerberos endpoint.</li>
         <li>From the <span class="wintitle">Administrative Dashboard</span>, hover over the <span class="uicontrol">Reports</span> drop-down menu.</li>
         <li>
            <p>Scroll down and choose <span class="uicontrol">System Log</span>.
            </p>
            <p>From the <span class="wintitle">System Log</span> page, find the event and use the arrow to drill down to
<span class="menucascade">
                  <span class="uicontrol">Event</span>
                  <span class="uicontrol">System</span>
                  <span class="uicontrol">LegacyEventType</span>
               </span>.</p>
            <p> The entry should indicate that the user was authenticated through the Kerberos endpoint.</p>
            <p>
               <img src="../../Resources/Images/O365_SilentA8.png" class="thumbnail"/>
            </p>
         </li>
      </ol>
      <p>Once you have finished validating Silent Activation you have successfully complete the setup.</p>
      <h2 MadCap:conditions="MultiProdPublish.Classic">Related Topics</h2>
      <ul>
         <li>
            <p MadCap:conditions="MultiProdPublish.Classic">
               <MadCap:xref href="../Security/O365_Client-Access-Policies.htm">Office 365 Client Access Policies</MadCap:xref>
            </p>
         </li>
         <li>
            <p MadCap:conditions="MultiProdPublish.Classic">
               <MadCap:xref href="../Security/policies/about-app-signon-policies.htm">Add Sign On policies for applications</MadCap:xref>
            </p>
         </li>
      </ul>
   </body>
</html>
