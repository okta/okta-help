<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:onlyLocalStylesheets="False" MadCap:searchable="True" MadCap:conditions="Primary.review-only" MadCap:fileTags="Tags/okta-authors.Arshabhi Rai">
    <head>
        <link rel="canonical" href="https://help.okta.com/asa/en-us/Content/Topics/Adv_Server_Access/docs/disconnectedmode.htm" /><title>[%=Heading.Level1%] | Okta</title>
        <link href="" rel="stylesheet" type="text/css" />
        <meta name="description" content="Learn about Advanced Server Access Disconnected Mode." />
    </head>
    <body>
        <h1><MadCap:variable name="okta-feature-names.Disconnected Mode" />
        </h1>
        <p class="beta">This is a Beta feature. If you're interested in participating in the Beta or have any questions, contact your Okta sales channel or Customer Service Manager.</p>
        <p><MadCap:variable name="okta-feature-names.Disconnected Mode" /> allows users to connect to open Secure Shell (SSH) sessions to servers when <MadCap:variable name="okta-feature-names.ScaleFT" /> or <MadCap:variable name="okta-variables.ProductName" /> are unavailable. While disconnected from <MadCap:variable name="okta-feature-names.ScaleFT" />, some features may be unavailable (for example, on-demand users). Other features like session logs are still stored at the configured location. For details, see <MadCap:xref href="gateway-configure.htm">Configure an [%=okta-feature-names.ScaleFT%] gateway</MadCap:xref>.</p>
        <ul>
            <li>
                <MadCap:xref href="#Prerequi">Prerequisites</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="#Enable2">Enable [%=okta-feature-names.Disconnected Mode%] on a gateway</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="#Enable">Enable [%=okta-feature-names.Disconnected Mode%] for a group</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="#Project">Project username attribute overrides and [%=okta-feature-names.Disconnected Mode%]</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="#Use2">Use [%=okta-feature-names.Disconnected Mode%] with the [%=okta-feature-names.ScaleFT%] client</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="#Rotate">Rotate a [%=okta-feature-names.Disconnected Mode%] activation key</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="#Use">Gateways and High Availability in [%=okta-feature-names.Disconnected Mode%]</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="#Best">Best practices</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="#Related">Related topics</MadCap:xref>
            </li>
        </ul>
        <h3><a name="Prerequi"></a>Prerequisites</h3>
        <p>You need the following to use <MadCap:variable name="okta-feature-names.Disconnected Mode" /> in your <MadCap:variable name="workflows_connectors.Advanced Server Access" /> team:</p>
        <ul>
            <li>An <MadCap:variable name="workflows_connectors.Advanced Server Access" /> client updated to version 1.54.0 or later.</li>
            <li>An <MadCap:variable name="workflows_connectors.Advanced Server Access" /> gateway updated to version 1.54.0 or later.</li>
            <li MadCap:conditions="Primary.do-not-publish">An <MadCap:variable name="okta-feature-names.ScaleFT" /> gateway that has a label that can be used as a selector by projects to choose the gateway for <MadCap:variable name="okta-feature-names.Disconnected Mode" />. This gateway must not be part of a high availability (HA) group, it must have it own unique access address, and must not be behind a load balancer. See <MadCap:xref href="install-gateway.htm">Install an [%=okta-feature-names.ScaleFT%] gateway</MadCap:xref> and <MadCap:xref href="#Enable2">Enable [%=okta-feature-names.Disconnected Mode%] on a gateway</MadCap:xref>.</li>
            <li>An <MadCap:variable name="okta-feature-names.ScaleFT" /> gateway that has a label that can be used as a selector by projects to choose the gateway for <MadCap:variable name="okta-feature-names.Disconnected Mode" />. This gateway must have it own unique access address. See <MadCap:xref href="install-gateway.htm">Install an [%=okta-feature-names.ScaleFT%] gateway</MadCap:xref> and <MadCap:xref href="#Enable2">Enable [%=okta-feature-names.Disconnected Mode%] on a gateway</MadCap:xref>.
				<div class="noteOkta"><p class="noteContent">For Disconnected Mode, we recommend configuring and using gateways that aren't behind a load balancer in a high availability (HA)&#160;group. This is because if your only connection to a gateway is through the load balancer, it's difficult to ensure that <MadCap:variable name="okta-feature-names.Disconnected Mode" /> is activated for each gateway in the HA&#160;group. See <MadCap:xref href="#Use">Gateways and High Availability in [%=okta-feature-names.Disconnected Mode%]</MadCap:xref>.</p></div></li>
            <li>One or more <MadCap:variable name="okta-feature-names.ScaleFT" /> groups with at least one user. Each group must configure <MadCap:variable name="okta-feature-names.Disconnected Mode" />. See <MadCap:xref href="#Enable">Enable [%=okta-feature-names.Disconnected Mode%] for a group</MadCap:xref> and <MadCap:xref href="policysync.htm#addSelect">Add a server selector to a project group</MadCap:xref>.
				<div class="noteOkta"><p class="noteContent">Groups that have <MadCap:variable name="okta-feature-names.Disconnected Mode" /> enabled can't be added to a project if the groups use a server selector.</p></div></li>
            <li>A project that includes both gateways and groups configured for use in <MadCap:variable name="okta-feature-names.Disconnected Mode" />.</li>
            <li>A record of the IP addresses used to access the gateway and any servers within the <MadCap:variable name="okta-feature-names.Disconnected Mode" /> project.<div class="noteOkta"><p class="noteContent">You must use an IP&#160;address instead of a hostname when connecting to servers in <MadCap:variable name="okta-feature-names.Disconnected Mode" />.</p></div></li>
        </ul>
        <div class="note_cautionOkta">
            <img src="../../../Resources/Images/assets/Icons/Notes/Alert.png" class="noteImgFloat" title="Caution" alt="Caution" />
            <p class="noteContent"><MadCap:variable name="okta-feature-names.Disconnected Mode" /> uses the r<MadCap:annotation MadCap:createDate="2022-04-14T09:06:42.2107823-04:00" MadCap:creator="Isaac" MadCap:initials="ID" MadCap:comment="Confirm this with the CA service changes from Apr. 2022" MadCap:editor="Isaac" MadCap:editDate="2022-04-14T09:06:52.8687092-04:00">sa-sha2-256 algorithm, while standard <MadCap:variable name="okta-feature-names.ScaleFT" /> uses ssh-rsa</MadCap:annotation>. To use <MadCap:variable name="okta-feature-names.ScaleFT" /> in both modes, you must configure your servers and bastions  to allow certificate authorities (CAs) to use both algorithms.</p>
            <p class="noteContent">OpenSSH 8.2 or later includes rsa-sha2-256 by default, but doesn't include ssh-rsa. To enable ssh-rsa for a server or bastion that's running OpenSSH 8.2 or later (for example, servers running Ubuntu 20.04 or later), add the following line to the OpenSSH daemon file (which is either <span class="code">/etc/ssh/sshd_config</span> or a drop-in file under <span class="code">/etc/ssh/sshd_config.d/</span>):<span class="code">CASignatureAlgorithms +ssh-rsa</span>.</p>
        </div>
        <h2><a name="Enable2"></a>Enable <MadCap:variable name="okta-feature-names.Disconnected Mode" /> on a gateway</h2>
        <MadCap:snippetBlock src="../snippets/norm-op.flsnp" />
        <ol>
            <li>
                <p>Edit your gateway configuration file (<span class="code">/etc/sft/sft-gatewayd.yaml</span>).</p>
            </li>
            <li>
                <p>Add the following option:</p>
                <span class="codeblock">Beta:
&#160;&#160;DisconnectedMode: true</span>
            </li>
            <li>Save the configuration file.</li>
            <li>
                <p>Restart the gateway. See <MadCap:xref href="gateway-manage.htm">Manage the [%=okta-feature-names.ScaleFT%] gateway</MadCap:xref>.</p>
            </li>
        </ol>
        <p>To verify if <MadCap:variable name="okta-feature-names.Disconnected Mode" /> was successfully enabled, check the sft-gatewayd log for an <span class="code">Starting Disconnected Mode service</span> entry.</p>
        <h2><a name="Enable"></a>Enable <MadCap:variable name="okta-feature-names.Disconnected Mode" /> for a group</h2>
        <MadCap:snippetBlock src="../snippets/norm-op.flsnp" />
        <ol>
            <li>
                <p>On the <MadCap:variable name="okta-feature-names.ScaleFT" /> dashboard, click <span class="uicontrol">Groups</span>.</p>
            </li>
            <li>
                <p>Click the gear <img src="../../../Resources/Images/asa/icon-gear.png" /> beside the group and select <span class="uicontrol">Configure <MadCap:variable name="okta-feature-names.Disconnected Mode" style="font-weight: normal;" /></span>.</p>
                <div class="noteOkta">
                    <p class="noteContent"><MadCap:variable name="okta-feature-names.Disconnected Mode" /> can't be enabled for groups that contain project attribute overrides. See <MadCap:xref href="#Project">Project username attribute overrides and [%=okta-feature-names.Disconnected Mode%]</MadCap:xref></p>
                </div>
            </li>
            <li>
                <p>Click <span class="uicontrol">Generate Key</span>.</p>
            </li>
            <li>
                <p>Click <span class="uicontrol">Download</span> to download and save the activation key.  </p>
            </li>
        </ol>
        <div class="note_cautionOkta">
            <img src="../../../Resources/Images/assets/Icons/Notes/Alert.png" class="noteImgFloat" title="Caution" alt="Caution" />
            <p class="noteContent">This key is secret and extremely sensitive, ensure that it is stored in a secure location accessible only to team members authorized to activate <MadCap:variable name="okta-feature-names.Disconnected Mode" />.</p>
        </div>
        <h2><a name="Project"></a>Project username attribute overrides and <MadCap:variable name="okta-feature-names.Disconnected Mode" /></h2>
        <p>Project username attribute overrides can't be used on projects that have groups with <MadCap:variable name="okta-feature-names.Disconnected Mode" /> enabled.</p>
        <p>Enabling <MadCap:variable name="okta-feature-names.Disconnected Mode" /> for a group will fail if there are any project username attribute overrides configured for any user in the project. After a group that has <MadCap:variable name="okta-feature-names.Disconnected Mode" /> enabled has been assigned to a project, you won't be able to add project attribute overrides. </p>
        <p>To use project username attribute overrides, you must either remove any groups from the project that have <MadCap:variable name="okta-feature-names.Disconnected Mode" /> enabled, or disable <MadCap:variable name="okta-feature-names.Disconnected Mode" /> for all groups that are assigned to the project. See <MadCap:xref href="set-project-level-attributes-in-adv-server-access.htm">Set project-level attributes overrides</MadCap:xref>.</p>
        <h2><a name="Use2"></a>Use <MadCap:variable name="okta-feature-names.Disconnected Mode" /> with the <MadCap:variable name="okta-feature-names.ScaleFT" /> client</h2>
        <div class="note_cautionOkta">
            <img src="../../../Resources/Images/assets/Icons/Notes/Alert.png" class="noteImgFloat" title="Caution" alt="Caution" />
            <p class="noteContent">This section details the steps to activate <MadCap:variable name="okta-feature-names.Disconnected Mode" /> if <MadCap:variable name="okta-variables.ProductName" /> or <MadCap:variable name="okta-feature-names.ScaleFT" /> are unavailable and you need to access your servers.</p>
        </div>
        <p>The following are the basic commands to execute in the client to use <MadCap:variable name="okta-feature-names.Disconnected Mode" />. See <MadCap:xref href="client.htm">Use the [%=okta-feature-names.ScaleFT%] client</MadCap:xref> for a complete list of available commands.</p>
        <div class="noteOkta">
            <p class="noteContent">You're granted a set of credentials each time you log in to <MadCap:variable name="okta-feature-names.ScaleFT" />. The offline credentials are valid for seven days from the time of login. To use a client with a team in <MadCap:variable name="okta-feature-names.Disconnected Mode" />,  you must have either logged in to that team (using <span class="code">sft login</span>) or performed a command on that team using the client within the seven day time period.</p>
        </div>
        <div class="noteOkta">
            <p class="noteContent">If your client isn't enrolled with the team, you must enroll the client before you can log in. See <MadCap:xref href="enroll-clients.htm">Enroll a client</MadCap:xref>.</p>
        </div>
        <h3>Activate <MadCap:variable name="okta-feature-names.Disconnected Mode" /> for a group and connect to a server</h3>
        <div class="noteOkta">
            <p class="noteContent">Anyone with the activation key is able to activate <MadCap:variable name="okta-feature-names.Disconnected Mode" />.</p>
        </div>
        <div class="noteOkta">
            <p class="noteContent">When <MadCap:variable name="okta-feature-names.Disconnected Mode" /> is active for a group on a gateway, only members of the group can use <MadCap:variable name="okta-feature-names.Disconnected Mode" /> to access that group's resources through the gateway.</p>
        </div>
        <ol>
            <li>
                <p>Configure your client to enable <MadCap:variable name="okta-feature-names.Disconnected Mode" /> by setting the environment variable <span class="code">SFT_DISCONNECTED_MODE_BETA</span> as follows:</p>
                <p> <span class="code">SFT_DISCONNECTED_MODE_BETA=1</span></p>
                <p>Alternatively, you can set the environment variable in your shell configuration. For example, if you use the Bash shell, then you could add the following to your <span class="code">.bash_profile</span> file:</p>
                <p> <span class="code">export SFT_DISCONNECTED_MODE_BETA=1</span></p>
                <p>To set environment variables using other shells or environments, refer to their documentation.</p>
            </li>
            <li>
                <p>Activate <MadCap:variable name="okta-feature-names.Disconnected Mode" /> for a group that has <MadCap:variable name="okta-feature-names.Disconnected Mode" /> enabled (for example, dm_group), passing the activation key that you downloaded as the <span class="code">secret-file</span> argument:</p>
                <p> <span class="code">sft dm activate --group dm_group --gateway 192.168.128.5:7234 --secret-file dm_group_2021-06-28.pem</span></p>
                <div class="noteOkta">
                    <p class="noteContent">When you activate Disconnected Mode for a group, it only affects the specific gateway for that group, regardless of how many gateways belong to the team or project.</p>
                </div>
                <div class="noteOkta">
                    <p class="noteContent">It may take up to ten hours to gain access to the Disconnected Mode group. To force immediate access, sign out and sign back in to the <MadCap:variable name="okta-feature-names.ScaleFT" /> client.</p>
                </div>
            </li>
            <li>
                <p>Members of the group can now use the client in <MadCap:variable name="okta-feature-names.Disconnected Mode" /> to connect to servers in that group using ssh, passing the IP&#160;addresses of the server and that of the gateway, as in the following example:</p>
                <p> <span class="code">sft dm ssh --group dm_group --gateway 192.168.128.5:7234 191.168.0.1</span></p>
            </li>
        </ol>
        <h3>Deactivate <MadCap:variable name="okta-feature-names.Disconnected Mode" /> for a group</h3>
        <div class="noteOkta">
            <p class="noteContent">When <MadCap:variable name="okta-feature-names.Disconnected Mode" /> is active for a group, only members of that group can deactivate <MadCap:variable name="okta-feature-names.Disconnected Mode" /> for that group.</p>
        </div>
        <p><span class="code">sft dm deactivate --group dm_group --gateway 192.168.128.5:7234</span></p>
        <h3>Set a default group to use with <MadCap:variable name="okta-feature-names.Disconnected Mode" /></h3>
        <p>You can set a default group to use with <MadCap:variable name="okta-feature-names.Disconnected Mode" /> commands. For example, to set <span class="code">dm_group</span> as the default group use the command:</p>
        <p> <span class="code">sft dm set-default --group dm_group --gateway 192.168.128.5:7234</span></p>
        <p>When a <MadCap:variable name="okta-feature-names.Disconnected Mode" /> command is entered without specifying a group, <MadCap:variable name="okta-feature-names.ScaleFT" /> will attempt to use the default group set using <span class="code">sft dm set-default</span>, if one exists.</p>
        <h2><a name="Rotate"></a>Rotate a <MadCap:variable name="okta-feature-names.Disconnected Mode" /> activation key</h2>
        <p>If a <MadCap:variable name="okta-feature-names.Disconnected Mode" /> activation key for a group has been lost or compromised, an <MadCap:variable name="okta-feature-names.ScaleFT" /> administrator can rotate the key from the dashboard by performing the following steps:</p>
        <ol>
            <li>
                <p>On the Advanced Server Access dashboard, click <span class="uicontrol">Groups</span>.</p>
            </li>
            <li>
                <p>Click the group.</p>
            </li>
            <li>
                <p>Click <span class="uicontrol">Rotate Key</span>. The <span class="uicontrol">Rotate Key</span> dialog appears.</p>
            </li>
            <li>
                <p>Click <span class="uicontrol">Rotate Key</span>.</p>
            </li>
            <li>
                <p>Click <span class="uicontrol">Download</span> to download and save the activation key.  </p>
            </li>
        </ol>
        <h2><a name="Use"></a>Gateways and High Availability in <MadCap:variable name="okta-feature-names.Disconnected Mode" /></h2>
        <p>To access gateways that are in a high availability (HA)&#160;group behind a load balancer when <MadCap:variable name="okta-feature-names.ScaleFT" /> is in <MadCap:variable name="okta-feature-names.Disconnected Mode" /> requires that you activate <MadCap:variable name="okta-feature-names.Disconnected Mode" /> on each gateway in the group.</p>
        <p>For example, suppose you have a high availability group, HA, that contains three gateways (GatewayA, GatewayB, and GatewayC) located behind a load balancer. The  configuration file for each gateway configures the AccessAddress to use the load balancer's public IP&#160;address.</p>
        <p>If you assigned a public IP&#160;address to each gateway, then you can activate <MadCap:variable name="okta-feature-names.Disconnected Mode" /> on each gateway by using sft dm activate as follows: </p>
        <p><span class="code">sft dm activate --group dm_group --gateway &lt;GatewayA public IP&#160;address&gt;:7234 --secret-file dm_group_2021-06-28.pem</span></p>
        <p> <span class="code">sft dm activate --group dm_group --gateway &lt;GatewayB public IP&#160;address&gt;:7234 --secret-file dm_group_2021-06-28.pem</span></p>
        <p> <span class="code">sft dm activate --group dm_group --gateway &lt;GatewayC public IP&#160;address&gt;:7234 --secret-file dm_group_2021-06-28.pem</span></p>
        <p>Alternatively, you can run <span class="code">sft dm activate</span> using the public IP&#160;address of the load balancer until <MadCap:variable name="okta-feature-names.Disconnected Mode" /> has been activated for every gateway in the group as follows:</p>
        <p> <span class="code">sft dm activate --group dm_group --gateway &lt;AccessAddress&gt;:7234 --secret-file dm_group_2021-06-28.pem</span></p>
        <div class="note_cautionOkta">
            <img src="../../../Resources/Images/assets/Icons/Notes/Alert.png" class="noteImgFloat" title="Caution" alt="Caution" />
            <p class="noteContent">If you choose to use <MadCap:variable name="okta-feature-names.Disconnected Mode" /> with gateways in a high availability group, you must ensure that you deactivate <MadCap:variable name="okta-feature-names.Disconnected Mode" /> for every gateway once normal service is restored.</p>
        </div>
        <p>As an alternative to only using gateways in a high availability group, you might also have an additional gateway, GatewayD, that's not part of HA, but has the same label that's used as a project selector for the gateways in the group.</p>
        <p>While GatewayD doesn't have the benefits of shared address load balancing that's used by the HA&#160;gateways, it does regularly communicate with <MadCap:variable name="okta-feature-names.ScaleFT" />. If <MadCap:variable name="okta-feature-names.ScaleFT" /> fails to hear from GatewayD within five minutes, then the standard behavior of switching to a healthy gateway is followed. </p>
        <p>This approach simplifies activating <MadCap:variable name="okta-feature-names.Disconnected Mode" /> since only GatewayD needs to be activated, and there's no need to expose additional IP addresses. All of the gateways will be used for normal traffic, but GatewayD is solely responsible for <MadCap:variable name="okta-feature-names.Disconnected Mode" /> traffic. If you want further redundancy when using <MadCap:variable name="okta-feature-names.Disconnected Mode" />, you can add additional gateways that aren't behind a load balancer, similar to GatewayD, and activate them when necessary.</p>
        <h2><a name="Best"></a>Best practices</h2>
        <p>The following are the best practices to follow when using <MadCap:variable name="okta-feature-names.Disconnected Mode" />:</p>
        <ul>
            <li>
                <p>Make sure all activate keys are stored securely.</p>
            </li>
            <li>
                <p>If an activation key is lost or compromised, rotate the key.</p>
            </li>
            <li>
                <p>Maintain internal documentation detailing how to activate <MadCap:variable name="okta-feature-names.Disconnected Mode" /> for your team. Generally, try to include information like:</p>
                <ul>
                    <li>
                        <p>A list of users authorized to access the activation key.</p>
                    </li>
                    <li>
                        <p>The process of requesting activation of <MadCap:variable name="okta-feature-names.Disconnected Mode" /> for a project.</p>
                    </li>
                    <li>
                        <p>Any specific notes unique to your organizational configuration.</p>
                    </li>
                </ul>
            </li>
            <li>
                <p>The list of <MadCap:variable name="okta-feature-names.Disconnected Mode" /> groups available to a client updates when the client access token refreshes. Clients can force a refresh, by logging out and logging back in to <MadCap:variable name="okta-feature-names.ScaleFT" />.</p>
            </li>
            <li>
                <p>Periodically test that <MadCap:variable name="okta-feature-names.Disconnected Mode" /> works as expected for your team. Do this by activating <MadCap:variable name="okta-feature-names.Disconnected Mode" /> for one or more groups, have users who belong to those groups connect to servers in those groups using the client's <MadCap:variable name="okta-feature-names.Disconnected Mode" />, and deactivating <MadCap:variable name="okta-feature-names.Disconnected Mode" />. Perform this testing while <MadCap:variable name="okta-feature-names.ScaleFT" /> and <MadCap:variable name="okta-variables.ProductName" /> are both available.</p>
            </li>
        </ul>
        <h3><a name="Logical"></a>
        </h3>
        <h2><a name="Related"></a>Related topics</h2>
        <p>
            <MadCap:xref href="manage-groups-and-projects.htm">Manage groups and projects</MadCap:xref>
        </p>
        <p>
            <MadCap:xref href="user-attributes.htm">[%=okta-feature-names.ScaleFT%] attributes</MadCap:xref>
        </p>
        <p>
            <MadCap:xref href="client.htm">Use the [%=okta-feature-names.ScaleFT%] client</MadCap:xref>
        </p>
    </body>
</html>