<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd"
      MadCap:onlyLocalStylesheets="False"
      MadCap:searchable="True"
      MadCap:fileTags="Tags/okta-authors.Arshabhi Rai">
   <head>
      <title>[%=Heading.Level1%] | Okta</title>
      <link href="" rel="stylesheet" type="text/css"/>
      <meta name="description"
            content="Explains how to create a certificate for use with an AD domain."/>
   </head>
   <body>
      <div MadCap:conditions="MultiProdPublish.PYPContent">
         <h1>Create a certificate with a certificate signing request</h1>
         <p>A certificate signing request (CSR) includes information needed to create a subordinate Certificate Authority (CA) within an <MadCap:variable name="3rd Party Integrations.AD"/> domain. </p>
         <p>Teams must create the CSR in <MadCap:variable name="okta-feature-names.ScaleFT"/> and sign it with an <MadCap:variable name="3rd Party Integrations.AD"/> domain. Teams can then upload the signed certificate to <MadCap:variable name="okta-feature-names.ScaleFT"/> and associate the certificate with one or more Active Directory connections. Some of the following steps can differ depending on your specific Active Directory environment.</p>
         <div>
            <h3>Before you begin</h3>
            <ul>
               <li>Install Active Directory Certificate Services as a root CA for the domain. See <a href="https://docs.microsoft.com/en-us/windows-server/networking/core-network-guide/cncg/server-certs/install-the-certification-authority"
                     target="_blank">Install the Certification Authority</a>.</li>
            </ul>
         </div>
         <h3>Start this task</h3>
         <ol>
            <li>Create a CSR in <MadCap:variable name="okta-feature-names.ScaleFT"/>.
                    <ol style="list-style-type: lower-alpha;">
                  <li>Open the <MadCap:variable name="okta-feature-names.ScaleFT"/> dashboard.</li>
                  <li>In the user menu, click <span class="uicontrol">Team Settings</span>.</li>
                  <li>Go to the <span class="uicontrol">Passwordless Certificates</span> tab. </li>
                  <li>Click <span class="menucascade">
                        <span class="uicontrol">Create</span>
                        <span class="uicontrol">Certificate Signing Request</span>
                     </span>.</li>
                  <li>In the Create Certificate Signing Request window, configure the certificate settings.</li>
                  <li>Click <span class="uicontrol">Create Certificate Signing Request</span>. <p>Your device downloads the CSR.  Move this file to an <MadCap:variable name="3rd Party Integrations.AD"/> domain controller.</p>
                  </li>
               </ol>
            </li>
            <li>Create a certificate template on an Active Directory Certificate Services (CS) server. <ol style="list-style-type: lower-alpha;">
                  <li>Open the <span class="uicontrol">Certification Authority</span>.</li>
                  <li>Right-click <span class="uicontrol">Certificate Templates</span> and select <span class="uicontrol">Manage</span>. The <span class="wintitle">Certificate Templates Console</span> window opens.</li>
                  <li>Right-click <span class="uicontrol">Subordinate Certification Authority</span> and select <span class="uicontrol">Duplicate Template</span>. A properties window opens.<br/>
                  </li>
                  <li>In the General tab, under Template Display Name, enter <span class="userinput">ADPasswordless</span>.</li>
                  <li>In the Extensions tab, select <span class="uicontrol">Application Policy</span> and then click <span class="uicontrol">Edit</span>. The <span class="wintitle">Edit Application Policies Extension</span> window opens.</li>
                  <li>Click <span class="uicontrol">Add</span>. The <span class="wintitle">Add Application Policy</span> window opens.</li>
                  <li>Select <span class="uicontrol">Smart Card Logon</span> and <span class="uicontrol">Client Authentication</span>, then click <span class="uicontrol">OK</span>.</li>
                  <li>In the <span class="wintitle">Edit Application Policies Extension</span> window, click <span class="uicontrol">OK</span>.</li>
               </ol>
            </li>
            <li>Issue a certificate.
               <ol style="list-style-type: lower-alpha;">
                  <li>Return to the <span class="uicontrol">Certification Authority</span>.</li>
                  <li>Right-click <span class="uicontrol">Certificate Templates</span> and go to <span class="menucascade">
                        <span class="uicontrol">New</span>
                        <span class="uicontrol">Certificate Template to Issue</span>
                     </span>.</li>
                  <li>From the <span class="wintitle">Enable Certificate Templates</span> window, select the certificate template you created and click <span class="uicontrol">OK</span>.</li>
                  <li>Open a command prompt as an administrator.</li>
                  <li>Go to the directory where you stored the CSR and enter the following command:<p>
                        <span class="codeblock">certreq -attrib "CertificateTemplate:ADPasswordless" -submit "YOUR_TEAM_CSR" "YOUR_SAVED_CERT"</span>
                     </p>
                  </li>
                  <li>From the confirmation window, select the related CA and click <span class="uicontrol">OK</span>.<br/>The Active Directory CS service issues a certificate and saves a certificate file with Base-64 encoding.</li>
               </ol>
            </li>
            <li>Import the certificate to the <span class="uicontrol">Trusted Root Certification Authorities</span> store.<ol style="list-style-type: lower-alpha;">
                  <li>Double-click the issued certificate.</li>
                  <li>From the certificate window, click <span class="uicontrol">Install Certificate</span>.</li>
                  <li>From the <span class="wintitle">Certificate Import Wizard</span> window, click <span class="uicontrol">Next</span>.</li>
                  <li>Select <span class="uicontrol">Place all certificates in the following store</span> and click <span class="uicontrol">Browse</span>.</li>
                  <li>From the browse window, select <span class="uicontrol">Trusted Root Certification Authorities</span> and click <span class="uicontrol">OK</span>.</li>
                  <li>Click <span class="uicontrol">Next</span>.</li>
                  <li>Review the information and click <span class="uicontrol">Finish</span>.<p>
                        <MadCap:variable name="3rd Party Integrations.AD"/> imports the certificate.</p>
                  </li>
               </ol>
            </li>
            <li>Import the certificate into Active Directory. <ol style="list-style-type: lower-alpha;">
                  <li>In a command prompt, go to the directory where you stored the certificate. </li>
                  <li>Add the certificate to the registry.<p>
                        <span class="codeblock" xml:space="preserve">certutil -enterprise -addstore NTAuth SIGNED_CERT.crt</span>
                     </p>
                  </li>
               </ol>
            </li>
            <li>
               <p>Optional. This step is for troubleshooting purposes only.</p>
               <ul>
                  <li>
                     <p>View the NTAuth store.</p>
                     <p>
                        <span class="codeblock">certutil -enterprise -viewstore NTAuth</span>
                     </p>
                  </li>
                  <li>
                     <p>Remove a certificate from the NTAuth store.</p>
                     <p>
                        <span class="codeblock">certutil -enterprise -viewdelstore NTAuth</span>
                     </p>
                  </li>
               </ul>
            </li>
            <li>Upload the signed certificate to <MadCap:variable name="okta-feature-names.ScaleFT"/>.<ol style="list-style-type: lower-alpha;">
                  <li>Return to the <span class="uicontrol">Passwordless Certificates</span> tab in <MadCap:variable name="okta-feature-names.ScaleFT"/> dashboard.</li>
                  <li>Identify the created certificate record.</li>
                  <li>Click <img src="../../../Resources/Images/asa/icon-gear.png" alt="gear icon"/> &gt; <span class="uicontrol">Upload certificate</span>.</li>
                  <li>In the Upload Certificate window, click <span class="uicontrol">Browse files</span>.</li>
                  <li>In the file explorer window, locate the issued certificate file.</li>
                  <li>In the Upload Certificate window, click <span class="uicontrol">Upload</span>.</li>
               </ol>
            </li>
         </ol>
         <p>After you upload the certificate, <MadCap:variable name="okta-feature-names.ScaleFT"/> checks the validity of the certificate file. If the certificate is valid, teams can add the certificate to new or existing <MadCap:variable name="3rd Party Integrations.AD"/> connections. Teams must still distribute the certificate to domain controllers and member servers using a group policy.</p>
         <h3>Next Steps</h3>
         <ul>
            <li>
               <MadCap:xref href="ad-certs-policy.htm">Configure group policies for Active Directory servers</MadCap:xref>
            </li>
            <li>
               <MadCap:xref href="ad-certs-add.htm">Add a certificate to an Active Directory connection</MadCap:xref>
            </li>
         </ul>
      </div>
   </body>
</html>
