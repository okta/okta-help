<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:onlyLocalStylesheets="False" MadCap:fileTags="Tags/okta-authors.Arshabhi Rai">
    <head>
        <link rel="canonical" href="https://help.okta.com/asa/en-us/Content/Topics/Adv_Server_Access/docs/gcp-ubuntu-terraform-token.htm" />
        <link href="../../../Resources/TableStyles/standard.css" rel="stylesheet" MadCap:stylesheetType="table" /><title>[%=Heading.Level1%] | Okta</title>
        <link href="" rel="stylesheet" type="text/css" />
        <meta name="description" content="Deploy Advanced Server Access to Ubuntu/Debian GCP instances using Terraform and an enrollment token." />
    </head>
    <body>
        <h1>
            <MadCap:annotation MadCap:createDate="2022-08-11T13:05:41.6822500-04:00" MadCap:creator="Isaac" MadCap:initials="ID" MadCap:comment="Aug 11, 2022: Hidden from ToC\r\nSafe to remove if no updates by March 2023" MadCap:editor="Isaac" MadCap:editDate="2022-08-11T13:05:42.3928899-04:00">Deploy </MadCap:annotation>a GCP server with Terraform</h1>
        <p>This topic explains how to deploy an&#160;Ubuntu or Debian Google Cloud Platform (GCP)  Server with systemd using Terraform.  You may need to modify this process to fit your specific needs.</p>
        <p>Creating a cloud server with Terraform means installing the Terraform tool on your personal machine and using an Access ID,&#160;enrollment token, and secret ID&#160;to create servers on the GCP console.&#160;After being created, your new servers should appear automatically within the <MadCap:variable name="okta-feature-names.ScaleFT" /> dashboard</p>
        <div class="noteOkta">
            <p class="noteContent">This topic uses the ScaleFT Starter Kit as its Terraform module. <a href="https://github.com/ScaleFT/StarterKit/tree/master/AWS/ubuntu-behind-bastion">View the kit on GitHub</a>. For your setup, use your company's Terraform repository for your production environment. The configuration values in your <span class="code">terraform.tfvars</span> file should be similar to those outlined later in this topic.</p>
        </div>
        <ul>
            <li>
                <MadCap:xref href="#Prerequi">Prerequisites</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="#Create">Download and install Terraform</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="#Token">Create an [%=okta-feature-names.ScaleFT%] enrollment token</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="#Enroll">Create  and save your GCP project ID</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="#Configure">Create and configure your Terraform.tfvars file</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="#Enable">Enable the Google Compute&#160;Engine API&#160;for your project</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="#Run">Run Terraform commands to create your server </MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="#Next">Next steps</MadCap:xref>
            </li>
        </ul>
        <h2><a name="Prerequi"></a>Prerequisites</h2>
        <MadCap:snippetBlock src="../snippets/cloud-req-gcp.flsnp" />
        <MadCap:snippetBlock src="../snippets/cloud-req-asa.flsnp" />
        <h2><a name="Create"></a>Download and install Terraform</h2>
        <ol>
            <li>Download the Terraform installer. See the <a href="https://www.terraform.io/downloads" target="_blank">Terraform website</a>.                </li>
            <li>Unzip the downloaded file and run the unix executable.</li>
        </ol>
        <h2><a name="Token"></a>Create an <MadCap:variable name="okta-feature-names.ScaleFT" /> enrollment token</h2>
        <MadCap:snippetBlock src="../snippets/cloud-create-token.flsnp" />
        <h2><a name="Enroll"></a>Create a GCP project</h2>
        <MadCap:snippetBlock src="../snippets/cloud-create-gcp.flsnp" />
        <h2><a name="Configure"></a>Create and configure your Terraform.tfvars file</h2>
        <ol>
            <li>Create a file named <span class="code">terraform.tfvars</span> and add the following text:
                    <span class="codeblock">project: "&lt;project-id&gt;"
enrollment_token:"&lt;enrollment-token&gt;"</span></li>
            <li>Replace <span class="code">&lt;project-id&gt;</span> with your GCP project ID.</li>
            <li>Replace <span class="code">&lt;enrollment-token&gt;</span> with your <MadCap:variable name="okta-feature-names.ScaleFT" /> enrollment token.</li>
            <li>Save the file and place it in your Terraform module.</li>
        </ol>
        <h2><a name="Enable"></a>Enable the Google Compute&#160;Engine API&#160;for your project</h2>
        <ol>
            <li>Navigate to your project's dashboard in the Google Cloud Platform console.</li>
            <li>In the left sidebar, use the <span class="uicontrol">APIs &amp;&#160;Services</span> tab to click the <span class="uicontrol">Dashboard</span> option. </li>
            <li>Click <span class="uicontrol">ENABLE&#160;APIS&#160;AND SERVICES</span> under the search bar to navigate to the API&#160;Library.</li>
            <li>Under <span class="uicontrol">Category</span> on the left side of the page, click <span class="uicontrol">Compute</span>.</li>
            <li>Select the tab for <span class="uicontrol">Compute Engine API</span>. </li>
            <li>Click <span class="uicontrol">Enable</span>.</li>
        </ol>
        <h2><a name="Run"></a>Run Terraform commands to create your server </h2>
        <ol>
            <li>In your machine's console, run <span class="code">which terraform</span> to confirm that your Terraform path exists.
                <p>Depending on your platform, the output should look something like: <code style="font-weight: normal;">/users/user/bin/terraform</code></p></li>
            <li>Confirm that you are in your Terraform module, then run <span class="code">terraform init</span></li>
            <li>Confirm that the information in <span class="code">terraform.tfvars</span> is correct by running <span class="code">terraform plan</span>.
                If you receive any errors, troubleshoot as needed before proceeding.</li>
            <li>Run <span class="code">terraform apply</span> to begin creating your servers.<br />Enter <span class="code">yes</span> if prompted for approval.</li>
        </ol>
        <p>Confirm that your new servers are listed in <MadCap:variable name="okta-feature-names.ScaleFT" /> before you attempt to connect to them. </p>
        <h2><a name="Next"></a>Next steps</h2>
        <p>
            <MadCap:xref href="verify-server-enrolled.htm">Verify server enrollment</MadCap:xref>
        </p>
    </body>
</html>