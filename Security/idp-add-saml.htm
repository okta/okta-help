<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:onlyLocalStylesheets="False" MadCap:searchable="True" MadCap:fileTags="Tags/okta-authors.Graham Smith" MadCap:conditions="MultiProdPublish.Classic+OIE">
    <head>
        <link href="../../Resources/TableStyles/standard-horizonal-borders-only.css" rel="stylesheet" MadCap:stylesheetType="table" /><title>[%=Heading.Level1%]</title>
        <link href="" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <h1>Add a SAML&#160;Identity Provider</h1>
        <p>Adding a SAML&#160;Identity Provider (IdP)&#160;is the first step in the process of configuring inbound SAML.</p>
        <h2>Start this task</h2>
        <ol>
            <li>
                <p>
                    <MadCap:snippetText src="../../Resources/Snippets/task steps/Security_IdentityProviders.flsnp" />
                </p>
            </li>
            <li>
                <p>Click <span class="uicontrol">Add Identity Provider</span>, and then select <span class="uicontrol">Add SAML 2.0 IdP</span>.</p>
            </li>
            <li>
                <p>Configure the <span class="uicontrol">General&#160;Settings</span>. If a <span class="uicontrol">View Setup Instructions</span> link appears, click it first. Some providers have their own detailed instructions.</p>
                <table style="width: 100%;margin-left: 0;margin-right: auto;mc-table-style: url('../../Resources/TableStyles/standard-horizonal-borders-only.css');" class="TableStyle-standard-horizonal-borders-only" cellspacing="14">
                    <col class="TableStyle-standard-horizonal-borders-only-Column-Column1" style="width: 20%;" />
                    <col class="TableStyle-standard-horizonal-borders-only-Column-Column1" />
                    <tbody>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyE-Column1-Body1"><span class="uicontrol">Name</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyD-Column1-Body1">The name that you choose for this IdP.</td>
                        </tr>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyB-Column1-Body1"><span class="uicontrol">Protocol</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyA-Column1-Body1">Only SAML 2.0 is supported.</td>
                        </tr>
                    </tbody>
                </table>
            </li>
            <li>
                <p>Configure <span class="uicontrol">Authentication Settings</span>.</p>
                <table style="width: 100%;margin-left: 0;margin-right: auto;mc-table-style: url('../../Resources/TableStyles/standard-horizonal-borders-only.css');" class="TableStyle-standard-horizonal-borders-only" cellspacing="14">
                    <col class="TableStyle-standard-horizonal-borders-only-Column-Column1" style="width: 20%;" />
                    <col class="TableStyle-standard-horizonal-borders-only-Column-Column1" />
                    <tbody>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyE-Column1-Body1"><span class="uicontrol">IdP&#160;username</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyD-Column1-Body1">The entity in the SAML assertion than contains the username. The drop-down list contains the default value, <em>saml.subjectNameId</em>.<p>You can enter an expression to reformat the value. For example, if the username in the SAML assertion is <em>john.doe@mycompany.okta.com</em>, you could specify the replacement of <em>mycompany.okta</em> with <em>endpointA.mycompany</em> to make the transformed username <em>john.doe@endpointA.mycompany.com</em>. If you want to enter an expression, use the <a href="http://developer.okta.com/docs/api/getting_started/okta_expression_lang.html">Okta Expression Language</a> syntax.</p></td>
                        </tr>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyE-Column1-Body1"><span class="uicontrol">Filter</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyD-Column1-Body1">Select Filter only if you want to enter an expression as a username filter. Specifying a filter limits the selection of usernames before authentication.</td>
                        </tr>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyE-Column1-Body1"><span class="uicontrol">Match against</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyD-Column1-Body1">Select the field in Okta against which the transformed username is authenticated. </td>
                        </tr>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyE-Column1-Body1"><span class="uicontrol">Account Link Policy</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyD-Column1-Body1">
                                <p>Specify whether Okta automatically links the user's IdP account with a matching Okta account.</p>
                                <div class="noteOkta">
                                    <p class="noteContent">For enhanced security, disable account linking if possible. If you need account linking, follow <MadCap:xref href="#Security">Security best practices</MadCap:xref>.</p>
                                </div>
                            </td>
                        </tr>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyE-Column1-Body1"><span class="uicontrol">Auto-Link Restrictions</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyD-Column1-Body1">When automatic account linking is enabled, indicate whether you want to restrict linking to specified user groups.</td>
                        </tr>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyB-Column1-Body1"><span class="uicontrol">If no match is found</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyA-Column1-Body1">Specify whether to create a new user account with Just In Time (JIT) provisioning or to redirect the end user to the Okta Sign-In page.<p>Note that for the first option, JIT&#160;provisioning must be enabled in two places:</p><ol><li><p>On this page, by clicking <span class="uicontrol">Create new user (JIT)</span>.</p></li><li><p>In <span class="menucascade">Settings &gt;&#160;Customization &gt;&#160;Just In Time Provisioning</span>, by clicking <span class="uicontrol">Enable Just In Time Provisioning</span>.</p></li></ol></td>
                        </tr>
                    </tbody>
                </table>
            </li>
            <li>
                <p>Configure <span class="uicontrol">JIT&#160;Settings</span>.</p>
                <table style="width: 100%;mc-table-style: url('../../Resources/TableStyles/standard-horizonal-borders-only.css');" class="TableStyle-standard-horizonal-borders-only" cellspacing="14">
                    <col class="TableStyle-standard-horizonal-borders-only-Column-Column1" style="width: 20%;" />
                    <col class="TableStyle-standard-horizonal-borders-only-Column-Column1" />
                    <tbody>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyE-Column1-Body1"><span class="uicontrol">Profile Source</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyD-Column1-Body1">When this box is selected, existing users are updated with the information in this SAML assertion. Profile information will not push if this box is not selected.</td>
                        </tr>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyE-Column1-Body1"><span class="uicontrol">Reactivation Settings</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyD-Column1-Body1">These options are visible if you selected  <span class="uicontrol">Update attributes for existing users</span>. <blockquote><p>•	<span class="uicontrol">Reactivate users who are deactivated in Okta</span>:  Allow admins to choose if a deactivated Okta user should be reactivated when reactivated in the app.</p><p>•	<span class="uicontrol">Unsuspend users who are suspended in Okta</span>: Allow admins to choose if a suspended Okta user should be unsuspended when reactivated in the app.</p></blockquote></td>
                        </tr>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyB-Column1-Body1"><span class="uicontrol">Group Assignments</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyA-Column1-Body1">Specify the groups to which the users in the SAML assertion should be added. Choose one of the options from the drop-down menu. Each option requires different information.<blockquote><ul><li><p><span class="uicontrol">None</span>: Do not assign the authenticated users to any groups. No other information is required.</p></li></ul><ul><li><p><span class="uicontrol">Assign to specific groups</span>: Assign each user to the groups listed in the <span class="uicontrol">Specific Groups</span> field. You must enter one or more groups in the field.</p></li></ul><ul><li><p><span class="uicontrol">Add user to missing groups</span>: Users are added to any groups in the SAML assertion of which they are not already members. (Users are not removed from any groups of which they are already members.) In the <span class="uicontrol">SAML Attribute Name</span> field, enter the name of the SAML attribute (in the attribute statements from the SAML assertion) whose values represent group memberships. Those values are compared to the groups specified in the <span class="uicontrol">Group Filter</span> field, and matching values determine the groups to which the user is assigned during JIT. The <span class="uicontrol">Group Filter</span> field acts as a security allowlist. List the groups that you want the IdP to assign to users dynamically. This allows you to control which users are assigned to certain groups. You must enter the <span class="uicontrol">SAML Attribute Name</span> and list one or more Okta groups in the <span class="uicontrol">Group Filter</span> field.</p></li></ul><ul><li><p><span class="uicontrol">Full sync of groups</span>: This option assigns users to the group represented by the attribute specified in the <span class="uicontrol">SAML Attribute Name</span> if that group is listed in the <span class="uicontrol">Group Filter</span>. </p></li></ul><p>Note that  If the user is a member of any Okta group that does not match the values represented by the attribute in the <span class="uicontrol">SAML Attribute Name</span> field, the user is deleted from the Okta group.</p></blockquote></td>
                        </tr>
                    </tbody>
                </table>
            </li>
            <li>
                <p>Configure <span class="uicontrol">SAML&#160;Protocol Settings</span>.</p>
                <table style="width: 100%;mc-table-style: url('../../Resources/TableStyles/standard-horizonal-borders-only.css');" class="TableStyle-standard-horizonal-borders-only" cellspacing="14">
                    <col class="TableStyle-standard-horizonal-borders-only-Column-Column1" style="width: 20%;" />
                    <col class="TableStyle-standard-horizonal-borders-only-Column-Column1" />
                    <tbody>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyE-Column1-Body1"><span class="uicontrol">IdP&#160;Issuer URI</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyD-Column1-Body1">The issuer URI from the IdP.</td>
                        </tr>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyE-Column1-Body1"><span class="uicontrol">IdP&#160;Single Sign-On URL</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyD-Column1-Body1">The sign-on URL from the IdP. If you sign the authN request by selecting the Request Signature option but do not specify a destination in the Destination field (see Advanced Settings), Okta automatically sends the authN request to the IdP Single Sign-On URL.</td>
                        </tr>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyB-Column1-Body1"><span class="uicontrol">IdP&#160;Signature Certificate</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyA-Column1-Body1">Certificate from the IdP used to sign the assertion.</td>
                        </tr>
                    </tbody>
                </table>
            </li>
            <li>
                <p>Optional. Configure <span class="uicontrol">Advanced Settings</span>.</p>
                <table style="width: 100%;mc-table-style: url('../../Resources/TableStyles/standard-horizonal-borders-only.css');" class="TableStyle-standard-horizonal-borders-only" cellspacing="14">
                    <col class="TableStyle-standard-horizonal-borders-only-Column-Column1" style="width: 37%;" />
                    <col class="TableStyle-standard-horizonal-borders-only-Column-Column1" />
                    <tbody>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyE-Column1-Body1"><span class="uicontrol">Request Binding</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyD-Column1-Body1">The SAML Authentication Request Protocol binding used by Okta to send SAML AuthNRequest messages to the IdP. Usually HTTP POST.</td>
                        </tr>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyE-Column1-Body1"><span class="uicontrol">Request Signature</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyD-Column1-Body1">Specify whether to sign SAML AuthnRequest messages that are sent from Okta. If you sign the authN request by selecting this option, Okta automatically sends the authN request to the URL specified in the IdP Single Sign-On URL field</td>
                        </tr>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyE-Column1-Body1"><span class="uicontrol">Request Signature Algorithm</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyD-Column1-Body1">Specify the signature algorithm used to sign SAML authN messages sent to the IdP.</td>
                        </tr>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyE-Column1-Body1"><span class="uicontrol">Response Signature Verification</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyD-Column1-Body1">Specify the types of response signatures Okta will accept when validating incoming responses: Response, Assertion, or Response or Assertion.</td>
                        </tr>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyE-Column1-Body1"><span class="uicontrol">Response Signature Algorithm</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyD-Column1-Body1"> Specify the minimum signature algorithm when validating SAML messages and assertions issued by the IdP: SHA-1 or SHA-256.</td>
                        </tr>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyE-Column1-Body1"><span class="uicontrol">Destination</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyD-Column1-Body1">The destination attribute sent in the SAML authN request. If you do not enter a destination and you sign the authN request by selecting the Request Signature option, Okta automatically sends the destination attribute as the URL specified in the IdP Single Sign-On URL field (the SSO URL).</td>
                        </tr>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyE-Column1-Body1"><span class="uicontrol">Okta Assertion Consumer Service URL</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyD-Column1-Body1">Specify whether to use a trust-specific assertion consumer service (ACS) URL or one that is shared across the organization.</td>
                        </tr>
                        <tr class="TableStyle-standard-horizonal-borders-only-Body-Body1">
                            <td class="TableStyle-standard-horizonal-borders-only-BodyB-Column1-Body1"><span class="uicontrol">Max Clock Skew</span>
                            </td>
                            <td class="TableStyle-standard-horizonal-borders-only-BodyA-Column1-Body1">Specify how long the assertion is valid. Enter a number and select the units. The authentication process calculates the difference between the current time and the time on the assertion timestamp to verify that the difference is not more than the Max Clock Skew value.</td>
                        </tr>
                    </tbody>
                </table>
            </li>
            <li>
                <p>Click <span class="uicontrol">Add Identity Provider</span>.</p>
            </li>
        </ol>
        <h2>Send Okta metadata </h2>
        <p>After you create an IdP, click <span class="uicontrol">Download metadata</span> to access the Okta SAML metadata for this provider. Follow the IdP's instructions to provide metadata to them.</p>
        <h2><a name="Security"></a>Security best practices</h2>
        <p>If you enable account linking, consider these best practices:</p>
        <ul>
            <li>
                <p>
                    <MadCap:xref href="#IdP">IdP configuration</MadCap:xref>
                </p>
            </li>
            <li>
                <p>
                    <MadCap:xref href="#Authenti">Authentication policies</MadCap:xref>
                </p>
            </li>
            <li>
                <p>
                    <MadCap:xref href="#Monitori">Monitoring</MadCap:xref>
                </p>
            </li>
        </ul>
        <h3><a name="IdP"></a>IdP configuration</h3>
        <p>Use these settings:&#160;</p>
        <ul>
            <li>
                <p><span class="uicontrol">Group Assignment</span>: Specify the groups that you created for each external IdP.</p>
            </li>
            <li>
                <p><span class="uicontrol">If no match is found</span>: Select <span class="uicontrol">Create new user (JIT)</span> to provision users into your <MadCap:variable name="okta-variables.ProductName" /> org.</p>
            </li>
            <li>
                <p><span class="uicontrol">Account Link Policy</span>: Consider disabling account linking after all existing users from the external IdP signed in to your Okta org. At this point, all links were created. After you disable linking, new users that are created in the external IdP are added to Okta by JIT provisioning.</p>
            </li>
            <li>
                <p><span class="uicontrol">Filter</span>: Select <span class="uicontrol">Only allow usernames that match defined RegEx Pattern</span>.</p>
                <ul>
                    <li>
                        <p>If users from an external IdP have a different username domain than users from the Okta org, use a RegEx pattern such as: <span class="code">^[A-Za-z0-9._%+-]+@spokedomain\.com</span></p>
                    </li>
                    <li>
                        <p>If all users share the same domain, use a RegEx pattern that excludes specific users. The list should include all known administrators in your Okta org. To allow any user except the ones explicitly mentioned, use this expression: <span class="code">^((?!(admin\.user\.1@company\.com|admin\.user\.2@othercompany\.com)).)*$</span></p>
                        <p>Allowed users defined by this expression are privileged accounts.</p>
                        <div class="noteOkta">
                            <p class="noteContent">The expression is not dynamically updated. If new administrators or privileged users are created in your <MadCap:variable name="okta-variables.ProductName" /> org, you must update the expression manually. </p>
                        </div>
                    </li>
                </ul>
            </li>
        </ul>
        <h3><a name="Authenti"></a>Authentication policies</h3>
        <ul>
            <li>
                <p>Prevent Okta admins from signing in to the parent org through federation from an external IdP. <a href="../identity-engine/policies/about-policies.htm">Create a global session policy</a> to deny access for users in the Okta Administrators  group if they’re from an external IdP. You can select multiple IdPs. Set this policy to be evaluated first.</p>
            </li>
            <li>
                <p>Prevent access to the Admin Dashboard for any users who sign in through federation from an external IdP. <a href="../identity-engine/policies/about-app-sign-on-policies.htm">Create an authentication policy</a> for each external IdP. Configure the policy to deny access to selected apps, such as the Admin Dashboard. You can restrict access to any sensitive apps.</p>
            </li>
            <li>
                <p>If possible, require all Okta admins to use phishing-resistant authenticators. Create a global session policy to require multifactor authentication (MFA) for the Okta Administrators group. </p>
                <div class="noteOkta">
                    <p class="noteContent">Users with custom admin roles are considered part of the Okta Administrators. Therefore<MadCap:change MadCap:changes="1">,</MadCap:change> users with custom admin roles are included in policies targeting Okta Administrators.</p>
                </div>
                <p><a href="../identity-engine/policies/add-app-sign-on-policy-rule.htm">Configure authentication policy rules</a> to require phishing-resistant authenticators. </p>
            </li>
        </ul>
        <h3><a name="Monitori"></a>Monitoring</h3>
        <p>Use the System Log to review authentication events through the IdP.</p>
        <p>Search for <span class="code">eventType eq "user.authentication.auth_via_IDP"</span> and review events which have an <span class="code">Okta System (SystemPrincipal)</span> actor and an <span class="code">end user</span> target. Such events indicate that an account linking operation occurred. If the target user is a privileged user (or an administrator)<MadCap:change MadCap:changes="2">,</MadCap:change> <MadCap:change MadCap:changes="2">address all </MadCap:change><MadCap:change MadCap:changes="3">ensure that any</MadCap:change> potential incident<MadCap:change MadCap:changes="2">s</MadCap:change><MadCap:change MadCap:changes="3"> is addressed</MadCap:change>.</p>
        <h2><span>Next steps</span>
        </h2>
        <p>
            <MadCap:xref href="idp-add-metadata.htm">Add metadata for an Identity Provider</MadCap:xref>
        </p>
    </body>
</html>