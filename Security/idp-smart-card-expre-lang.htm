<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd"
      MadCap:onlyLocalStylesheets="False"
      MadCap:searchable="True"
      MadCap:conditions="MultiProdPublish.Classic+OIE"
      MadCap:fileTags="Tags/okta-authors.Patrick Calnan">
   <head>
      <link href="../../Resources/TableStyles/standard-shaded-rows.css"
            rel="stylesheet"
            MadCap:stylesheetType="table"/>
      <title>[%=Heading.Level1%]</title>
      <link href="" rel="stylesheet" type="text/css"/>
   </head>
   <body>
      <h1>Smart card idpUser expressions</h1>
      <p>When creating a Smart card identity provider, you must specify one of the attributes of <span class="code">idpuser</span> as the value of the <span class="uicontrol">IdP Username</span> field. This value is then used to look up the associated user. The <span class="uicontrol">IdP Username</span> field can also contain an  <a href="http://developer.okta.com/docs/getting_started/okta_expression_lang.html"
            target="_blank">Okta Expression Language</a> expression. When <span class="uicontrol">IdP Username</span> contains an expression, the result of evaluating the expression is then used to match users. This page describes the process of creating and testing expressions before using them with a Smart card identity provider.</p>
      <h2>Topics</h2>
      <ul>
         <li>
            <MadCap:xref href="#Create">Create test attribute</MadCap:xref>
         </li>
         <li>
            <MadCap:xref href="#Develop">Develop expression</MadCap:xref>
         </li>
         <li>
            <MadCap:xref href="#Specify">Specify expression as idpUser</MadCap:xref>
         </li>
      </ul>
      <h2>Before you begin</h2>
      <ul>
         <li>Ensure that a smart card identity provider has been previously created as described in <MadCap:xref href="idp-enable-smart-card.htm">Add a Smart Card identity provider</MadCap:xref>.</li>
      </ul>
      <h2>
         <a name="Create"/>Create test attribute</h2>
      <p>A test attribute is used to create and validate the result of the expression.  Using a test attribute avoids overwriting actual data.  <br/>To add a test attribute:</p>
      <ol>
         <li>Sign in to your Okta org as an admin.</li>
         <li>Select <span class="menucascade">
               <span class="uicontrol">Directory</span>
               <span class="uicontrol">Profile Editor</span>
            </span>.</li>
         <li>In the Profile Editor pane, select the <span class="wintitle">Users</span> tab and then <span class="uicontrol">Identity Providers</span>.</li>
         <li>Open the previously created Smart card identity provider by clicking its name.<br/>The profile editor will open previously created identity providers profile page.</li>
         <li>In the Attributes section, click <span class="uicontrol">Add Attribute</span>. </li>
         <li>In the <span class="wintitle">Add Attribute</span> dialog enter:<br/>
            <table style="mc-table-style: url('../../Resources/TableStyles/standard-shaded-rows.css');"
                   class="TableStyle-srb_header_alt_shade"
                   cellspacing="0">
               <col class="TableStyle-srb_header_alt_shade-Column-Column1"/>
               <col class="TableStyle-srb_header_alt_shade-Column-Column1"/>
               <thead>
                  <tr class="TableStyle-srb_header_alt_shade-Head-Header1">
                     <th class="TableStyle-srb_header_alt_shade-HeadF-Column1-Header1">Field</th>
                     <th class="TableStyle-srb_header_alt_shade-HeadD-Column1-Header1">Value</th>
                  </tr>
               </thead>
               <tbody>
                  <tr class="TableStyle-srb_header_alt_shade-Body-Body1">
                     <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1">
                        <span class="uicontrol">Display name</span>
                     </td>
                     <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body1">An appropriate name such as <span class="userinput">Test Attribute.</span>
                     </td>
                  </tr>
                  <tr class="TableStyle-srb_header_alt_shade-Body-Body2">
                     <td class="TableStyle-srb_header_alt_shade-BodyC-Column1-Body2">
                        <span class="uicontrol">Variable name</span>
                     </td>
                     <td class="TableStyle-srb_header_alt_shade-BodyA-Column1-Body2">An appropriate variable name such as <span class="userinput">testAttribute</span>.</td>
                  </tr>
               </tbody>
            </table>
         </li>
         <li>
                    Ensure that the attribute type is <span class="userinput">string</span> and click <span class="uicontrol">Save</span>.
                </li>
      </ol>
      <div>
         <h2>
            <a name="Develop"/>Develop expression</h2>
         <p>Using the previously added attribute develop an expression:</p>
         <div class="noteOkta">
            <p class="noteContent">The expression must:<br/>
               <ul>
                  <li>Return a string.</li>
                  <li>Evaluate to a single value.</li>
                  <li>Match against the identity provider <span class="uicontrol">Match against</span> field. </li>
               </ul>
            </p>
         </div>
         <ol>
            <li>Select <span class="uicontrol">Mappings</span> or<ol style="list-style-type: lower-alpha;">
                  <li>Select <span class="menucascade">
                        <span class="uicontrol">Directory</span>
                        <span class="uicontrol">Profile Editor</span>
                     </span>.
                  </li>
                  <li>Select <span class="uicontrol">Identity Providers</span>. </li>
                  <li>Select the previously created identity provider.
                  </li>
                  <li>Click <span class="uicontrol">Mappings</span>.</li>
               </ol>
            </li>
            <li>Enter the expression which represents the value of the attribute value.<br/>			For example to return content before at sign (@) from email address: <br/>
               <span class="code">String.substringBefore(appuser.subjectAltNameEmail, "@"))</span>.<br/>
               <div class="noteOkta">
                  <p class="noteContent">Test examples must use <span class="code">appuser</span> in place of <span class="code">idpuser</span>. <span class="code">idpuser</span> is not available during testing.<br/>
                     <span class="code">appuser</span> should only be used for testing and contains all currently supported <span class="code">idpuser</span> fields. <br/>When using this expression in an identity provider always substitute <span class="code">idpuser</span> for all instances of <span class="code">appuser</span>. </p>
               </div>					See the  <MadCap:xref href="idp-smart-card-exp-examples.htm">Expressions and examples</MadCap:xref> for details and examples of expressions.<br/>
            </li>
            <li>Click <span class="uicontrol">Save Mappings</span>. If required, correct any expression errors.</li>
            <li>In the preview section, select an appropriate user and click <span class="uicontrol">Enter</span>.</li>
            <li>Examine the result to ensure that the expression returned the expected value. Repeat as required. </li>
            <li>When complete click <span class="uicontrol">Exit Preview</span>.</li>
            <li>Copy the finished expression for use in the identity provider. </li>
            <li>Click <span class="uicontrol">Cancel</span>. </li>
            <li>The test attribute can now be deleted. </li>
         </ol>
      </div>
      <div>
         <h2>
            <a name="Specify"/>Specify expression as idpUser</h2>
         <ol>
            <li>In the navigation pane, select <span class="menucascade">
                  <span class="uicontrol">Security</span>
                  <span class="uicontrol">Identity Providers</span>
               </span>. </li>
            <li>In the row containing the PIV smart card identity provider click <span class="menucascade">
                  <span class="uicontrol">Configure</span>
                  <span class="uicontrol">Configure Identity Provider</span>
               </span>. </li>
            <li>In the <span class="uicontrol">IdP Username</span> field select the current contents and paste the replacement value.</li>
            <li>Click <span class="uicontrol">Update Identity Provider</span>.</li>
         </ol>
      </div>
      <h2>Related topics</h2>
      <p>
         <MadCap:xref href="idp-enable-smart-card.htm">Enable a Smart Card</MadCap:xref>
      </p>
      <p>
         <MadCap:xref href="idp-smart-card-exp-examples.htm">Expressions and examples</MadCap:xref>
      </p>
   </body>
</html>
