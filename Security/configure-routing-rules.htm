<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:onlyLocalStylesheets="False" MadCap:searchable="True" MadCap:fileTags="Tags/okta-authors.Graham Smith" MadCap:conditions="MultiProdPublish.Classic+OIE">
    <head>
        <link href="../../Resources/TableStyles/standard.css" rel="stylesheet" MadCap:stylesheetType="table" /><title>[%=Heading.Level1%]</title>
        <link href="" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <h1>Configure identity provider routing rules</h1>
        <p>Configure routing rules for each of your identity providers (IdPs) or for different combinations of user criteria. The default rule specifies Okta as the IdP, and it applies to any user who doesn't meet the conditions of your routing rules. </p>
        <p>To create routing rules that aren't bound to a specific IdP, see <MadCap:xref href="dynamic-routing-rules.htm">Configure dynamic routing rules</MadCap:xref>.</p>
        <h2><a name="Before"></a>Before you begin       </h2>
        <p MadCap:conditions="MultiProdPublish.Classic">Before you add routing rules, you need to configure the <a href="../Directory/Configuring_Desktop_SSO.htm"><MadCap:variable name="okta-variables.ProductName" /> <MadCap:variable name="okta-feature-names.IWA&#160;Web agent" /></a> and at least one more IdP (social IdPs are accepted). See  <MadCap:xref href="idp-inbound-saml-workflow.htm">Add a SAML 2.0 IdP</MadCap:xref> and <a href="../integrations/open-id-connect.htm"><MadCap:xref href="../integrations/open-id-connect.htm">Generic OpenID Connect</MadCap:xref></a>. </p>
        <p MadCap:conditions="MultiProdPublish.Classic">If you want to  prompt users for their Okta username and password  on the same page as your list of available IdPs, configure your <a href="policies/about-signon-policies.htm">Okta sign-on policy</a> so that users establish a session with <span class="uicontrol">Password / Any IdP</span>. This combination is recommended for your rules that offer Okta as an IdP or if you intend to prioritize the default routing rule. </p>
        <p MadCap:conditions="MultiProdPublish.Classic">IdP&#160;Discovery on ChromeBook only supports the Okta IdP and third-party IdPs that have announced support for ChromeBook. Okta Mobile isn't supported for use with IdP Discovery.</p>
        <p MadCap:conditions="MultiProdPublish.OIE">If you want to  prompt users for their Okta username and password  on the same page as your list of available identity providers, configure your <a href="../identity-engine/policies/create-okta-sign-on-policy.htm" target="_blank">global session policy</a> so that users establish a session with <span class="uicontrol">A password</span>. This is recommended for your rules that offer Okta as an IdP or if you intend to prioritize the default routing rule. </p>
        <p MadCap:conditions="MultiProdPublish.OIE">IdP&#160;Discovery on ChromeBook only supports the Okta IdP and third-party IdPs that have announced support for ChromeBook. </p>
        <p>If you want to route users based on an IP&#160;address, define at least one network zone. See <MadCap:xref href="network/network-zones.htm">Network Zones</MadCap:xref>.</p>&#160;<h2><a name="Add"></a>Add a rule</h2><ol MadCap:continue="true"><li><MadCap:snippetText src="../../Resources/Snippets/task steps/Security_IdentityProviders.flsnp" /></li><li>On the Routing Rules tab, click <span class="uicontrol">Add Routing Rule</span>.</li><li>Enter a <span class="uicontrol">Rule Name</span>.</li><li>Configure the routing conditions. <br /><dl><dt><table style="width: 100%;mc-table-style: url('../../Resources/TableStyles/standard.css');" class="TableStyle-standard" cellspacing="0"><col class="TableStyle-standard-Column-Column1" style="width: 37%;" /><col class="TableStyle-standard-Column-Column1" /><tbody><tr class="TableStyle-standard-Body-Body1"><td class="TableStyle-standard-BodyF-Column1-Body1"><code>IF</code>&#160;<span class="uicontrol">User's IP&#160;is</span></td><td class="TableStyle-standard-BodyD-Column1-Body1">Select a network zone. </td></tr><tr class="TableStyle-standard-Body-Body2"><td class="TableStyle-standard-BodyF-Column1-Body2"><code>AND</code>&#160;<span class="uicontrol">User's device platform is</span></td><td class="TableStyle-standard-BodyD-Column1-Body2">Select any combination of mobile and desktop devices.&#160;<p> iOS&#160;devices may bypass your iOS&#160;routing rules. See <MadCap:xref href="#Configur">Configure a routing rule for macOS&#160;devices</MadCap:xref>.</p></td></tr><tr class="TableStyle-standard-Body-Body1"><td class="TableStyle-standard-BodyF-Column1-Body1"><code>AND</code>&#160;<span class="uicontrol">User is accessing</span></td><td class="TableStyle-standard-BodyD-Column1-Body1">To add an application or app instance, start typing the application name. A list of all matching apps appears.</td></tr><tr class="TableStyle-standard-Body-Body2"><td class="TableStyle-standard-BodyF-Column1-Body2"><code>AND</code>&#160;<span class="uicontrol">User matches</span></td><td class="TableStyle-standard-BodyD-Column1-Body2">Select which login attributes the user must match.<ul><li style="font-style: normal;"><span class="uicontrol">Anything</span> includes all users.<li style="font-style: normal;"><span class="uicontrol">Regex on login</span> allows you to enter any valid regular expression based on the user login to use for matching. This is useful when specifying the domain or a user attribute isn't sufficient for matching. For example, <span class="userinput">.*\+devtest@company.com</span> matches logins for the domain <span class="userinput">@company.com</span> but only if  <span class="userinput">+devtest</span> is included before the <span class="userinput">@</span> sign.</li><li style="font-style: normal;"><span class="uicontrol">Domain list on login</span> specifies a list of the domains to match (without the <span class="userinput">@</span>&#160;sign); for example, <span class="userinput">mytest.com</span>. It isn't necessary to escape any characters (which is required when using a regular expression).</li><li style="font-style: normal;"><span class="uicontrol">User attributes</span> specify an attribute name, a type of comparison, and a value to match. If you choose Regex for the type of comparison, you must enter a valid regular expression for the value. For example, enter <span class="userinput">(Human Resources|Engineering|Marketing)</span> for the <span class="uicontrol">Department</span> attribute in your Okta user schema.</li></li></ul></td></tr><tr class="TableStyle-standard-Body-Body1" MadCap:conditions="MultiProdPublish.Classic"><td class="TableStyle-standard-BodyF-Column1-Body1"><code>THEN</code>&#160;<span class="uicontrol">Use this identity provider</span></td><td class="TableStyle-standard-BodyD-Column1-Body1">Select the IdP to use when all the conditions are met.</td></tr><tr class="TableStyle-standard-Body-Body2" MadCap:conditions="MultiProdPublish.OIE"><td class="TableStyle-standard-BodyC-Column1-Body2"><code>THEN</code>&#160;<span class="uicontrol">Use this identity provider</span></td><td class="TableStyle-standard-BodyA-Column1-Body2">Select one or more IdPs to make available when all the conditions are met. Adding multiple IdPs allows users to choose one when they sign in. If you configure a condition in <code>AND</code> <span class="uicontrol">User matches</span>, you should use a single IdP.</td></tr></tbody></table></dt></dl></li><li style="font-style: normal;">Click <span class="uicontrol">Create Rule</span>, and then indicate whether you want to activate the rule immediately.<dl MadCap:conditions="Primary.do-not-publish"><dt style="font-style: normal;"><img src="../../Resources/Images/idp_discovery.png" class="thumbnail" MadCap:conditions="MultiProdPublish.Classic" /></dt></dl></li><dl><dt style="font-style: normal;" MadCap:conditions="Primary.do-not-publish"><img src="../../Resources/Images/identity-engine/idp-routing-rule.png" class="thumbnail" MadCap:conditions="MultiProdPublish.OIE" /></dt></dl></ol><h2><a name="Configur"></a>Configure a routing rule for macOS&#160;devices</h2><p>Due to a change in the way that Safari reports  device user agents, Okta can't differentiate between app requests that come from  macOS devices and those that come from Safari on iPadOS devices.</p><p>To prevent iPadOS devices from bypassing iOS policies,  configure a Deny/Catch-All routing rule that applies to macOS and iPadOS devices. To prevent your macOS&#160;app routing rules from evaluating iPadOS&#160;device users, inform these users that they must do one of the following options.</p><ul><li>Option 1: <span class="uicontrol">All websites accessed from Safari (iPadOS 13 and higher)</span>.  In iPad settings, go to <span class="filepath">Safari settings &gt; Request Desktop Website</span>, and then turn off the <span class="uicontrol">All Websites</span> setting.</li><li>Option 2: <span class="uicontrol">Per-website basis</span>. Open Safari, tap <span class="uicontrol">Aa</span> on the left side of the search field, and then tap <span class="uicontrol">Request Mobile Website</span>.</li><li MadCap:conditions="MultiProdPublish.Classic">Option 3: Access the target app through the Native App or Okta Mobile.</li></ul><h2><a name="Related"></a>Related topics</h2><p><MadCap:xref href="Identity_Provider_Discovery.htm">Identity Provider routing rules</MadCap:xref></p><p><MadCap:xref href="modify-routing-rules.htm">Modify routing rules</MadCap:xref></p><p><MadCap:xref href="Identity_Providers.htm">Identity Providers</MadCap:xref></p><p><MadCap:xref href="dynamic-routing-rules.htm">Configure dynamic routing rules</MadCap:xref></p></body>
</html>