<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd"
      MadCap:fileTags="Tags/okta-topic-status.Ready for Review"
      MadCap:onlyLocalStylesheets="False"
      MadCap:searchable="True"
      MadCap:conditions="MultiProdPublish.Classic+OIE">
   <head>
      <title>[%=Heading.Level1%] | Okta</title>
      <link href="" rel="stylesheet" type="text/css"/>
      <meta name="description"
            content="Configure custom authorization servers with Okta."/>
   </head>
   <body>
      <a name="API_Access"/>
      <h1>Create access policies</h1>
      <p>Access policies control which clients can interact with an authorization server. They also define the access rules, such as allowing only specific scope requests.</p>
      <ol>
         <li>Choose the name of an authorization server.</li>
         <li>Choose <span class="menucascade">
               <span class="uicontrol">Access Policies</span>
               <span class="uicontrol">Add New Access Policy</span>
            </span>.</li>
         <li>Provide the requested information:
							<ul>
               <li>
                  <p>
                     <span class="uicontrol">Name</span>
                  </p>
               </li>
               <li>
                  <p>
                     <span class="uicontrol">Description</span>
                  </p>
               </li>
               <li>
                  <p>Assign to <span class="uicontrol">All clients</span>, or select <span class="uicontrol">The following clients:</span> and enter the name of the clients covered by this access policy.</p>
               </li>
            </ul>
         </li>
      </ol>
      <p>While in the <span class="wintitle">Access Policy</span> list, you can:</p>
      <ul>
         <li>Set access policies to be active or deactivate them for testing or debugging purposes.</li>
         <li>Reorder policies to change the order of evaluation.</li>
         <p>
            <img src="../../Resources/Images/API_Access_4.png"
                 alt="Access Policy List"
                 style="width: 652px; height: 215px;"
                 id="img_new"/>
         </p>
      </ul>
      <p>Okta evaluates these policies and the rules within the policy in the given priority order. After the first policy and rule match, Okta applies the client request  and no further rule or policy processing occurs. </p>
      <h2>
         <a name="Create"/>
         <a name="Create_rules"/>Create Rules for Each Access Policy</h2>
      <p>
         <a name="create-rule"/>Rules control the mapping of client, user, and custom scope. For example, you can specify
							an access policy rule that if the user is assigned to a client, then custom scope <span class="code">Scope1</span>
						is valid.</p>
      <div class="noteOkta">
         <p class="noteContent">When you create a rule, Okta assigns it to the lowest priority of the rules in that policy. This action is done so that it doesn't interfere with requests that match the existing rules.</p>
      </div>
      <ol>
         <li>Choose the name of an authorization server, and select <span class="uicontrol">Access Policies</span>.</li>
         <li>Choose the name of an access policy, and select <span class="uicontrol">Add Rule.</span>
         </li>
         <li>Enter the requested information:
								<ul>
               <li>
                  <p>
                     <span class="uicontrol">Rule Name</span>
                  </p>
               </li>
               <li>
                  <p>
                     <span class="uicontrol">IF Grant type is</span>: Select whether the client is acting on behalf of itself or on behalf of a user. You can select both. If the client is acting on behalf of a user, select any or all of the methods.</p>
                  <ul MadCap:conditions="MultiProdPublish.OIE">
                     <li>
                        <p src="../../Resources/Snippets/ea-featmgr.flsnp"
                           MadCap:conditions="Primary.do-not-publish">The following is for the new CIBA grant type from the Customer Fed team - self-service EA in 2022.12.0, Identity Engine only.</p>
                        <p src="../../Resources/Snippets/ea-featmgr.flsnp"> Select the <span class="uicontrol">Client-initiated backchannel authentication flow (CIBA)</span> option to configure the authenticator for use with the CIBA grant type.</p>
                        <MadCap:snippetBlock src="../../Resources/Snippets/ea-featmgr.flsnp"/>
                     </li>
                  </ul>
               </li>
               <li>
                  <p>
                     <span class="uicontrol">AND User is</span>: This option only appears if you checked an option under <span class="wintitle">Client acting on behalf of a user</span>. You can choose <span class="wintitle">Any user assigned to the app</span>, or define the users further.</p>
               </li>
               <li>
                  <p>
                     <span class="uicontrol">AND Scopes requested</span>: Choose the scopes (any scopes, or a list that you specify) granted if the user meets any of the conditions.</p>
               </li>
               <li>
                  <p>
                     <span class="uicontrol">THEN Use this inline hook</span>: If applicable, choose an inline hook. See <MadCap:xref href="../automation-hooks/inline-hooks-main.htm">Inline Hooks</MadCap:xref>.</p>
               </li>
               <li>
                  <p>
                     <span class="uicontrol">AND Access token lifetime is</span>: Choose the length of time before an access token expires.</p>
               </li>
               <li>
                  <p>
                     <span class="uicontrol">AND Refresh token lifetime is</span>: Choose the length of time before a refresh token expires.</p>
                  <p>Under the <span class="uicontrol">Refresh token lifetime</span>, enter a time period during which the token must be used to validate and continue its specified lifetime.</p>
                  <div class="noteOkta">
                     <p class="noteContent">The expiration period must fall within the access token lifetime and the refresh token lifetime. The maximum expiration period is five years. Tokens not used during the expiration period expire even if their lifetime is unlimited.</p>
                  </div>
               </li>
            </ul>
         </li>
         <li>Choose <span class="uicontrol">Create Rule</span> to save the rule.
							
							<p>
               <img src="../../Resources/Images/API_Access_6.png"
                    alt="Rules List"
                    style="width: 676px;height: 445px;"
                    class="thumbnail"/>
            </p>
            <p>While in the Rules list for an access policy, you can:</p>
            <ul>
               <li>
                  <p>Set a rule to be inactive for testing or debugging.</p>
               </li>
               <li>
                  <p>Reorder rules, except for the default rule in the default policy. <MadCap:variable name="okta-variables.ProductName"/> evaluates rules in priority order,
							so the first rule in the first policy that matches the client request is applied and no further processing occurs.</p>
                  <div class="noteOkta">
                     <p class="noteContent">Service applications (client credentials flow) have no user. If you use this flow, make sure you have at least one rule that specifies the condition <span class="uicontrol">No user</span>.</p>
                  </div>
               </li>
               <li>
                  <p>Click the information icon or rule name to see which users and groups the rule applies to, and the scopes  granted to them.</p>
                  <p>
                     <img src="../../Resources/Images/auth_server_expanded_2.png" id="img_new"/>
                  </p>
               </li>
            </ul>
         </li>
      </ol>
   </body>
</html>
