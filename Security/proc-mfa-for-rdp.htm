<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd"
      MadCap:onlyLocalStylesheets="False"
      MadCap:searchable="True"
      MadCap:conditions="Primary.review-only"
      MadCap:fileTags="Tags/okta-authors.Patrick Calnan">
   <head>
      <link href="../../Resources/TableStyles/standard-shaded-rows.css"
            rel="stylesheet"
            MadCap:stylesheetType="table"/>
      <title>Windows Credential Provider | Okta</title>
      <link href="" rel="stylesheet" type="text/css"/>
      <meta name="description"
            content="Enable MFA for Windows server RDP authentication attempts using Okta’s Credential Provider for Windows."/>
   </head>
   <body>
      <h1>
         <a name="top"/>Okta MFA for RDP</h1>
      <h2 style="font-weight: bold;">Overview</h2>
      <p>Users can use the Okta Credential Provider for Windows to prompt users for MFA when signing in to supported Windows servers with an RDP client.</p>
      <p>Additionally, with version 1.2+ of the agent (EA), end users can reset their Active Directory passwords without contacting their administrators. This is done with a <span class="uicontrol">Reset Okta Password</span> link on the sign-on screen.</p>
      <p>For a complete version history, see <MadCap:xref href="../Settings/Version_Histories/Ver_History_Okta_MFA_Credential_Provider_for_Windows.htm">Okta MFA Credential Provider for Windows Version History.</MadCap:xref>
      </p>
      <h2>Prerequisites</h2>
      <p>Note the following requirements before installing the Okta Credential Provider for Windows:</p>
      <ul>
         <li>Proxy Configuration: The Okta Credential Provider for Windows does not support a discrete proxy configuration but will obey system level proxy configurations. To understand management of proxies on Windows machines, refer to <a href="http://www.technet.com/">www.technet.com</a>.</li>
         <li>The Windows machine used for installation must have an active internet connection with port 443 open.</li>
         <li>The installing account must have administrative rights to install the Okta Windows Credential Provider Agent, Visual C++ Redistributable and .NET 4.0+.</li>
         <li>Inline enrollment is not supported.<br/>End users must have enrolled their MFA tokens previously, by choosing an MFA option for their account when signing in to Okta the first time or after a reset. End users cannot enroll a token during an RDP sign in. End users with unenrolled tokens  receive an authentication failed response from Okta when attempting to sign into an RDP server.</li>
         <li>
            <p>Configured MFA factors that include the factor to use for RDP sign in. For instructions, see <a href="MFA.htm">MFA</a>.</p>
         </li>
      </ul>
      <h4>Supported Operating Systems</h4>
      <ul>
         <li>Windows Server 2016</li>
         <li>Windows Server 2012</li>
         <li>Windows Server 2012 R2</li>
         <li>Windows Server 2008</li>
         <li>Windows Server 2008 R2</li>
      </ul>
      <h4>Supported Factors</h4>
      <p> See <MadCap:xref href="mfa/mfa-factors.htm">MFA factor configuration</MadCap:xref> for a list of supported MFA factors. </p>
      <p MadCap:conditions="Primary.do-not-publish">The following MFA Factors are supported:</p>
      <ul MadCap:conditions="Primary.do-not-publish">
         <li>
            <a href="../Security/mfa/mfa-home.htm">Okta Verify</a>
            <br/>
            <div class="noteOkta">
               <p class="noteContent">Okta Verify supports <span class="uicontrol">Send push automatically</span> and <span class="uicontrol">Do not Challenge for the next X hours</span> options. These options are managed locally via browser cookies.  If the browser is configured to automatically clear cache and cookies on window close then these settings would need to be set again anytime a new browser window is opened or any time cache and cookies are cleared. </p>
            </div>
         </li>
         <li>
            <a href="../Security/mfa/mfa-home.htm">Voice Call</a>
         </li>
         <li>
            <a href="../Security/mfa/mfa-home.htm">On-Prem MFA (RSA)</a>
         </li>
         <li>
            <a href="../Security/mfa/mfa-home.htm">Email</a>
         </li>
         <li>
            <a href="../Security/mfa/mfa-home.htm">SMS Authentication</a>
         </li>
         <li>
            <a href="../Security/mfa/mfa-home.htm">Google Authenticator</a>
         </li>
         <li>
            <a href="../Security/mfa/mfa-home.htm">YubiKey</a>
         </li>
         <li>
            <a href="../Security/mfa/mfa-home.htm">Symantec VIP</a>
         </li>
         <li>
            <a href="../Security/mfa/mfa-home.htm">Security Question</a>
         </li>
         <li>
            <a href="../Security/mfa/mfa-home.htm">Custom TOTP Authentication</a>
         </li>
      </ul>
      <h2>Installation </h2>
      <p>Sign in to Okta and verify or set up policies. Install the agent on the Windows server and return to Okta to create an app and assign users. Test the setup once the installation has been successful. The installation contains three major installation steps and one testing step. Be sure to complete the testing after the installation.</p>
      <h3>Step 1 – Configure Okta </h3>
      <p>Before installing the Okta credential provider for Windows, your org must have the following three items configured.</p>
      <ul>
         <li>Configured MFA factors that include the factor to use for RDP sign in. For instructions, see <a href="MFA.htm">MFA</a>.</li>
         <li>A group for the end users who will authenticate RDP sign ins. For instructions, see <a href="../users-groups-profiles/usgp-about-groups.htm">Group Types Used in Okta</a>. </li>
         <li>
            <p>Add the Microsoft RDP app</p>
            <p>On the <span class="wintitle">Applications</span> page, select <span class="uicontrol">Add Application</span> and enter <span class="userinput">Microsoft RDP (MFA)</span> in the search box. <br/>Then, add the application. <br/>On the <span class="uicontrol">General</span> tab, assign any desired application label. You can assign people to the app now or later, as described  below.</p>
            <div class="noteOkta">
               <p class="noteContent">RDP fails with the error message <span class="code">Multifactor Authentication Failed</span> if the user that tries to RDP into a server with the RDP agent installed that does not match an Microsoft RDP (MFA) App username.</p>
            </div>
         </li>
      </ul>
      <h3>Step 2 – Install the Okta Credential Provider for Windows</h3>
      <p>From the link on the <span class="menucascade">
            <span class="uicontrol">Okta Settings</span>
            <span class="uicontrol">Downloads</span>
         </span> page, download link for Okta Windows Credential Provider Agent. After downloading the installer, complete the following steps. During the installation process, keep Okta open in another window on the Microsoft RDP (MFA) application screen. You can perform a standard installation or a silent installation.</p>
      <h4>Standard installation</h4>
      <ol>
         <li>
            <p>On the Windows server: </p>
            <ol style="list-style-type: lower-alpha;">
               <li>Download the installer from the <span class="uicontrol">MFA Plugins and Agents</span> section of <span class="menucascade">
                     <span class="uicontrol">Settings</span>
                     <span class="uicontrol">Downloads</span>
                  </span>
               </li>
               <li>Extract the files from the .zip archive</li>
               <li>Run <span class="code">Setup.exe</span>.</li>
               <li>Follow the prompts to complete the installation.</li>
            </ol>
            <div class="noteOkta">
               <p class="noteContent">The installer package contains the C++ Runtime libraries. The installer prompts you to install these redistributable runtime libraries if it is not present, or to repair it, if it is present. Then, the installer prompts for the Visual C++ 14 Runtime Libraries, as shown below</p>
            </div>
            <p MadCap:conditions="Primary.do-not-publish">Note: The package contains the C++ installer. The installer prompts your to install it if it is not present, or to repair it, if it is present. Then, the installer prompts for the Visual C++ 14 Runtime Libraries, as shown below.</p>
         </li>
         <li>
            <p>During the installation, two App Configuration screen display appear. The first requests a client ID, a client secret, and an Okta URL, as shown below.</p>
            <p>To obtain this information, return to the Microsoft RDP (MFA) app in Okta. On the <span class="wintitle">General</span> tab, scroll down to the <span class="wintitle">Client Credentials</span> section to see the values for the client ID and the client secret. The Okta URL is the URL your org uses to reach Okta in the format <span class="url">https://&lt;yourorg&gt;.okta.com</span>.</p>
            <p>Enter this information in the <span class="wintitle">App Configuration</span> screen, shown above and click <span class="uicontrol">Next</span>. Then, click <span class="uicontrol">Next</span> and <span class="uicontrol">Close</span> to complete the installation.
								</p>
         </li>
         <li>In the second App Configuration screen that opens, select from the following two options, as shown below.

<ul>
               <li>Filter Credential Provider – this option provides a workaround when multiple credential providers are installed on a server. If selected, this option makes the Okta MFA Credential Provider the only method for applying MFA to RDP connections and does not permit unauthenticated users to select which credential provider to use.</li>
               <li>RDP Only – By default, the installed credential provider inserts Okta MFA between both an RDP and a local authentication event. Checking this box will remove Okta MFA from local (interactive) logons.</li>
               <li>(EA version only) Display Okta password reset link (self service) -Checking this box will add an option to the Windows sign-on screen for end users to reset their password via Okta.</li>
            </ul>
         </li>
         <li>
            <p>To verify the installation, lock the machine. In the sign-in screen that appears, verify that the Okta icon appears as a sign-in option, as shown below on a Windows Server 2012 R2. The screen is slightly different in Windows Server 2016.</p>
         </li>
      </ol>
      <h4>Silent installation</h4>
      <ol>
         <li>
            <p>Extract the files from the .zip archive. </p>
         </li>
         <li>On the Windows server, run the following command from the <span class="filepath">vcredist_x64</span> folder of the unzipped archive.<p>
               <span class="codeblock">vcredist_x64.exe /install /quiet /norestart</span>
            </p>
         </li>
         <li>
            <p>Run the following command to  install Okta Windows Credential Provider silently.</p>
            <p>
               <span class="codeblock">msiexec /qb /log log.txt /i OktaWindowsCredentialProvider.msi CLIENT_ID="cid" CLIENT_SECRET="cs" OKTA_URL="https://a.b.c"</span>
            </p>
            <p>Parameters</p>
            <p>
               <span class="code">CLIENT_ID</span> – find this value on the <span class="wintitle">General</span> tab of the Microsoft RDP (MFA) application in Okta. Can also be edited manually in the RDP agent config file.</p>
            <p>
               <span class="code">CLIENT_SECRET</span> – find this value on the <span class="wintitle">General</span> tab of the Microsoft RDP (MFA) application in Okta. Resetting the ClientSecret will require reinstallation of the agent as the value in the config file is encrypted. Can also be edited manually in the RDP agent config file.</p>
            <p>
               <span class="code">OKTA_URL</span> – Your org URL. Must use the format <span class="url">https://org_name.okta.com</span>.  HTTPS is required. Also supported are *.oktapreview.com or *.okta-emea.com.</p>
         </li>
         <li>
            <p>
               <a name="Modify"/>Modify additional properties</p>
            <p>In addition to the parameters you added in the previous step, you can modify the following properties to ensure MFA is always enforced. </p>
            <table style="mc-table-style: url('../../Resources/TableStyles/standard-shaded-rows.css');"
                   class="TableStyle-srb_header_alt_shade"
                   cellspacing="0">
               <col class="TableStyle-srb_header_alt_shade-Column-Column1"/>
               <col style="width: 304px;"
                    class="TableStyle-srb_header_alt_shade-Column-Column1"/>
               <col class="TableStyle-srb_header_alt_shade-Column-Column1"/>
               <col class="TableStyle-srb_header_alt_shade-Column-Column1"/>
               <tr class="TableStyle-srb_header_alt_shade-Body-Body1">
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">Property</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">Definition</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">Default Value</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body1"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">Suggested Value</td>
               </tr>
               <tr class="TableStyle-srb_header_alt_shade-Body-Body2">
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">FilterCredentialProvider</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">
                     <p>This property provides a workaround when multiple credential providers are installed on a server. If true the Okta MFA Credential Provider is the only method for applying MFA to RDP connections and does not permit unauthenticated users to select which credential provider to use.</p>
                     <p>Setting FilterCredentialProvider to true and RdpOnly to false will cause the agent to prompt for MFA if required by the policy.</p>
                  </td>
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">false</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body2"
                      style="text-align: center;background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">-</td>
               </tr>
               <tr class="TableStyle-srb_header_alt_shade-Body-Body1">
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">InternetFailOpenOption</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">
                     <p>Sets authentication flow behavior if network connectivity is lost. When true, a user attempting to authenticate across RDP is not  challenged for MFA and is granted access based on password alone; when false, a user attempting to authenticate across RDP is not granted access because the credential provider cannot reach the Okta service.</p>
                     <p>InternetFailOpenOption governs proper access if the target machine does not have Internet access for MFA. </p>
                     <p>Set this property to true if Internet connectivity is a frequent issue.</p>
                  </td>
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">false</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body1"
                      style="text-align: center;background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">-</td>
               </tr>
               <tr class="TableStyle-srb_header_alt_shade-Body-Body2">
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">RdpOnly</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">
                     <p>By default, the installed credential provider inserts Okta MFA between both an RDP and a local authentication event. Setting this property to true removes Okta MFA from local (interactive) logons.</p>
                     <p>Setting FilterCredentialProvider to true and RdpOnly to false will cause the agent to prompt for MFA if required by the policy.</p>
                  </td>
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">false</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body2"
                      style="text-align: center;background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">-</td>
               </tr>
               <tr class="TableStyle-srb_header_alt_shade-Body-Body1">
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">WidgetTimeOutInSeconds</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">The number of seconds before timeout. To prevent the possibility that Windows might close the RDP session, this value must be smaller than the idle timeout set in Windows.</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">60</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body1"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">30</td>
               </tr>
               <tr class="TableStyle-srb_header_alt_shade-Body-Body2">
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">ErrorTimeOutInSeconds</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">The timeout after which the RDP session is closed when an error message is displayed.</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">30</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body2"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">30</td>
               </tr>
               <tr class="TableStyle-srb_header_alt_shade-Body-Body1">
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">EnforceTimeoutVersionAgnostic</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">Enforce timeout for both Windows 2012 and 2016. </td>
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">false</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body1"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">true</td>
               </tr>
               <tr class="TableStyle-srb_header_alt_shade-Body-Body2">
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">SslPinningEnabled</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">Validate the public key of the Okta server  to which the agent is connecting.</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body2"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">true</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body2"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">true</td>
               </tr>
               <tr class="TableStyle-srb_header_alt_shade-Body-Body1">
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">DisplayPasswordResetLink<p>This property applies only to the Beta version, 1.2.1. If you upgraded from the GA version 1.1.4 to Beta 1.2.1, you must add this property.</p>
                  </td>
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">Display link to reset Active Directory password.</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyF-Column1-Body1"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">false</td>
                  <td class="TableStyle-srb_header_alt_shade-BodyD-Column1-Body1"
                      style="background-color: #f5f5f5;padding-left: 4px;padding-right: 4px;padding-top: 2px;padding-bottom: 2px;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #333333;">true</td>
               </tr>
            </table>
            <p>To modify these properties, edit the file <span class="filepath">rdp_app_config.json</span> that is typically located in the <span class="filepath">C:\Program Files\Okta\Okta Windows Credential Provider\config</span> folder, or use the following PowerShell script:<span class="codeblock">$rdpAppConfig = Get-Content 'C:\Program Files\Okta\Okta Windows Credential Provider\config\rdp_app_config.json' -raw | ConvertFrom-Json
$rdpAppConfig.RdpOnly =([System.Convert]::ToBoolean('true'))
$rdpAppConfig | ConvertTo-Json | Set-Content  'C:\Program Files\Okta\Okta Windows Credential Provider\config\rdp_app_config.json'</span>
            </p>
            <p>You can run this script from the same location you ran the installation in step 2, above.</p>
            <div class="noteOkta">
               <p class="noteContent">This script was tested with PowerShell versions, 3, 4, and 5. To determine the PowerShell version on your system, open PowerShell as administrator and enter <span class="code">$PSVersionTable</span>.</p>
            </div>
         </li>
      </ol>
      <h4>Mass Deployment</h4>
      <p>Use the Microsoft <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/psexec"
            target="_blank">psexec64</a> tool to execute commands on remote machines. Modify the following command for a mass deployment:</p>
      <p>
         <span class="codeblock" xml:space="preserve">psexec64 &lt;IP of the machine to deploy&gt; -u &lt;AD admin user&gt; -p &lt;AD admin password&gt; msiexec /i                  \</span>
         <span class="codeblock" xml:space="preserve">&lt;//machine/share/OktaWindowsCredentialProvider.msi&gt; CLIENT_ID="&lt;client id&gt;" CLIENT_SECRET="&lt;client secret&gt;"  \</span>
         <span class="codeblock" xml:space="preserve">OKTA_URL="https://yourdomain.okta.com" /qn /l*v &lt;path for installation log&gt;</span>
      </p>
      <p>Elements of the command should be modified as follows:</p>
      <ul>
         <li>Replace <span class="code">&lt;IP of the machine to deploy&gt;</span>, <span class="code">&lt;AD admin user&gt;</span> and <span class="code">&lt;path for installation log&gt;</span> with appropriate values for your organization.</li>
         <li>Replace the <span class="code">&lt;client secret&gt;</span> and <span class="code">&lt;client ID&gt;</span> to match your application.</li>
         <li>Replace <span class="code">yourdomain</span> with the name of your Okta organization.</li>
      </ul>
      <h4>Configure behavior if network connectivity is lost</h4>
      <p>After completing the installation, you can configure the behavior of the authentication flow if network connectivity is lost.</p>
      <p>To make this specification, edit the file <span class="filepath">rdp_app_config.json</span> that is typically located in the <span class="filepath">C:\Program Files\Okta\Okta Windows Credential Provider\config</span> folder. Toggle the <span class="uicontrol">InternetFailOpenOption</span> value to one of the following values:</p>
      <ul>
         <li>
            <span class="uicontrol">true</span> – if internet connectivity is lost, a user attempting to authenticate across RDP is not  challenged for MFA and is granted access based on password alone.</li>
         <li>
            <span class="uicontrol">false</span> – if internet connectivity is lost, a user attempting to authenticate across RDP is not granted access because the credential provider cannot reach the Okta service.</li>
      </ul>
      <div class="noteOkta">
         <p class="noteContent">You can also modify any of the other properties listed in Step 4 in the Silent Installation section, above.</p>
      </div>
      <h4>Verify Windows and Okta widget timeout settings</h4>
      <p>To ensure that MFA works as expected, verify that the Okta sign in session times out before the Windows session. </p>
      <p>Note the following:</p>
      <ul>
         <li>By default, the Okta widget timeout session is set to 60 seconds.</li>
         <li>Determine the timeout duration in your Windows environment then set the session timeout duration for the Okta widget to be shorter than the Windows timeout session. <br/>
            <div class="noteOkta">
               <p class="noteContent">Set up a test in the environment by manually timing the session duration for both Windows and Okta to ensure that the timeout duration specified for each work as expected.</p>
            </div>
         </li>
      </ul>
      <p>To configure the Okta widget timeout session duration: </p>
      <ol>
         <li>Navigate to <span class="filepath">C:\Program Files\Okta\Okta Windows Credential Provider\config</span>
         </li>
         <li>Using an editor of your choice, open: <span class="filepath">rdp_app_config.json</span>.</li>
         <li>Add the following properties and values to the file. <br/>Delineate each entry with a comma:<ul>
               <li>
                  <span class="codeblock">"WidgetTimeOutInSeconds": 30</span>
               </li>
               <li>
                  <p>
                     <span class="codeblock">"ErrorTimeOutInSeconds": 30</span>
                  </p>
               </li>
               <li>
                  <span class="codeblock">"EnforceTimeoutVersionAgnostic": false</span>
               </li>
            </ul>
            <div class="noteOkta">
               <p class="noteContent">You may specify another value for timeout as long as it is lower than your Windows session timeout duration.</p>
            </div>
         </li>
      </ol>
      <br/>
      <h3>Step 3 – Assign users to the Microsoft RDP (MFA) app in Okta</h3>
      <p>All users who login to any machine that has the Credential Provider installed will need to be assigned to the Microsoft RDP (MFA) app. By default, the App Sign-On policy for this app prompts for MFA every login. I</p>
      <ol>
         <li>
            <p>In the Microsoft RDP (MFA) app in Okta, select the <span class="wintitle">Sign On</span> tab. In the <span class="wintitle">Settings</span> section, select <span class="uicontrol">Edit</span> and choose the Application username format to assign to users of this app. In the example below, <span class="uicontrol">AD SAM account name</span> is chosen, but you can make any choice.</p>
            <div class="noteOkta">
               <p class="noteContent">When the end user signs in, the application user format must match exactly.</p>
            </div>
            <p>Best practice: Okta recommends using a username prefix, as Windows uses the SAMAccountName for login.</p>
         </li>
         <li>
            <p>Select the <span class="wintitle">Assignments</span> tab and assign the app to users or groups. After selecting <span class="uicontrol">Assign</span>, enter the user name. For more information on assigning apps, see <MadCap:xref href="../Apps/apps-assign-applications.htm">Assign app integrations</MadCap:xref>.</p>
            <div class="noteOkta">
               <p class="noteContent">The user name entered here must match the format you selected in the preceding step. For example, in the case that the full UPN for a user is in the format name@yourorg.com, and you entered AD SAM account name for the username format above, enter only the name portion of the UPN for the user name. The @yourorg.com portion of the UPN is included in the AD SAM account name.</p>
            </div>
         </li>
         <li>
            <p>Navigate to the <span class="wintitle">Sign on</span> tab to configure Sign on rules specific to this app. <br/>The App Sign-On policy for this app is set to prompt for MFA for every login. <br/>Create a new sign on rule if you do not want to prompt some or all of your users for MFA. Assign users to the new rule and leave the ‘Prompt for factor’ checkbox unchecked.<br/>
            </p>
            <div class="noteOkta">
               <p class="noteContent">Okta sign on policy does not apply to Microsoft RDP App. Only the app sign on policy as defined in this step is evaluated.</p>
            </div>
         </li>
         <li>Select <span class="uicontrol">Done</span> when finished. Your system is completely configured.</li>
      </ol>
      <br/>
      <h3>Testing – Verify MFA for RDP sessions</h3>
      <p>This verification process is the end-user sign in process.</p>
      <ol>
         <li>
            <p>Sign in to a machine which has the RDP client installed. Be sure that this machine can connect to the server into which you want to make a remote connection.</p>
         </li>
         <li>
            <p>Enter the  name for the RDP client, your username, and password and then, click <span class="uicontrol">Connect</span>.</p>
         </li>
         <li>
            <p>In the RDP sign in screen that opens, sign in as the user that has the Microsoft RDP (MFA) application assigned in Okta. </p>
            <div class="noteOkta">
               <p class="noteContent">In both cases, the value for <span class="code">user</span> must match the user name that was used when the app was assigned in Okta</p>
            </div>
         </li>
         <li>
            <p>All users, including those that just set up MFA in the preceding step, are prompted to choose the MFA factor to use for authentication.</p>
         </li>
         <li>
            <p>After providing the second factor, verify the RDP connection to the Windows server. If you cannot sign in, see the Troubleshooting section below.
				</p>
         </li>
      </ol>
      <h3>
         <a name="(Optiona"/>(Optional) Set up a Proxy for the System Account</h3>
      <p>Complete the following steps to set up a proxy for the system account.</p>
      <ol>
         <li>Download <span class="uicontrol">pstools</span> from Microsoft at <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/pstools">https://docs.microsoft.com/en-us/sysinternals/downloads/pstools.</a>
         </li>
         <li>Run the command: <br/>
            <span class="codeblock">psexec -i -s "c:\program files\Internet Explorer\iexplore.exe"</span>
         </li>
         <li>Open <span class="menucascade">
               <span class="uicontrol">Internet options</span>
               <span class="uicontrol">Connections</span>
               <span class="uicontrol">LAN Settings</span>
            </span>
         </li>
         <li>Set the proxy server and port.</li>
         <li>Click <span class="uicontrol">OK</span>, and then, click <span class="uicontrol">OK</span> again on the Internet options dialog.</li>
      </ol>
      <p>After completing this setup, the system responds as follows</p>
      <ul>
         <li>If the proxy is running, users can access the okta widget for MFA and sign in.</li>
         <li>If the proxy is not running, users receive the message Multifactor Authentication Failed, and the system log shows a connectFailure error.</li>
      </ul>
      <h3>Troubleshooting</h3>
      <ol>
         <li>
            <p>If you see the <span class="uicontrol">MFA Bypass</span> screen shown below when signing in, verify in Okta that the user is included in an MFA policy.
<MadCap:toggler targets="/mfa-ms-rdp-08-dropdown">Screenshot</MadCap:toggler>
            </p>
            <p>Note: An App-SignOn Policy is the only policy that is relevant to the Microsoft RDP App.</p>
         </li>
         <li>
            <p>If you see the <span class="uicontrol">Display Failed</span> screen shown below when signing in, verify the following: <MadCap:toggler targets="mfa-ms-rdp-09-dropdown">Screenshot</MadCap:toggler>
               <p>
                  <ul>
                     <li>The client ID, the client secret, and the Okta URL are configured correctly.</li>
                     <li>The username entered into the Windows sign in matches the username in Okta.</li>
                  </ul>
               </p>
            </p>
         </li>
         <li>
            <p>If you cannot RDP into a server, verify that it is setup to accept remote connections in the <span class="wintitle">System Properties</span> screen, as shown below.</p>
         </li>
      </ol>
      <h3>Logging</h3>
      <p>Windows logs can be helpful when troubleshooting. <br/>The log file for Windows Credential provider can be found in<br/>
         <span class="filepath">${USERPROFILE}\AppData\Local\Okta\Okta MFA Provider\logs\OktaMfaAdfs.log</span>
         <p>For example:</p>
         <span class="filepath">C:\Users\GroupManagementAcnt$\AppData\Local\Okta\Okta MFA Provider\logs</span>
         <p>The log contains error messages, warnings and other information that may be helpful when troubleshooting.</p>
         <p>In addition, Windows Events may contain helpful information related to the errors and failures.</p>
      </p>
   </body>
</html>
