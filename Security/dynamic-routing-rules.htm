<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:onlyLocalStylesheets="False" MadCap:searchable="True" MadCap:fileTags="Tags/okta-authors.Graham Smith" MadCap:conditions="MultiProdPublish.Classic+OIE">
    <head>
        <link href="../../Resources/TableStyles/standard.css" rel="stylesheet" MadCap:stylesheetType="table" /><title>[%=Heading.Level1%]</title>
        <link href="" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <h1>Configure dynamic routing rules</h1>
        <p>Dynamic routing rules work like standard routing rules, except they aren’t bound to specific identity providers (IdPs). They use Expression Language to match users to any IdP, based on the attributes of their login object.</p>
        <p>When a user signs in, one rule is evaluated at a time until there’s a match. Evaluating hundreds  of rules can slow the sign-in experience for users. With dynamic routing rules, you don’t need a separate rule for every IdP. You can consolidate multiple  rules with the same conditions into a single dynamic routing rule.</p>
        <h2>Before you begin</h2>
        <p>The most common use case is to dynamically route to an IdP by domain. To do this, add at least one IdP, and be sure that its name matches the domain. For example, if you want users with email addresses like <span class="url">user.name@yourorg.com</span> to route to the same IdP, name the IdP <span class="userinput">yourorg.com</span>.</p>
        <p>If you want to route users based on an IP&#160;address, define at least one network zone. See <MadCap:xref href="network/network-zones.htm">Network Zones</MadCap:xref>.</p>
        <h2>Add a rule</h2>
        <ol MadCap:continue="true">
            <li>
                <MadCap:snippetText src="../../Resources/Snippets/task steps/Security_IdentityProviders.flsnp" />
            </li>
            <li>On the <span class="wintitle">Routing Rules</span> tab, click <span class="uicontrol">Add Routing Rule</span>.</li>
            <li>Enter a <span class="uicontrol">Rule Name</span>. Consider using a name that identifies this rule as dynamic.</li>
            <li>Configure the routing conditions. <br /><dl><dt><table style="width: 100%;mc-table-style: url('../../Resources/TableStyles/standard.css');" class="TableStyle-standard" cellspacing="0"><col class="TableStyle-standard-Column-Column1" style="width: 350px;" /><col class="TableStyle-standard-Column-Column1" /><tbody><tr class="TableStyle-standard-Body-Body1"><td class="TableStyle-standard-BodyF-Column1-Body1"><code>IF</code>&#160;<span class="uicontrol">User's IP&#160;is</span></td><td class="TableStyle-standard-BodyD-Column1-Body1">Select network zones. You can sort by zones defined or not defined in Okta, or configure specific zones.</td></tr><tr class="TableStyle-standard-Body-Body2"><td class="TableStyle-standard-BodyF-Column1-Body2"><code>AND</code>&#160;<span class="uicontrol">User's device platform is</span></td><td class="TableStyle-standard-BodyD-Column1-Body2">Select any combination of mobile and desktop devices.&#160;Note&#160;that iOS&#160;devices may bypass your iOS&#160;routing rules. See <MadCap:xref href="configure-routing-rules.htm#Configur">Configure a routing rule for macOS&#160;devices</MadCap:xref>.</td></tr><tr class="TableStyle-standard-Body-Body1"><td class="TableStyle-standard-BodyF-Column1-Body1"><code>AND</code>&#160;<span class="uicontrol">User is accessing</span></td><td class="TableStyle-standard-BodyD-Column1-Body1">Enter the name of an application or app instance.</td></tr><tr class="TableStyle-standard-Body-Body2"><td class="TableStyle-standard-BodyF-Column1-Body2"><code>AND</code>&#160;<span class="uicontrol">User matches</span></td><td class="TableStyle-standard-BodyD-Column1-Body2">Select which login attributes the user must match.<ul><li style="font-style: normal;"><span class="uicontrol">Anything</span> includes all users.<li style="font-style: normal;"><span class="uicontrol">Regex on login</span> allows you to enter any valid regular expression based on the user login to use for matching. This is useful when specifying the domain or a user attribute isn’t sufficient for matching. For example, <span class="userinput">.*\+devtest@company.com</span> matches logins for the domain <span class="userinput">@company.com</span> but only if  <span class="userinput">+devtest</span> is included before the <span class="userinput">@</span> sign.</li><li style="font-style: normal;"><span class="uicontrol">Domain list on login</span> specifies a list of the domains to match (without the <span class="userinput">@</span>&#160;sign); for example, <span class="userinput">mytest.com</span>. It isn't necessary to escape any characters (which is required when using a regular expression).</li><li style="font-style: normal;"><span class="uicontrol">User attributes</span> specify an attribute name, a type of comparison, and a value to match. If you choose Regex for the type of comparison, you must enter a valid regular expression for the value. For example, <span class="userinput">(Human Resources|Engineering|Marketing)</span> for the <span class="uicontrol">Department</span> attribute in your Okta user schema.</li></li></ul></td></tr><tr class="TableStyle-standard-Body-Body1" MadCap:conditions=""><td class="TableStyle-standard-BodyF-Column1-Body1"><span class="uicontrol"><span class="code">THEN</span>&#160;Use this identity provider</span></td><td class="TableStyle-standard-BodyD-Column1-Body1">Select <span class="uicontrol">Dynamically match to an IdP</span>.</td></tr><tr class="TableStyle-standard-Body-Body2" MadCap:conditions=""><td class="TableStyle-standard-BodyC-Column1-Body2"><span class="uicontrol">Match IdP name to</span></td><td class="TableStyle-standard-BodyA-Column1-Body2">Select the default string or enter your own custom expression. The default <span class="code">login.identifier.substringAfter('@))</span> automatically maps to the domain name in a user's email address (everything after the <span class="code">@</span> sign).</td></tr></tbody></table></dt></dl></li>
            <li style="font-style: normal;">Click <span class="uicontrol">Create Rule</span>, and then indicate whether you want to activate the rule immediately.</li>
        </ol>
        <h2>Test a dynamic  rule</h2>
        <p>Your new rule is automatically sorted after other routing rules (but before the default catch-all rule). If your new dynamic routing rule replaces  standard rules, test it by disabling those standard rules and signing in with a valid username. Don’t delete any rules until you verify that the dynamic rule works.</p>
        <h2>Related topics</h2>
        <p>
            <MadCap:xref href="Identity_Provider_Discovery.htm">Identity Provider  Routing Rules</MadCap:xref>
        </p>
        <p>
            <MadCap:xref href="Identity_Providers.htm">Identity Providers</MadCap:xref>
        </p>
    </body>
</html>